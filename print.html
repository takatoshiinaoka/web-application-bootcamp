<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>web-application-bootcamp</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="php/php_setup/index.html"><strong aria-hidden="true">1.</strong> PHP事前準備</a></li><li class="chapter-item expanded "><a href="php/php01/index.html"><strong aria-hidden="true">2.</strong> Day01</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php01/about-php.html"><strong aria-hidden="true">2.1.</strong> PHP概要</a></li><li class="chapter-item expanded "><a href="php/php01/get-started.html"><strong aria-hidden="true">2.2.</strong> 開発の手順</a></li><li class="chapter-item expanded "><a href="php/php01/php-start.html"><strong aria-hidden="true">2.3.</strong> PHP基礎</a></li><li class="chapter-item expanded "><a href="php/php01/get-post.html"><strong aria-hidden="true">2.4.</strong> クライアント - サーバ間の通信</a></li><li class="chapter-item expanded "><a href="php/php01/data-select.html"><strong aria-hidden="true">2.5.</strong> パラメータ送信による検索機能の実装</a></li></ol></li><li class="chapter-item expanded "><a href="php/php02/index.html"><strong aria-hidden="true">3.</strong> Day02</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php02/about-db.html"><strong aria-hidden="true">3.1.</strong> DBの基本</a></li><li class="chapter-item expanded "><a href="php/php02/start-db.html"><strong aria-hidden="true">3.2.</strong> DB / テーブルの作成</a></li><li class="chapter-item expanded "><a href="php/php02/db-sql.html"><strong aria-hidden="true">3.3.</strong> SQLによるDB操作</a></li><li class="chapter-item expanded "><a href="php/php02/sql-create.html"><strong aria-hidden="true">3.4.</strong> PHPとDBの連携1（データ作成処理）</a></li><li class="chapter-item expanded "><a href="php/php02/sql-read.html"><strong aria-hidden="true">3.5.</strong> PHPとDBの連携2（データ参照処理）</a></li></ol></li><li class="chapter-item expanded "><a href="php/php03/index.html"><strong aria-hidden="true">4.</strong> Day03</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php03/function-db-connect.html"><strong aria-hidden="true">4.1.</strong> DB接続関数の作成</a></li><li class="chapter-item expanded "><a href="php/php03/sql-edit.html"><strong aria-hidden="true">4.2.</strong> PHPとDBの連携3（編集画面の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-update.html"><strong aria-hidden="true">4.3.</strong> PHPとDBの連携4（データ更新処理の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-delete.html"><strong aria-hidden="true">4.4.</strong> PHPとDBの連携5（データ削除処理）</a></li></ol></li><li class="chapter-item expanded "><a href="php/php04/index.html"><strong aria-hidden="true">5.</strong> Day04</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php04/about-session.html"><strong aria-hidden="true">5.1.</strong> セッションとは</a></li><li class="chapter-item expanded "><a href="php/php04/session-variables.html"><strong aria-hidden="true">5.2.</strong> セッション変数</a></li><li class="chapter-item expanded "><a href="php/php04/auth-01.html"><strong aria-hidden="true">5.3.</strong> 認証処理の実装1（ログインとログアウト）</a></li><li class="chapter-item expanded "><a href="php/php04/auth-02.html"><strong aria-hidden="true">5.4.</strong> 認証処理の実装2（認証状態の確認）</a></li></ol></li><li class="chapter-item expanded "><a href="php/php05/index.html"><strong aria-hidden="true">6.</strong> Day05</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php05/about-rdb.html"><strong aria-hidden="true">6.1.</strong> RDBの構造</a></li><li class="chapter-item expanded "><a href="php/php05/like-add.html"><strong aria-hidden="true">6.2.</strong> Like機能の実装1（データの追加1）</a></li><li class="chapter-item expanded "><a href="php/php05/like-delete.html"><strong aria-hidden="true">6.3.</strong> Like機能の実装2（データの追加2）</a></li><li class="chapter-item expanded "><a href="php/php05/like-groupby.html"><strong aria-hidden="true">6.4.</strong> Like機能の実装3（データの集計）</a></li><li class="chapter-item expanded "><a href="php/php05/like-join.html"><strong aria-hidden="true">6.5.</strong> Like機能の実装4（データの結合）</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/index.html"><strong aria-hidden="true">7.</strong> Laravel事前準備</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/index.html"><strong aria-hidden="true">8.</strong> Day06</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> MVCとは</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.2.</strong> ルーティング（必要な画面）</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.3.</strong> Create</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.4.</strong> Read</div></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel02/index.html"><strong aria-hidden="true">9.</strong> Day07</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> Update</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> Delete</div></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel03/index.html"><strong aria-hidden="true">10.</strong> Day08</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> 認証とルーティング連携</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> 1対多の実装</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.3.</strong> Like機能</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.4.</strong> 多対多の実装</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">web-application-bootcamp</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="php事前準備"><a class="header" href="#php事前準備">PHP事前準備</a></h1>
<h2 id="サーバとクライアント"><a class="header" href="#サーバとクライアント">サーバとクライアント</a></h2>
<p>サーバで動作する言語（サーバサイド）</p>
<ul>
<li>webサーバ上でプログラムが実行される．</li>
<li>PHP, Ruby, Python, JAVA, (node.js), etc…</li>
</ul>
<p>クライアント（webブラウザ）で動作する言語（クライアントサイド）</p>
<ul>
<li>webブラウザでプログラムが実行される．</li>
<li>html, css, JavaScript</li>
</ul>
<p>=&gt;サーバサイド言語の開発にはサーバ上で動作させるアプリケーション（xamppなど）が必要！</p>
<p>（自分のPC上でサーバを動かすイメージ）</p>
<h2 id="サーバのしくみとxamppの役割"><a class="header" href="#サーバのしくみとxamppの役割">サーバのしくみとXAMPPの役割</a></h2>
<h3 id="サーバの役割及び構成"><a class="header" href="#サーバの役割及び構成">サーバの役割及び構成</a></h3>
<p>Webアプリケーションはクライアントとサーバの組み合わせで構成されている．</p>
<p>サーバには「アプリケーションサーバ」と「DBサーバ」が存在し，相互に連携することでアプリケーションを構築している．</p>
<p>（詳しい仕組みの理解は後からでOK．）</p>
<p><img src="php/php_setup/./img/php_file_about_server.svg" alt="サーバのしくみ" /></p>
<h3 id="サーバサイド言語での開発とxamppの役割"><a class="header" href="#サーバサイド言語での開発とxamppの役割">サーバサイド言語での開発とXAMPPの役割</a></h3>
<p>上記のとおり，PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身のPCで開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身のPC内で擬似的なサーバを用意してPHPを動作させることができるのが「xampp」である．</p>
<p>xamppは以下の役割を提供する．</p>
<ul>
<li>PHPを動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php_setup/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="xampp環境構築"><a class="header" href="#xampp環境構築">XAMPP環境構築</a></h2>
<h3 id="ダウンロード"><a class="header" href="#ダウンロード">ダウンロード</a></h3>
<p>下記URLにアクセスする．</p>
<p><a href="https://www.apachefriends.org/jp/download.html">https://www.apachefriends.org/jp/download.html</a></p>
<blockquote>
<p><strong>！！注意！！</strong></p>
<p>資料作成時時点では<code>7.3.6 / PHP 7.3.6</code>となっているが，現時点（2021/09/12）では<code>8.0.9 / PHP 8.0.9</code>が最新なのでこちらを用いること！！</p>
</blockquote>
<p>↓アクセス画面
<img src="php/php_setup/./img/php_setup_xampp_download_01.svg" alt="xamppダウンロード画面" /></p>
<p>Macの人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_02.svg" alt="xamppダウンロード画面" /></p>
<p>Windowsの人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_03.svg" alt="xamppダウンロード画面" /></p>
<h3 id="インストール"><a class="header" href="#インストール">インストール</a></h3>
<p>ダウンロードしたらインストールを進める．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_04.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認サーバ起動"><a class="header" href="#動作確認サーバ起動">動作確認（サーバ起動）</a></h3>
<p>インストールが済んだらアプリケーションを立ち上げる．</p>
<p>Macの人は以下のようにサーバを起動させる．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_05.svg" alt="xamppダウンロード画面" /></p>
<p>Windowsの人は以下の画面．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_06.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認画面表示"><a class="header" href="#動作確認画面表示">動作確認（画面表示）</a></h3>
<h4 id="アプリケーションサーバ動作確認"><a class="header" href="#アプリケーションサーバ動作確認">アプリケーションサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/">https://localhost/</a>にアクセスして下記画面が表示されればOK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_01.svg" alt="アプリケーションサーバ動作確認" /></p>
<h4 id="dbサーバ動作確認"><a class="header" href="#dbサーバ動作確認">DBサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/phpmyadmin">https://localhost/phpmyadmin</a>にアクセスして下記画面が表示されればOK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_02.svg" alt="DBサーバ動作確認" /></p>
<h2 id="まとめ"><a class="header" href="#まとめ">まとめ</a></h2>
<p>下記3点が実施できていることを確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎"><a class="header" href="#php基礎">PHP基礎</a></h1>
<h2 id="本講義の内容とゴール"><a class="header" href="#本講義の内容とゴール">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容"><a class="header" href="#本講義の内容">本講義の内容</a></h3>
<ul>
<li>PHPの基本的な開発手順．</li>
<li>PHPを用いた簡単な処理の実装．</li>
<li>データ送受信とファイル操作機能を用いたtodoリストアプリケーションの実装．</li>
</ul>
<h3 id="本講義のゴール"><a class="header" href="#本講義のゴール">本講義のゴール</a></h3>
<ul>
<li>Webアプリケーションの仕組みをと動きを把握する（大事）！</li>
<li>PHP（の開発手順）に慣れる！</li>
<li>PHPを用いたデータの送受信とファイルの操作ができるようになる！</li>
</ul>
<h2 id="準備"><a class="header" href="#準備">準備</a></h2>
<p>以下3点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php概要"><a class="header" href="#php概要">PHP概要</a></h1>
<h2 id="サーバサイドの役割"><a class="header" href="#サーバサイドの役割">サーバサイドの役割</a></h2>
<p>様々なWebアプリケーションが存在するが，基本のサーバサイド処理は同様である．</p>
<p>基本の機能は何らかのデータを扱うことである．</p>
<h3 id="例"><a class="header" href="#例">例</a></h3>
<ul>
<li>twitter     =&gt;  ツイート，検索，タイムラインの表示，etc</li>
<li>facebook		=&gt;  投稿，検索，記事の更新，コメント，etc</li>
<li>wordpress		=&gt;  ブログ記事の投稿，編集，削除，etc</li>
</ul>
<p>※：アプリケーションは必ずしもPHPで作られているわけではない！！</p>
<h3 id="-key-point"><a class="header" href="#-key-point">💡 Key Point</a></h3>
<blockquote>
<p>上記の処理は以下の4つに集約される．</p>
<ul>
<li>📝 データの「作成」（Create）</li>
<li>📖 データの「参照」（Read）</li>
<li>🔄 データの「更新」（Update）</li>
<li>🗑 データの「削除」（Delete）</li>
</ul>
</blockquote>
<p>これら4種類の処理の頭文字をとって「CRUD」と呼ぶ．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎-1"><a class="header" href="#php基礎-1">PHP基礎</a></h1>
<h2 id="サーバサイド言語での開発"><a class="header" href="#サーバサイド言語での開発">サーバサイド言語での開発</a></h2>
<p>PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身のPCで開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身のPC内で擬似的なサーバを用意してPHPを動作させることができるのが「xampp」である．</p>
<p>xamppは以下の役割を提供する．</p>
<ul>
<li>PHPを動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php01/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="開発の手順"><a class="header" href="#開発の手順">開発の手順</a></h2>
<p>xamppはPC内に<code>localhost</code>というサーバを用意してくれる．</p>
<p>このサーバ内にPHPファイルを配置することでPHPのコードを動かすことができる．</p>
<p>PC内では予め指定されたディレクトリ（<code>htdocs</code>）がサーバの役割をするよう決められているため，まずPHPファイルを指定のディレクトリに配置する作業が必要となる．</p>
<p>サンプルフォルダを下記のディレクトリへ移動する！</p>
<ul>
<li>windows : <code>C\xampp\htdocs\</code></li>
<li>mac : <code>/Applications/xampp/xamppfiles/htdocs/</code></li>
</ul>
<h3 id="-key-point-1"><a class="header" href="#-key-point-1">💡 Key Point</a></h3>
<blockquote>
<p><strong>【重要】開発の手順は以下の流れとなる．</strong></p>
<ol>
<li>xamppを起動する</li>
<li>phpファイルが入ったフォルダをhtdocsに配置</li>
<li>vs codeでhtdocsの上記フォルダを開く</li>
<li>phpのコードを書く</li>
<li>ブラウザでlocalhostにアクセスして動作確認</li>
</ol>
<p>以降，3-5の繰り返し！</p>
<p>※一通り終わったらxamppを終了させることを推奨（次回起動でコケる）</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎-2"><a class="header" href="#php基礎-2">PHP基礎</a></h1>
<h2 id="phpの記述"><a class="header" href="#phpの記述">PHPの記述</a></h2>
<p>PHPは「PHPファイル」に記述する．</p>
<h3 id="phpファイルの作成"><a class="header" href="#phpファイルの作成">PHPファイルの作成</a></h3>
<ul>
<li>拡張子を「<code>.php</code>」にする．</li>
<li>例：「<code>index.php</code>」「<code>create.php</code>」など．</li>
</ul>
<h3 id="開始タグと終了タグ"><a class="header" href="#開始タグと終了タグ">開始タグと終了タグ</a></h3>
<ul>
<li>「<code>&lt;?php</code>」で始まり「<code>?&gt;</code>」で終了（phpしか書かない場合，終了タグは省略可）．</li>
<li>開始タグと終了タグの間に書かれた処理がサーバ上で実行される！</li>
<li>タグ以外の部分（HTMLなど記述した場合）はサーバでは実行されない（そのままソースコードがブラウザに送信される）．</li>
</ul>
<pre><code class="language-php">&lt;?php
// ここにPHPの処理を書く
// ...
?&gt;

// ここから下に書いたコードはサーバで実行されない
// （HTMLなどを書く）
</code></pre>
<h2 id="変数と文字列"><a class="header" href="#変数と文字列">変数と文字列</a></h2>
<p>変数の扱いはJavaScriptと大きく変わらないが，以下の点に注意する．</p>
<ul>
<li>変数名は必ず「<code>$****</code>」←$で始めるルール！</li>
<li>文字列はシングルクォーテーションかダブルクォーテーションで囲む．</li>
<li><code>$</code>の次に数字はNG（JavaScriptと同様）．</li>
<li><code>_</code>などの記号はOK．</li>
</ul>
<pre><code class="language-php">// 数値
$number = 100;

// 文字列
$name = 'engineer';

// 数値スタートはNG
$1lang = 'php';

// 後の数字はOK
$lang2 = 'javascript';

// 記号もOK
$_lang = 'Rust';
</code></pre>
<p>変数と文字列は「<code>.</code>」でつなげる．</p>
<p>ダブルクォーテーションを用いる場合は<code>{}</code>で変数を埋め込むことができる（JavaScriptの<code>``</code>と<code>${}</code>に相当）．</p>
<pre><code class="language-php">$str1 = 'ジーズで' . $lang2 . 'を勉強中！';

// こっちのほうが楽かな．．！
$str2 = &quot;ジーズで{$lang2}を勉強中！&quot;;
</code></pre>
<h2 id="配列と連想配列"><a class="header" href="#配列と連想配列">配列と連想配列</a></h2>
<h3 id="配列"><a class="header" href="#配列">配列</a></h3>
<p>JavaScriptと同様の形式．</p>
<p>データを確認する際には<code>echo</code>または<code>var_dump()</code>を用いる．</p>
<ul>
<li><code>echo</code>で値自体を出力する．</li>
<li><code>var_dump()</code>では配列などの構造も見られる．</li>
<li>デバッグの基本は<code>var_dump()</code>（JavaScriptの<code>console.log()</code>的な）！！！</li>
</ul>
<pre><code class="language-php">// 配列
$array = ['JavaScript', 'PHP', 'Rust', 'COBOL'];

// `echo`で画面上にデータを表示できる．
echo $array[2]; // Rust

// 変数や配列の中身や構造を表示
var_dump($array);

</code></pre>
<h3 id="連想配列"><a class="header" href="#連想配列">連想配列</a></h3>
<p>連想配列はJavaScriptにおける「オブジェクト」に相当する．</p>
<ul>
<li>「キー」「バリュー」のセット．</li>
<li>キー名を指定して値を取り出すことができる．</li>
</ul>
<pre><code class="language-php">// 連想配列
$array2 = [
  &quot;フロント&quot; =&gt; &quot;JavaScript&quot;,
  &quot;サーバ&quot; =&gt; &quot;PHP&quot;,
  &quot;iOS&quot; =&gt; &quot;Swift&quot;,
  &quot;関数型&quot; =&gt; &quot;Haskell&quot;
];

// キー名を指定して値を取り出す
echo $array2['サーバ'];
</code></pre>
<h2 id="条件分岐"><a class="header" href="#条件分岐">条件分岐</a></h2>
<p>条件分岐の構文はJavaScriptと同様．</p>
<pre><code class="language-php">// 0から1のランダムな数を発生させる
$number = rand(0, 1);

// 1かそれ以外で条件分岐
if ($number == 1) {
  echo '値は1です';
} else {
  echo '値は1以外です';
}

</code></pre>
<p>条件分岐を使用したおみくじの例</p>
<pre><code class="language-php">// 1から5の乱数を作成
$random_number = rand(1, 5);

// 乱数の値で条件分岐
if ($random_number == 1) {
  $result =  '大吉';
} elseif ($random_number == ...) {
  $result = ...
} elseif (...) {
  // ...
}
echo $result;

</code></pre>
<h2 id="phpとhtmlの組み合わせ"><a class="header" href="#phpとhtmlの組み合わせ">PHPとHTMLの組み合わせ</a></h2>
<p><code>echo</code>で処理結果を出力できるが，ブラウザに値が表示されるだけで気が利いていない．</p>
<p>そこで，PHPとHTMLを組み合わせて画面を作成する機能を利用してみる．</p>
<ul>
<li>html内に<code>&lt;?=変数名?&gt;</code>と記述することでPHPの変数を埋め込める．</li>
<li>PHPで処理した結果からHTMLをつくるイメージ．</li>
</ul>
<pre><code class="language-php">&lt;?php
// いろいろな処理
$result = '大吉';
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;今日の運勢は&lt;?=$result?&gt;です！&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="-key-point-2"><a class="header" href="#-key-point-2">💡 Key Point</a></h3>
<blockquote>
<p>PHPとHTMLが動く順序を把握しよう！</p>
<ol>
<li>PHPの処理が実行される．</li>
<li>処理の結果作成された値がHTMLに埋め込まれ，HTMLが完成する．</li>
<li>HTMLのデータがブラウザに送信される．</li>
<li>画面にHTMLが表示される．</li>
</ol>
</blockquote>
<h2 id="phpの練習"><a class="header" href="#phpの練習">PHPの練習</a></h2>
<p><code>omikuji.php</code>におみくじの処理を作成し，HTMLと組み合わせて画面に結果を表示しよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="クライアント---サーバ間の通信"><a class="header" href="#クライアント---サーバ間の通信">クライアント - サーバ間の通信</a></h1>
<h2 id="サーバへデータを送るとは"><a class="header" href="#サーバへデータを送るとは">サーバへデータを送る，とは？？</a></h2>
<p>htmlファイルやphpファイルから別のphpファイルへデータを送る．
データを受け取ったphpファイルがDBへの保存などの処理を実行．</p>
<p>データ送信には以下の2種類が存在する．</p>
<ul>
<li>GET</li>
<li>POST</li>
</ul>
<p>どちらの場合も手順は同様．</p>
<h3 id="-key-point-3"><a class="header" href="#-key-point-3">💡 Key Point</a></h3>
<blockquote>
<p>必ず送信側ファイルと受信側ファイルの2つでやり取りを行う．</p>
</blockquote>
<h2 id="getでのデータ送受信"><a class="header" href="#getでのデータ送受信"><code>GET</code>でのデータ送受信</a></h2>
<h3 id="get方式でデータをやり取りする場合の流れ"><a class="header" href="#get方式でデータをやり取りする場合の流れ"><code>GET</code>方式でデータをやり取りする場合の流れ．</a></h3>
<h4 id="送信側の処理"><a class="header" href="#送信側の処理">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の3項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;data_get_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;GET&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理"><a class="header" href="#受信側の処理">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_GET</code>変数に値が格納される．</li>
<li><code>$_GET</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード"><a class="header" href="#送信側のコード">送信側のコード</a></h3>
<pre><code class="language-php">// data_get.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;data_get_confirm.php&quot; method=&quot;GET&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード"><a class="header" href="#受信側のコード">受信側のコード</a></h3>
<ul>
<li>GETで送信された情報は<code>$_GET</code>に入って送られる．</li>
<li>まず「情報が受け取れているかどうか」をチェックすることが大事！！</li>
<li>（情報が受け取れないと以降どうしようもない）</li>
<li><code>exit()</code>は以降の処理を中止する．</li>
</ul>
<pre><code class="language-php">// data_get_confirm.php

&lt;?php

// 必ず最初にチェック！！内容を確認したらコメントアウトすること．
var_dump($_GET);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_GET['todo'];
$deadline = $_GET['deadline'];

?&gt;

</code></pre>
<h3 id="get方式の特徴"><a class="header" href="#get方式の特徴"><code>GET</code>方式の特徴</a></h3>
<ul>
<li>サーバから情報を取得する． URLに情報を追加して送信できる．</li>
<li>データの特定（自分の名前で検索）など，少量のデータ送信に向く（URLにデータが含まれている）．</li>
<li>URLにデータが含まれるため，URLをシェアするだけでデータを共有できる．</li>
</ul>
<h2 id="postでのデータ送受信"><a class="header" href="#postでのデータ送受信"><code>POST</code>でのデータ送受信</a></h2>
<h3 id="post方式でデータをやり取りする場合の流れほとんどgetと同様"><a class="header" href="#post方式でデータをやり取りする場合の流れほとんどgetと同様"><code>POST</code>方式でデータをやり取りする場合の流れ（ほとんど<code>GET</code>と同様）．</a></h3>
<h4 id="送信側の処理-1"><a class="header" href="#送信側の処理-1">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の3項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;data_post_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;POST&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理-1"><a class="header" href="#受信側の処理-1">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_POST</code>変数に値が格納される．</li>
<li><code>$_POST</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード-1"><a class="header" href="#送信側のコード-1">送信側のコード</a></h3>
<pre><code class="language-php">// data_post.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;data_post_confirm.php&quot; method=&quot;POST&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード-1"><a class="header" href="#受信側のコード-1">受信側のコード</a></h3>
<ul>
<li>POSTで送信された情報は<code>$_POST</code>に入って送られる．</li>
<li>以降の流れは<code>GET</code>の場合と同様．</li>
</ul>
<pre><code class="language-php">// data_post_confirm.php

&lt;?php

// POSTの場合も必ず最初にチェック！！
var_dump($_POST);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

?&gt;

</code></pre>
<h3 id="post方式の特徴"><a class="header" href="#post方式の特徴"><code>POST</code>方式の特徴</a></h3>
<ul>
<li>サーバにデータを送信するときに使用．情報を見えないように送信する方法</li>
<li>個人情報など．（送れるデータ量がGETと比較して多い）</li>
<li>ファイルを送信する場合にも使用</li>
</ul>
<h2 id="参考xss--クロスサイトスクリプティング"><a class="header" href="#参考xss--クロスサイトスクリプティング">【参考】XSS : クロスサイトスクリプティング</a></h2>
<p>formに悪意あるJavaScriptを埋め込まれて実行される場合がある．</p>
<p>HTMLにデータを埋め込む際に対策できる．</p>
<pre><code class="language-php">&lt;?php
$hoge = $_POST['hoge'];
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;JavaScriptが送信されると実行されてしまいます&lt;?=$hoge?&gt;&lt;/p&gt;
    &lt;p&gt;ただの文字列として処理されます&lt;?=htmlspecialchars($hoge, ENT_QUOTES);?&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre>
<p>次の項では，データ送信機能を用いて検索処理を実装してみよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="パラメータ送信による検索機能の実装"><a class="header" href="#パラメータ送信による検索機能の実装">パラメータ送信による検索機能の実装</a></h1>
<p>サーバへのデータ送信を用いて，ユーザの入力値によるデータ検索を実装してみよう．</p>
<h2 id="処理の流れ"><a class="header" href="#処理の流れ">処理の流れ</a></h2>
<ol>
<li>ユーザがデータを入力する画面を準備する．</li>
<li>検索ボタンクリックでサーバにユーザが入力したデータを送信する．</li>
<li>サーバ側では，受け取ったキーワードを用いて予め用意されたデータの中から該当するものを抽出し，画面を構成する．</li>
</ol>
<h2 id="データの確認"><a class="header" href="#データの確認">データの確認</a></h2>
<p>今回は下記のデータを使用する（すでにファイル内にデータ用意済）．</p>
<p>入力画面でキーワードを入力し，このデータの中からキーワードが含まれるものだけを抽出して画面に表示する．</p>
<table><thead><tr><th>id</th><th>name</th><th>hero</th><th>rival</th></tr></thead><tbody>
<tr><td>1</td><td>ファントムブラッド</td><td>ジョナサン・ジョースター</td><td>ディオ・ブランドー</td></tr>
<tr><td>2</td><td>戦闘潮流</td><td>ジョセフ・ジョースター</td><td>カーズ</td></tr>
<tr><td>3</td><td>スターダストクルセイダース</td><td>空条承太郎</td><td>DIO</td></tr>
<tr><td>4</td><td>ダイヤモンドは砕けない</td><td>東方仗助</td><td>吉良吉影</td></tr>
<tr><td>5</td><td>黄金の風</td><td>ジョルノ・ジョバァーナ</td><td>ディアボロ</td></tr>
<tr><td>6</td><td>ストーンオーシャン</td><td>空条徐倫</td><td>エンリコ・プッチ</td></tr>
<tr><td>7</td><td>スティール・ボール・ラン</td><td>ジョニィ・ジョースター</td><td>ファニー・ヴァレンタイン</td></tr>
<tr><td>8</td><td>ジョジョリオン</td><td>東方定助</td><td>透龍</td></tr>
</tbody></table>
<h2 id="ユーザ入力データの送信"><a class="header" href="#ユーザ入力データの送信">ユーザ入力データの送信</a></h2>
<p>まずは検索フォームを用意し，POST でサーバにデータを送信する．</p>
<pre><code class="language-php">// data_input.php

&lt;form action=&quot;data_select.php&quot; method=&quot;post&quot;&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;検索キーワード入力画面&lt;/legend&gt;
    &lt;div&gt;
      keyword: &lt;input type=&quot;text&quot; name=&quot;keyword&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;検索&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<h2 id="データの受け取り"><a class="header" href="#データの受け取り">データの受け取り</a></h2>
<p>データを受け取る場合には必ず<code>var_dump()</code>を用いてデータを受け取れていることを確認する．</p>
<pre><code class="language-php">// data_select.php

var_dump($_POST);
exit();

</code></pre>
<h2 id="キーワードを用いた検索と画面の構成"><a class="header" href="#キーワードを用いた検索と画面の構成">キーワードを用いた検索と画面の構成</a></h2>
<ol>
<li>受け取ったキーワードを用いて，該当するデータのみ含まれる配列を作成する．<code>id</code>，<code>name</code>，<code>hero</code>，<code>rival</code>いずれかにキーワードが含まれていれば OK とする．</li>
<li>作成した配列から，画面を構成するためのタグを構成する．</li>
</ol>
<pre><code class="language-php">// data_select.php

$keyword = $_POST['keyword'];

$results = array_filter($data, function ($x) use ($keyword) {
  return str_contains($x['id'], $keyword)
    || str_contains($x['name'], $keyword)
    || str_contains($x['hero'], $keyword)
    || str_contains($x['rival'], $keyword);
});

$output = '';

foreach ($results as $result) {
  $output .= &quot;&lt;tr&gt;&lt;td&gt;{$result['id']}&lt;/td&gt;&lt;td&gt;{$result['name']}&lt;/td&gt;&lt;td&gt;{$result['hero']}&lt;/td&gt;&lt;td&gt;{$result['rival']}&lt;/td&gt;&lt;/tr&gt;&quot;;
}

</code></pre>
<p>構成したタグを HTML 部分に埋め込み．</p>
<pre><code class="language-php">// data_select.php

// 省略

&lt;body&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;検索結果&lt;/legend&gt;
    &lt;a href=&quot;data_input.php&quot;&gt;入力画面&lt;/a&gt;
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;id&lt;/th&gt;
          &lt;th&gt;name&lt;/th&gt;
          &lt;th&gt;hero&lt;/th&gt;
          &lt;th&gt;rival&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;!-- ここに`&lt;tr&gt;&lt;td&gt;'id'&lt;/td&gt;&lt;td&gt;'name'&lt;/td&gt;&lt;td&gt;'hero'&lt;/td&gt;&lt;td&gt;'rival'&lt;/td&gt;&lt;/tr&gt;`の形式でデータが表示する --&gt;
        &lt;?= $output ?&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/fieldset&gt;
&lt;/body&gt;

// 省略

</code></pre>
<h2 id="練習"><a class="header" href="#練習">練習</a></h2>
<p><code>data_input.php</code>と<code>data_select.php</code>に上記の処理を記述して動作を確認しよう！</p>
<ol>
<li><code>data_input.php</code>のフォーム部分にデータ送信のためのコードを記述しよう．</li>
<li><code>data_select.php</code>でデータが受け取れることを確認！</li>
<li><code>data_select.php</code>で受け取ったデータを用いてデータを検索し，画面に表示する処理を記述！</li>
</ol>
<p><code>data_input.php</code>から検索キーワードを送信し，キーワードが含まれるデータのみ抽出されて表示されれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db連携_crud処理前半"><a class="header" href="#php_db連携_crud処理前半">PHP_DB連携_CRUD処理前半</a></h1>
<h2 id="本講義の内容とゴール-1"><a class="header" href="#本講義の内容とゴール-1">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-1"><a class="header" href="#本講義の内容-1">本講義の内容</a></h3>
<ul>
<li>DBの基本的な扱い．</li>
<li>SQLを用いたDB操作（データ作成，データ参照）．</li>
<li>PHP上でのSQL実行とtodoリスト（Webアプリケーション）の連携を実装．</li>
</ul>
<h3 id="本講義のゴール-1"><a class="header" href="#本講義のゴール-1">本講義のゴール</a></h3>
<ul>
<li>DBの構成や動き方を理解する！</li>
<li>SQLでDBを操作する基本を理解する！</li>
<li>PHPでDBを操作できるようになる！</li>
</ul>
<h2 id="準備-1"><a class="header" href="#準備-1">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="dbの基本"><a class="header" href="#dbの基本">DBの基本</a></h1>
<h2 id="dbとは"><a class="header" href="#dbとは">DBとは</a></h2>
<ul>
<li>web上にデータを保存するためのもの．</li>
<li>構造はエクセルなどと対比するとイメージしやすい！</li>
<li>データを操作するにはSQL（言語）を用いる．</li>
</ul>
<h2 id="使い所"><a class="header" href="#使い所">使い所</a></h2>
<ul>
<li>webアプリケーションでデータを保存する場合のほとんど．</li>
</ul>
<h3 id="利用シーンの例"><a class="header" href="#利用シーンの例">利用シーンの例</a></h3>
<ul>
<li>ECサイトの商品データ（商品名，画像，説明文）</li>
<li>サービスに登録しているユーザの情報（ユーザ名，アドレス，etc）</li>
<li>ブログの投稿内容（投稿日時，タイトル，画像，本文，etc）</li>
</ul>
<h2 id="dbのデータ構造と概念"><a class="header" href="#dbのデータ構造と概念">DBのデータ構造と概念</a></h2>
<p>エクセルと同様のデータ構造となっている．実際にデータが格納されるのは「テーブル」であり，テーブルをどう設計するかがアプリケーションの根幹となる．</p>
<table><thead><tr><th>DBの概念</th><th>エクセルの概念</th></tr></thead><tbody>
<tr><td>データベース</td><td>エクセルファイル</td></tr>
<tr><td>テーブル</td><td>シート</td></tr>
<tr><td>レコード</td><td>行</td></tr>
<tr><td>カラム</td><td>列</td></tr>
</tbody></table>
<h3 id="-key-point-4"><a class="header" href="#-key-point-4">💡 Key Point</a></h3>
<blockquote>
<p>テーブル設計を行う際には，エクセルやスプレッドシートに書き出しながら作業すると視覚的に確認できるのでオススメ．</p>
</blockquote>
<h3 id="データ構造の例"><a class="header" href="#データ構造の例">データ構造の例</a></h3>
<p>ECサイトの商品データをイメージしたテーブルを下記に示す．</p>
<p>（下記のデーブル構造はまだ改善点があるが，後の講義で解説する．）</p>
<table><thead><tr><th align="right">id</th><th>product_name</th><th align="right">price</th><th>category</th><th>image_url</th></tr></thead><tbody>
<tr><td align="right">1</td><td>Laphroaig</td><td align="right">40</td><td>whisky</td><td>./images/laphroaig.png</td></tr>
<tr><td align="right">2</td><td>Ardbeg</td><td align="right">45</td><td>whisky</td><td>./images/ardbeg.png</td></tr>
<tr><td align="right">3</td><td>Caolila</td><td align="right">50</td><td>whisky</td><td>./images/caolila.png</td></tr>
<tr><td align="right">4</td><td>Kilchoman</td><td align="right">50</td><td>whisky</td><td>./images/kilchoman.png</td></tr>
<tr><td align="right">5</td><td>Bowmore</td><td align="right">45</td><td>whisky</td><td>./images/bowmore.png</td></tr>
<tr><td align="right">6</td><td>PortCharlotte</td><td align="right">55</td><td>whisky</td><td>./images/portcharlotte.png</td></tr>
<tr><td align="right">...</td><td>...</td><td align="right">..</td><td>...</td><td>...</td></tr>
</tbody></table>
<h3 id="dbの動き方のイメージ"><a class="header" href="#dbの動き方のイメージ">DBの動き方のイメージ</a></h3>
<p>「サーバ」には3種類存在し，相互に連携しながらWebアプリケーションを動作させている．ただし，Webサーバとアプリケーションサーバは区別の概念が難しいため，一旦「DBサーバとそれ以外」という理解で進めてしまってOK．</p>
<ul>
<li>「Webサーバ」：ブラウザにデータを返す．</li>
<li>「アプリケーションサーバ」：PHPなどのサーバサイド言語を動かす．</li>
<li>「DBサーバ」：データを提供する．</li>
</ul>
<p>ブラウザ，PHP，DBが連携するイメージを以下に示す．</p>
<p><img src="php/php02/./img/php_crud01_about-db.svg" alt="DBの動き方イメージ" /></p>
<h3 id="-key-point-5"><a class="header" href="#-key-point-5">💡 Key Point</a></h3>
<blockquote>
<p>処理の流れを把握しよう！</p>
<p>例えば，PHPとDBを連携させ，保存されているデータを画面に表示する流れは以下のとおりとなる．</p>
<ol>
<li>PHPからDBサーバに接続する．</li>
<li>DBを操作するSQLを実行し，必要なデータを取得する．</li>
<li>取得したデータをHTML上に反映させ，画面に表示する．</li>
</ol>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db--テーブルの作成"><a class="header" href="#db--テーブルの作成">DB / テーブルの作成</a></h1>
<h2 id="dbの作成"><a class="header" href="#dbの作成">DBの作成</a></h2>
<p>まずは基本単位となるDBを作成する．</p>
<p>1つのアプリケーションに対して1つのDB，というイメージでOK．</p>
<ul>
<li><a href="http://localhost/phpmyadmin/">http://localhost/phpmyadmin/</a>にアクセス</li>
<li>「<code>Databases</code>」タブをクリック</li>
<li>「<code>Database name</code>」に「<code>dec_todo</code>」を入力（DB名）</li>
<li>「<code>utf8mb4_unicode_ci</code>」を選択→「作成」をクリック</li>
</ul>
<p>正常に作成されると，画面左側に作成したDB名が表示される．</p>
<h2 id="テーブルとカラムの作成"><a class="header" href="#テーブルとカラムの作成">テーブルとカラムの作成</a></h2>
<p>今回実装するtodoリストのデータ用テーブルを準備する．</p>
<p>テーブルは1つのDB内に複数作成し，相互に連携してWebアプリケーションのデータを構築する．</p>
<h3 id="テーブルの作成"><a class="header" href="#テーブルの作成">テーブルの作成</a></h3>
<p>以下の手順でテーブルを作成しよう．</p>
<ol>
<li>左側のDB一覧から前項で作成したDBを選択する．</li>
<li>名前欄に「<code>todo_table</code>」を入力（テーブル名）．</li>
<li>カラム数を「5」に設定する．</li>
<li>「Go」ボタンをクリック．</li>
</ol>
<h3 id="カラムの設定"><a class="header" href="#カラムの設定">カラムの設定</a></h3>
<p>テーブルに格納されるデータは定められた形式（文字列，数値，日付など）で保存しなければならない．</p>
<p>カラム設定時，各カラムに「名前」と「データ型」を設定する必要がある．下記の表に従ってカラム名とデータ型を設定しよう．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>todo</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>deadline</code></td><td>DATE</td><td>-</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<ul>
<li>idは単一のデータを取得するためのもので，インデックスを「PRIMARY」に設定する必要がある．</li>
<li>また，idは自動的に数値を1から順に振るため，「A_I（Auto Increment）」にチェックしておく</li>
</ul>
<p>全て入力したら右下の「保存する」をクリック！！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="sqlによるdb操作"><a class="header" href="#sqlによるdb操作">SQLによるDB操作</a></h1>
<h2 id="sqlとは"><a class="header" href="#sqlとは">SQLとは</a></h2>
<p>DBの操作には「SQL（言語）」を使用する．</p>
<p>PHPでDBを操作するときは，コード内でSQL文を実行する．</p>
<p>フレームワークなどではコード内では実行しない場合もある．ただし，フレームワークが関数の実行結果としてSQLを生成して実行するため，DB操作は必ずSQLで行われる．</p>
<h2 id="基本のsql4種"><a class="header" href="#基本のsql4種">基本のSQL4種</a></h2>
<p>まずはデータ操作の基本となる4種類を押さえましょう！</p>
<ul>
<li><code>INSERT</code>：データの「作成」</li>
<li><code>SELECT</code>：データの「参照」</li>
<li><code>UPDATE</code>：データの「更新」</li>
<li><code>DELETE</code>：データの「削除」</li>
</ul>
<p>※SQL文は大文字で記載していますが，小文字でも動作する．他の言語（本講座ではPHP）と組み合わせる際に区別しやすいよう大文字で記載している．他の言語でも大文字で扱うことが多い．</p>
<h2 id="insertデータの作成"><a class="header" href="#insertデータの作成">INSERT（データの作成）</a></h2>
<p>指定したテーブルに対して新規データの作成を行う．</p>
<p>ポイントは以下！</p>
<ul>
<li>「カラム名の数と順序」と「値の数と順序」を一致させる必要がある．</li>
<li><code>id</code>カラムはDB側でAuto incrementの設定をしているため<code>NULL</code>を送信する．</li>
<li>作成日時や更新日時は<code>now()</code>を使用して実行時の日付時刻が入力されるようにする．</li>
</ul>
<pre><code class="language-sql">
-- INSERT文の基本構造
INSERT INTO テーブル名 (カラム1, カラム2, ...) VALUES (値1, 値2, ...);

-- 例
INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES(NULL, 'SQL練習', '2021-12-31', now(), now());

</code></pre>
<h2 id="selectデータの参照"><a class="header" href="#selectデータの参照">SELECT（データの参照）</a></h2>
<p>SELECT文はデータの参照に使用されるが，フィルタリングやソートなど多様なオプションが用意されている．</p>
<h3 id="select文の基本"><a class="header" href="#select文の基本">SELECT文の基本</a></h3>
<pre><code class="language-sql">-- SELECT文の基本構造
SELECT 表示するカラム名 FROM テーブル名;

-- 例

-- 「*」で全て指定
SELECT * FROM todo_table;

-- 1つのカラムを指定
SELECT todo FROM todo_table;

-- 複数カラム指定
SELECT todo, deadline FROM todo_table;

</code></pre>
<h3 id="フィルタリング"><a class="header" href="#フィルタリング">フィルタリング</a></h3>
<p>データの条件を設定してフィルタリングをおこなうことができる．フィルタリングには<code>WHERE</code>を使用する．</p>
<pre><code class="language-sql">-- 「WHERE」を使用して値の条件を指定できる
SELECT * FROM todo_table WHERE deadline='2021-12-31';

-- 演算子の使用
SELECT * FROM todo_table WHERE deadline &lt;= '2021-12-31';
SELECT * FROM todo_table WHERE deadline &gt;= '2021-12-01' AND deadline &lt;= '2021-12-31';

-- あいまい検索
SELECT * FROM todo_table WHERE todo LIKE 'PHP%';
SELECT * FROM todo_table WHERE todo LIKE '%提出';
SELECT * FROM todo_table WHERE todo LIKE '%課題%';

</code></pre>
<h3 id="ソート"><a class="header" href="#ソート">ソート</a></h3>
<p>並び替えには<code>ORDER BY</code>を使用する．</p>
<ul>
<li>基準となるカラム名を指定し，</li>
<li>昇順（<code>ASC</code>）か降順（<code>DESC</code>）を指定する．</li>
</ul>
<pre><code class="language-sql">-- ORDER BYを使用した並び替え
-- `deadline`カラムの値で降順に並び替え
SELECT * FROM todo_table ORDER BY deadline DESC;
-- `todo`カラムの値で昇順に並び替え
SELECT * FROM todo_table ORDER BY todo ASC;

</code></pre>
<h3 id="取得するデータ件数の制限"><a class="header" href="#取得するデータ件数の制限">取得するデータ件数の制限</a></h3>
<p><code>LIMIT</code>を用いてデータ件数の制限を行うことができる．最新10件，などの使い方がメジャー．</p>
<pre><code class="language-sql">-- LIMITで表示件数の制限
SELECT * FROM todo_table LIMIT 5;

-- 並び替えとの組み合わせ
SELECT * FROM todo_table ORDER BY deadline DESC LIMIT 5;

</code></pre>
<h2 id="updateデータの更新"><a class="header" href="#updateデータの更新">UPDATE（データの更新）</a></h2>
<p>UPDATEは次回の講義で扱う．</p>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="deleteデータの削除"><a class="header" href="#deleteデータの削除">DELETE（データの削除）</a></h2>
<p>DELETEは次回の講義で扱う．</p>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="参考sqlの練習"><a class="header" href="#参考sqlの練習">【参考】SQLの練習</a></h2>
<p><a href="https://sqlzoo.net/">https://sqlzoo.net/</a></p>
<p>初歩から応用までSQL問題が出題．当面は最初の方の基本的なデータ取得ができればOK．</p>
<h2 id="練習-1"><a class="header" href="#練習-1">練習</a></h2>
<p>SQLはphpmyadminの「SQLタブ」から記述&amp;実行できる．</p>
<ol>
<li>INSERT文を用いて<code>todo_table</code>にデータを10件程度作成しよう．</li>
<li>SELECT文を用いて作成したデータを取り出そう．
<ul>
<li>WHERE, ORDER BY, LIMITを試して，想定どおりのデータを取得できるかどうか確認！</li>
</ul>
</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携データ作成処理"><a class="header" href="#phpとdbの連携データ作成処理">PHPとDBの連携（データ作成処理）</a></h1>
<h2 id="必要なファイル"><a class="header" href="#必要なファイル">必要なファイル</a></h2>
<ul>
<li><code>todo_input.php</code>：データ入力画面．</li>
<li><code>todo_create.php</code>：DB接続，データ作成処理を実行．</li>
</ul>
<h2 id="処理の流れ-1"><a class="header" href="#処理の流れ-1">処理の流れ</a></h2>
<ol>
<li><code>todo_input.php</code>で入力されたデータを<code>todo_create.php</code>へ送信（post）．</li>
<li><code>todo_create.php</code>でデータを受け取り，DBへの新規データ作成．</li>
<li>作成完了後，<code>todo_input.php</code>（入力画面）へ移動．（<code>todo_create.php</code>では画面表示なし）</li>
</ol>
<h2 id="送信側の処理-2"><a class="header" href="#送信側の処理-2">送信側の処理</a></h2>
<p>フォームからデータを送信する．以下3点の漏れやスペルミスがないよう確認しよう．</p>
<ul>
<li>action</li>
<li>method</li>
<li>name</li>
</ul>
<pre><code class="language-php">// todo_input.php

&lt;form action=&quot;todo_create.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<h2 id="受信側の処理-2"><a class="header" href="#受信側の処理-2">受信側の処理</a></h2>
<p>データ受け取り側では以下の処理を実装する．</p>
<ul>
<li>必須項目の入力チェック</li>
<li>データの受け取り</li>
<li>DB接続</li>
<li>SQL作成&amp;実行</li>
<li>SQL実行後の処理</li>
</ul>
<h3 id="入力チェック"><a class="header" href="#入力チェック">入力チェック</a></h3>
<p>DBにデータを格納する場合，基本的にデータの欠損は許されない（データなしを許可する設定もある）．</p>
<p>そのため，以下の条件に合致する場合は以降の処理を中止してエラー画面を表示する．</p>
<ul>
<li>必須項目（todoとdeadline）のデータが送信されていない．</li>
<li>必須項目（todoとdeadline）が空で送信されている．</li>
</ul>
<pre><code class="language-php">// todo_create.php

if (
  !isset($_POST['todo']) || $_POST['todo']=='' ||
  !isset($_POST['deadline']) || $_POST['deadline']==''
) {
  exit('ParamError');
}

</code></pre>
<h3 id="参考エラーメッセージを出力する意味"><a class="header" href="#参考エラーメッセージを出力する意味">【参考】エラーメッセージを出力する意味</a></h3>
<p>どこで失敗したのかをわかるようにする！</p>
<ul>
<li>PHPではエラーを見つけづらい．．．</li>
<li>データを扱うので，異常なデータなどが作成されるとまずい．</li>
<li>どこでエラーが出ているのかわからないと詰む．</li>
<li>エラーにも種類がある！
<ul>
<li>どこでうまくいっていないのかを把握できるようにエラーの処理を記述！</li>
</ul>
</li>
</ul>
<h3 id="データ受け取り"><a class="header" href="#データ受け取り">データ受け取り</a></h3>
<p>前回講義のtxtファイルの場合と同様．POSTで送信しているため<code>$_POST</code>で受け取る．</p>
<pre><code class="language-php">// todo_create.php

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

</code></pre>
<h3 id="db接続"><a class="header" href="#db接続">DB接続</a></h3>
<p>DBに接続するコードは決まった形式（<code>PDO</code>）．</p>
<p>接続の際には以下の情報が必要になる．今回は<code>dbname</code>のみ設定が必要．</p>
<ul>
<li><code>dbname</code>：DBの名前（今回はここを<code>dec_todo</code>に設定する！）</li>
<li><code>port</code>：接続ポート</li>
<li><code>host</code>：DBのホスト名</li>
<li><code>username</code>：DB接続時のユーザ名</li>
<li><code>password</code>：DB接続時のパスワード</li>
</ul>
<pre><code class="language-php">// todo_create.php

// 各種項目設定
$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

// DB接続
try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

// 「dbError:...」が表示されたらdb接続でエラーが発生していることがわかる．

</code></pre>
<h3 id="sql作成実行"><a class="header" href="#sql作成実行">SQL作成&amp;実行</a></h3>
<p>SQL（今回はINSERT文）を実行する場合も手順が決まっている．</p>
<ol>
<li>SQL文の記述．</li>
<li>バインド変数の設定．</li>
<li>SQL実行．</li>
</ol>
<pre><code class="language-php">// todo_create.php

// SQL作成&amp;実行
$sql = 'INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES (NULL, :todo, :deadline, now(), now())';

$stmt = $pdo-&gt;prepare($sql);

// バインド変数を設定
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);

// SQL実行（実行に失敗すると$statusにfalseが返ってくる）
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="補足バインド変数とsqlインジェクション"><a class="header" href="#補足バインド変数とsqlインジェクション">【補足】バインド変数とSQLインジェクション</a></h3>
<p>SQLインジェクションと呼ばれるハッキング手法が存在する．</p>
<p>例えば，下記のようにコードを記述されている場合．．．</p>
<pre><code class="language-php">$query = &quot;SELECT * FROM user WHERE id = '$user_id'&quot;;
</code></pre>
<p><code>$user_id</code>に「<code>' or 'A' = 'A</code>」を入れると，下記と同じ意味になってしまう！</p>
<pre><code class="language-sql">SELECT * FROM user;
</code></pre>
<p>-&gt; 不正にユーザのデータを取得できてしまう！！！</p>
<p>バインド変数を用いることで，SQL文として実行されないようにできる！</p>
<p>ユーザが入力した値をSQL文内で使用する場合には必ずバインド変数を使用すること．</p>
<h3 id="sql実行時の処理"><a class="header" href="#sql実行時の処理">SQL実行時の処理</a></h3>
<p>実行に失敗すると<code>$status</code>に<code>false</code>が返ってくるため，条件分岐して失敗を検出する．</p>
<p><code>$stmt-&gt;errorInfo()</code>と記述することでエラー内容（配列形式）を取得することができ，2番めのデータにエラーメッセージが格納されている．</p>
<p>SQLが正常に実行された場合は，データ入力画面に移動することとする．</p>
<pre><code class="language-php">// todo_create.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  header('Location:todo_input.php');
}

</code></pre>
<h2 id="練習-2"><a class="header" href="#練習-2">練習</a></h2>
<p>DBにデータを追加する処理を実装しよう！</p>
<ol>
<li><code>todo_input.php</code>にフォームを作成</li>
<li><code>todo_create.php</code>で
<ul>
<li>データを受け取る</li>
<li>DBに接続</li>
<li>SQL文を書いて実行</li>
</ul>
</li>
</ol>
<p>phpmyadminでテーブルを確認し，データが作成されていればOK！</p>
<ul>
<li>phpmyadminの「表示」タブをクリックすると最新のデータを読み込める．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携データ参照処理"><a class="header" href="#phpとdbの連携データ参照処理">PHPとDBの連携（データ参照処理）</a></h1>
<h2 id="必要なファイル-1"><a class="header" href="#必要なファイル-1">必要なファイル</a></h2>
<ul>
<li><code>todo_read.php</code>：DBからデータを取得してデータの一覧画面を作成する．</li>
</ul>
<h2 id="処理の流れ-2"><a class="header" href="#処理の流れ-2">処理の流れ</a></h2>
<ol>
<li>表示ファイル（<code>todo_read.php</code>）へアクセス時，DB接続する．</li>
<li>データ参照用SQL作成→実行．</li>
<li>取得したデータをHTMLに埋め込んで画面を表示．</li>
</ol>
<p>※必要に応じて，並び替えやフィルタリングを実施してみよう．</p>
<h2 id="dbデータ作成処理の実装"><a class="header" href="#dbデータ作成処理の実装">DBデータ作成処理の実装</a></h2>
<h3 id="db接続-1"><a class="header" href="#db接続-1">DB接続</a></h3>
<p>新規データ作成の場合と同様の処理（DB名の設定を忘れずに！）．</p>
<pre><code class="language-php">// todo_read.php

$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

</code></pre>
<h3 id="sql作成実行-1"><a class="header" href="#sql作成実行-1">SQL作成&amp;実行</a></h3>
<p>データ作成処理と同様にSQLを記述して実行する．今回は「ユーザが入力したデータ」を使用しないのでバインド変数は不要．</p>
<p>また，<code>$status</code>には実行結果が入るが，この時点ではまだデータ自体の取得はできていない点に注意．</p>
<pre><code class="language-php">// todo_read.php

$sql = 'SELECT * FROM todo_table';
$stmt = $pdo-&gt;prepare($sql);
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="sql実行後の処理"><a class="header" href="#sql実行後の処理">SQL実行後の処理</a></h3>
<p>SQLの実行に失敗した場合はエラーを表示して処理を中止する．</p>
<p>SQLが正常に実行された場合は以下の流れで処理が実行される．</p>
<ul>
<li><code>fetchAll()</code>関数でデータ自体を取得する．</li>
<li>繰り返し処理を用いて，取得したデータからHTMLタグを生成する．</li>
<li>（HTML内の任意の位置に作成したタグを設置</li>
</ul>
<pre><code class="language-php">// todo_read.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
  $output = &quot;&quot;;
  foreach ($result as $record) {
    $output .= &quot;
      &lt;tr&gt;
        &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
        &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;/tr&gt;
    &quot;;
  }
}

</code></pre>
<h3 id="htmlにタグを埋め込み"><a class="header" href="#htmlにタグを埋め込み">HTMLにタグを埋め込み</a></h3>
<pre><code class="language-php">// todo_read.php

// html部分にデータを追加
&lt;tbody&gt;
  &lt;!-- ↓に&lt;tr&gt;&lt;td&gt;deadline&lt;/td&gt;&lt;td&gt;todo&lt;/td&gt;&lt;tr&gt;の形でデータが入る --&gt;
  &lt;?= $output ?&gt;
&lt;/tbody&gt;

</code></pre>
<h3 id="参考jsを用いたタグ生成"><a class="header" href="#参考jsを用いたタグ生成">【参考】JSを用いたタグ生成</a></h3>
<p>上記では「PHP内でタグを生成 → HTML内に埋め込み」という実装を行っているが，タグ生成部分をJSで行うこともできる．</p>
<p>どちらが正解というものではないので，自身のイメージしやすいパターンで実装すれば問題ない．</p>
<pre><code class="language-php">&lt;?php

// DB接続，SQL実行など

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  // PHPではデータを取得するところまで実施
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
}

?&gt;

&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;table&gt;
      &lt;tbody id=&quot;output&quot;&gt;&lt;/tbody&gt;
    &lt;table&gt;

    &lt;script&gt;
      // PHPのデータをJSに渡す
      const resultArray = &lt;?=json_encode($result) ?&gt;;
      // 配列からタグ生成し，#outputに表示する
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;


</code></pre>
<h2 id="練習-3"><a class="header" href="#練習-3">練習</a></h2>
<p>DBのデータを読み出して表示する処理を実装しよう！</p>
<p><code>todo_read.php</code>で</p>
<ul>
<li>DBに接続</li>
<li>SQL文を書いて実行</li>
<li>取得したデータをHTMLに埋め込み</li>
</ul>
<p>テーブルのデータが画面に一覧で表示されればOK！</p>
<p>できた人はSQL文を編集してフィルタリングやソートなどを実装してみよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db連携_crud処理後半"><a class="header" href="#php_db連携_crud処理後半">PHP_DB連携_CRUD処理後半</a></h1>
<h2 id="本講義の内容とゴール-2"><a class="header" href="#本講義の内容とゴール-2">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-2"><a class="header" href="#本講義の内容-2">本講義の内容</a></h3>
<ul>
<li>DB内のデータを更新する処理，削除する処理を実装する．</li>
<li>関数専用のファイルを作成し，読み込みを実行を行う．</li>
<li>todoリストの基本的な機能について実装を完了する．</li>
</ul>
<h3 id="本講義のゴール-2"><a class="header" href="#本講義のゴール-2">本講義のゴール</a></h3>
<ul>
<li>基本的なCRUD処理を実装し，処理の流れを理解する．</li>
<li>複数のファイルで使用する共通のコードの管理手法を学ぶ．</li>
<li>オリジナルWebサービスの構想からCRUD処理の設計につなげる．</li>
</ul>
<h3 id="todoアプリケーションの全体像"><a class="header" href="#todoアプリケーションの全体像">todoアプリケーションの全体像</a></h3>
<p><img src="php/php03/./img/php_crud02_app_construct.svg" alt="todoアプリ全体像" /></p>
<h2 id="準備-2"><a class="header" href="#準備-2">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db接続関数の作成"><a class="header" href="#db接続関数の作成">DB接続関数の作成</a></h1>
<h2 id="db接続は常に同じコード"><a class="header" href="#db接続は常に同じコード">DB接続は常に同じコード</a></h2>
<p>実は．．．</p>
<ul>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で記述したDB接続のコードは全く同じ！</li>
<li>今回作成する<code>todo_edit.php</code>, <code>todo_update.php</code>, <code>todo_delete.php</code>も同じ記述！</li>
</ul>
<p>であれば．．！</p>
<p>一つの関数にまとめられる！</p>
<p>=&gt; 関数用のファイルを作成しよう！（<code>functions.php</code>）</p>
<h2 id="関数の定義"><a class="header" href="#関数の定義">関数の定義</a></h2>
<p>DB接続の処理は様々なファイルで実行されるため，関数専用のファイル（<code>functions.php</code>）に記述して他のファイルから読み込むと効率が良い．</p>
<p>関数を実行すると，DB接続情報を出力するように実装すると良い（<code>return new PDO...</code>部分）．</p>
<pre><code class="language-php">// functions.php

function connect_to_db()
{
  $dbn='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
  $user = 'root';
  $pwd = '';
  try {
    return new PDO($dbn, $user, $pwd);
  } catch (PDOException $e) {
    exit('dbError:'.$e-&gt;getMessage());
  }
}

</code></pre>
<h2 id="関数の実行"><a class="header" href="#関数の実行">関数の実行</a></h2>
<p>上で定義した関数はDB接続が必要なファイルで<code>functions.php</code>を読み込むことで実行可能．</p>
<p>別ファイルの読み込みは<code>include()</code>関数を用いる．</p>
<pre><code class="language-php">// DB接続したいファイル（todo_create.php, todo_read.php, など）

include('functions.php');
$pdo = connect_to_db();

// 他のDB接続が必要なファイルでも上記の2行でOK！

</code></pre>
<h2 id="練習-4"><a class="header" href="#練習-4">練習</a></h2>
<ol>
<li><code>functions.php</code>にDB接続の関数を定義しよう！</li>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で<code>functions.php</code>を<code>include()</code>し，関数を実行しよう！</li>
</ol>
<p>今まで通りの動きが確認できればOK！</p>
<p>（これまでやっていた処理を関数にしただけなので，実行される内容はこれまでと変化なし）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携3編集画面の作成"><a class="header" href="#phpとdbの連携3編集画面の作成">PHPとDBの連携3（編集画面の作成）</a></h1>
<h2 id="処理の流れ-3"><a class="header" href="#処理の流れ-3">処理の流れ</a></h2>
<p>データ更新の処理はデータ作成処理の流れと似ている！</p>
<p>まずは本項で1と2を実装する．</p>
<ol>
<li>一覧画面に更新ページへのリンクを作成（urlにidを追加： todo_edit.php?id=**）</li>
<li>更新ページの作成（todo_edit.php）</li>
<li>更新処理の作成（todo_update.php）</li>
<li>一覧画面に戻る</li>
</ol>
<h2 id="一覧画面にリンク追加"><a class="header" href="#一覧画面にリンク追加">一覧画面にリンク追加</a></h2>
<p><code>&lt;a&gt;</code>を用いて編集画面（と削除処理）へのリンクを作成する．</p>
<p>GETメソッドが「データをURLに格納する」仕様を利用し，<code>&lt;a&gt;</code>のURLに各データの<code>id</code>を埋め込む．</p>
<pre><code class="language-php">// todo_read.php

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;
      &lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<p>下図のようにリンクが表示されればOK．</p>
<p>リンクにマウスカーソルを当てると，ブラウザ左下にリンク先のURLが表示される．<code>id=**</code>の形で数値が表示されれば正しく指定されている．</p>
<p><img src="php/php03/./img/php_crud02_todo_read.png" alt="一覧画面リンク表示" /></p>
<h2 id="編集画面の作成"><a class="header" href="#編集画面の作成">編集画面の作成</a></h2>
<p>続いて，編集画面を実装する．</p>
<p>本画面の役割は</p>
<ul>
<li>現在テーブルに保存されている<code>todo</code>と<code>deadline</code>を表示する．</li>
<li>ユーザが画面上でデータを編集する．</li>
<li>ユーザが編集したデータをテーブル更新用ファイル（<code>todo_update.php</code>）に送信する．</li>
</ul>
<p>コードのポイントは以下．</p>
<ul>
<li>SELECT文を用いて<code>id</code>指定し，<code>fetch()</code>関数でデータを取得する．</li>
<li>取得したデータを<code>&lt;input&gt;</code>の初期値として設定する．</li>
<li>次の更新処理で<code>id</code>が必要になるため，<code>&lt;input type=&quot;hidden&quot;&gt;</code>を用いて<code>id</code>を送信する．</li>
</ul>
<pre><code class="language-php">include(&quot;functions.php&quot;);

$id = $_GET['id'];

$pdo = connect_to_db();

$sql = 'SELECT * FROM todo_table WHERE id=:id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_INT);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $record = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
}
?&gt;

// 以下HTML部分
&lt;form action=&quot;todo_update.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;DB連携型todoリスト（編集画面）&lt;/legend&gt;
    &lt;a href=&quot;todo_read.php&quot;&gt;一覧画面&lt;/a&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot; value=&quot;&lt;?= $record['todo'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot; value=&quot;&lt;?= $record['deadline'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?= $record['id'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<p>下図のように現在のデータが画面に表示されればOK．</p>
<p><img src="php/php03/./img/php_crud02_todo_edit.png" alt="編集画面データ表示" /></p>
<h2 id="練習-5"><a class="header" href="#練習-5">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>一覧画面に<code>todo_edit.php</code>へのリンクを追加！（<code>todo_delete.php</code>へのリンクも一緒に！）</li>
<li><code>todo_edit.php</code>ではデータをIDで検索し，該当するデータを画面に表示！</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携4データ更新処理の作成"><a class="header" href="#phpとdbの連携4データ更新処理の作成">PHPとDBの連携4（データ更新処理の作成）</a></h1>
<h2 id="データ更新のsql"><a class="header" href="#データ更新のsql">データ更新のSQl</a></h2>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="更新の処理"><a class="header" href="#更新の処理">更新の処理</a></h2>
<p>前項の編集画面からデータを受け取り，DBのデータを更新する．</p>
<p>処理の流れは<code>todo_create.php</code>とよく似ている．</p>
<h3 id="データチェックと受け取り"><a class="header" href="#データチェックと受け取り">データチェックと受け取り</a></h3>
<p>まずは<code>todo</code>，<code>deadline</code>，<code>id</code>のデータが揃っていることを確認し，データを受け取る．</p>
<pre><code class="language-php">// todo_update.php

if (
  !isset($_POST['todo']) || $_POST['todo'] == '' ||
  !isset($_POST['deadline']) || $_POST['deadline'] == '' ||
  !isset($_POST['id']) || $_POST['id'] == ''
) {
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;no input&quot;]);
  exit();
}

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];
$id = $_POST['id'];

</code></pre>
<h3 id="db接続とsql実行"><a class="header" href="#db接続とsql実行">DB接続とSQL実行</a></h3>
<p>続いてDB接続し，UPDATEのSQLを実行する．SQLが正常に実行された場合は一覧画面に移動する．</p>
<h3 id="-key-point-6"><a class="header" href="#-key-point-6">💡 Key Point</a></h3>
<blockquote>
<p>必ずWHEREでidを指定すること！！！</p>
</blockquote>
<pre><code class="language-php">// todo_update.php

include('functions.php');
$pdo = connect_to_db();

$sql = 'UPDATE todo_table SET todo=:todo, deadline=:deadline, updated_at=now() WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header('Location:todo_read.php');
  exit();
}

</code></pre>
<h2 id="練習-6"><a class="header" href="#練習-6">練習</a></h2>
<p><code>todo_update.php</code>でUPDATEの処理を実装しよう！</p>
<p>更新処理実行後，一覧ページでデータが更新されていればOK！</p>
<p>（phpmyadminでも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携5データ削除処理"><a class="header" href="#phpとdbの連携5データ削除処理">PHPとDBの連携5（データ削除処理）</a></h1>
<h2 id="データ削除のsql"><a class="header" href="#データ削除のsql">データ削除のSQL</a></h2>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="処理の流れ-4"><a class="header" href="#処理の流れ-4">処理の流れ</a></h2>
<ol>
<li>✅ 一覧画面に削除ページへのリンクを作成（urlにidを追加<code>todo_delete.php?id=**</code>）</li>
<li>削除処理の作成（<code>todo_delete.php</code>）</li>
<li>テーブルのデータを削除したら一覧画面に戻る</li>
</ol>
<h2 id="削除の実装"><a class="header" href="#削除の実装">削除の実装</a></h2>
<p>削除に必要なのは<code>id</code>のみである．編集画面に移動する場合と同様にGETで<code>id</code>を受け取る．</p>
<p>データを受け取ったら，下記の順で処理を記述する．</p>
<ul>
<li>DB接続</li>
<li>SQL実行（DELETE文）</li>
<li>一覧画面へ移動</li>
</ul>
<h3 id="-key-point-7"><a class="header" href="#-key-point-7">💡 Key Point</a></h3>
<blockquote>
<p>⚠️ DELETE文を実行する場合には必ずWHEREで<code>id</code>を指定すること．</p>
</blockquote>
<pre><code class="language-php">$id = $_GET['id'];

include('functions.php');
$pdo = connect_to_db();

$sql = 'DELETE FROM todo_table WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-7"><a class="header" href="#練習-7">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>✅ 一覧画面に<code>todo_delete.php</code>へのリンクを追加！</li>
<li><code>todo_delete.php</code>ではデータをIDで検索し，該当するデータを削除！</li>
<li>完了したら<code>todo_read.php</code>へ戻る．</li>
</ol>
<p>削除処理実行後，一覧ページでデータが削除されていればOK！</p>
<p>（phpmyadminでも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_セッション"><a class="header" href="#php_セッション">PHP_セッション</a></h1>
<h2 id="本講義の内容とゴール-3"><a class="header" href="#本講義の内容とゴール-3">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-3"><a class="header" href="#本講義の内容-3">本講義の内容</a></h3>
<ul>
<li>セッション機能の確認．</li>
<li>ログイン処理，ログアウト処理の実装．</li>
<li>todoリストをログインしていないと使えないようにする．</li>
</ul>
<h3 id="本講義のゴール-3"><a class="header" href="#本講義のゴール-3">本講義のゴール</a></h3>
<ul>
<li>ページ間でデータ共有する方法を知る！</li>
<li>プロダクトの中で最適なデータの管理方法を選べるようになる！</li>
<li>「ログインしているとはなにか」をマスター！</li>
</ul>
<h2 id="準備-3"><a class="header" href="#準備-3">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッションとは"><a class="header" href="#セッションとは">セッションとは</a></h1>
<h2 id="セッションとはなにか"><a class="header" href="#セッションとはなにか">セッションとはなにか</a></h2>
<ul>
<li>サーバに変数などを保存できる仕組み．</li>
<li>サーバ自体に変数を定義する．</li>
<li>サーバ上にあるどのファイルからでも値を取り出せる！</li>
</ul>
<h3 id="普通の変数を使用した例"><a class="header" href="#普通の変数を使用した例">普通の変数を使用した例</a></h3>
<p>各ファイルで用意した変数はそのファイル内でしか使用できない．</p>
<table><thead><tr><th>file</th><th>data</th></tr></thead><tbody>
<tr><td>hoge.php</td><td>$number = 100;</td></tr>
<tr><td>fuga.php</td><td>$keyword = 'ジーズ';</td></tr>
<tr><td>piyo.php</td><td>$array = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td></tr>
</tbody></table>
<h3 id="セッション変数を活用"><a class="header" href="#セッション変数を活用">セッション変数を活用</a></h3>
<p>セッション領域自体にデータを保存することができ，サーバ上のどのファイルからでもアクセスすることができる．</p>
<p>セッション変数は<code>$_SESSION</code>で記述する（後述）．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッションの使用とsession_id"><a class="header" href="#セッションの使用とsession_id">セッションの使用と「session_id」</a></h2>
<p>セッションは下記の流れで使用する．</p>
<ol>
<li>セッションの開始．
<ul>
<li>セッションがスタートすると「セッション領域」が作られる．</li>
<li>セッション領域識別用のid（<code>session_id</code>）が発行される．</li>
<li>セッションの機能が使えるようになり，情報を保存できる．</li>
<li>session_idの再生成ができる．</li>
</ul>
</li>
<li>必要に応じてセッション変数（<code>$_SESSION</code>）にデータを保存．</li>
<li><code>session_id</code>の再生成
<ul>
<li>悪意あるサイトに<code>session_id</code>を読まれてしまうとハッキングのリスク．</li>
<li>ページ移動などのタイミングでidを再生成し，最新版だけを有効にする．</li>
</ul>
</li>
<li>セッションの終了．
<ul>
<li>保存されている情報などを破棄する．</li>
</ul>
</li>
</ol>
<h3 id="session_idの確認"><a class="header" href="#session_idの確認">session_idの確認</a></h3>
<p>まずはセッションの開始を宣言する．
セッションに関連する機能を使用する場合には必ず記述する必要がある．</p>
<pre><code class="language-php">session_start();
</code></pre>
<p>セッションを開始すると自動的にidが発行されてブラウザにidが保存される．</p>
<p>idはサーバとブラウザの双方に保存され，下記の方法で確認することができる．</p>
<ol>
<li>PHPファイル上で<code>session_id();</code>で取得可能．</li>
<li>ブラウザで「検証 → Application → Cookies → localhost」
<ul>
<li>現在有効なsession_idが保存されている．</li>
</ul>
</li>
</ol>
<h3 id="session_idの再生成"><a class="header" href="#session_idの再生成">session_idの再生成</a></h3>
<p>session_idがバレると他の人にsessionの中身をいじられてしまう可能性がある．．！</p>
<p><code>session_regenerate_id();</code>を使用するとidを再生成して更新できる．</p>
<p>（保存されているデータ自体は変更なし）</p>
<p>使い所</p>
<ul>
<li>ログインしたらid発行してログイン情報を管理．</li>
<li>ページ移動など特定の操作をしたタイミングで再生成して古いidを無効化する．</li>
</ul>
<pre><code class="language-php">// session_regenerate_id.php

&lt;?php
// セッションの開始
session_start();
$old_session_id = session_id();

// 再生成
session_regenerate_id(true);
$new_session_id = session_id();

// 新旧のidを画面に表示して更新されていることを確認
echo '&lt;p&gt;旧id' . $old_session_id . '&lt;/p&gt;';
echo '&lt;p&gt;新id' . $new_session_id . '&lt;/p&gt;';
exit();

?&gt;

</code></pre>
<h3 id="-key-point-8"><a class="header" href="#-key-point-8">💡 Key Point</a></h3>
<blockquote>
<p><code>session_regenerate_id(true);</code>の<code>true</code>が大切！！</p>
<p><code>true</code>を設定することで古いidを無効にすることができる．</p>
</blockquote>
<h3 id="セッションの終了"><a class="header" href="#セッションの終了">セッションの終了</a></h3>
<p>セッションの終了に際しては保存したデータの削除が必要になる．</p>
<p>以下の3つの手順でデータを削除する．</p>
<ol>
<li>セッション変数の削除．</li>
<li>ブラウザに保存されたセッションidの有効期間操作．</li>
<li>セッション領域の削除．</li>
</ol>
<p>これらの処理は後のステップで実装する．</p>
<pre><code class="language-php">// 指定したsession変数の削除
unset($_SESSION[key]);

// session情報の全削除
$_SESSION = array();

// ブラウザに保存した情報の有効期限を操作
setcookie(session_name(), '', time() - 42000, '/');

// session領域自体をを破壊
session_destroy();

</code></pre>
<p><a href="https://www.php.net/manual/ja/function.session-destroy.php">参考</a></p>
<h2 id="練習-8"><a class="header" href="#練習-8">練習</a></h2>
<p>下記の処理を実装してセッションとsession_idの挙動を確認しよう．</p>
<ul>
<li>idを発行して確認しよう！</li>
<li>再生成して旧idと新idを表示しよう！</li>
</ul>
<p>検証画面で確認し，リロードの度に新IDと一致すればOK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッション変数"><a class="header" href="#セッション変数">セッション変数</a></h1>
<p>セッション領域に保存される変数を使用することで，複数のファイルで横断的にデータを扱うことができる．</p>
<h2 id="セッション変数の形式"><a class="header" href="#セッション変数の形式">セッション変数の形式</a></h2>
<p>セッション変数は<code>$_SESSION</code>で記述する．</p>
<p>連想配列形式（JavaScriptのオブジェクトに相当）で扱われる．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッション変数の定義"><a class="header" href="#セッション変数の定義">セッション変数の定義</a></h2>
<p>セッション変数を扱う際にも<code>session_start();</code>は必須！</p>
<p>セッション変数は<code>$_SESSION['キー名']</code>の形式で宣言するが，使い方は通常の変数と同様である．</p>
<pre><code class="language-php">// session01.php

&lt;?php
session_start();

// セッション変数に値を代入
$_SESSION['keyword'] = 'PHP';

echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="セッション変数の使用"><a class="header" href="#セッション変数の使用">セッション変数の使用</a></h2>
<p>セッション変数はセッション領域に保存されているので，ファイル内で定義していなくても呼び出すことができる．</p>
<p>使い方は通常の変数と同様．</p>
<pre><code class="language-php">&lt;?php
// session02.php

session_start();

// `$_SESSION['keyword']`はセッション変数なので定義していなくても呼び出せる
$string = $_SESSION['keyword'] . '&amp;MySQL';
echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="練習-9"><a class="header" href="#練習-9">練習</a></h2>
<p>下記の処理を記述して，セッション変数の動き方を確認しよう．</p>
<ul>
<li><code>session01.php</code>でsession変数を定義しよう！</li>
<li><code>session02.php</code>で定義した変数を呼び出して出力しよう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装1ログインとログアウト"><a class="header" href="#認証処理の実装1ログインとログアウト">認証処理の実装1（ログインとログアウト）</a></h1>
<h2 id="必要なファイル-2"><a class="header" href="#必要なファイル-2">必要なファイル</a></h2>
<p>ログイン処理に<code>todo_login.php</code>と<code>todo_login.php</code>，ログアウト処理に<code>todo_logout.php</code>を使用する．</p>
<table><thead><tr><th>file</th><th>役割</th></tr></thead><tbody>
<tr><td><code>todo_login.php</code></td><td>ログイン情報（username, password）を入力して送信する．</td></tr>
<tr><td><code>todo_login_act.php</code></td><td>送信されたデータを受け取り，DB関連の処理を実行する．</td></tr>
<tr><td><code>todo_logout.php</code></td><td>セッション，ログイン情報を破棄する．</td></tr>
</tbody></table>
<h2 id="ログイン処理"><a class="header" href="#ログイン処理">ログイン処理</a></h2>
<h3 id="ログイン処理の流れ"><a class="header" href="#ログイン処理の流れ">ログイン処理の流れ</a></h3>
<ol>
<li>ログインフォーム情報を入力して送信（<code>todo_login.php</code>）</li>
<li>送信されたデータを受け取る（<code>todo_login_act.php</code>）</li>
<li>受け取ったデータがDBにあるかどうかチェック（<code>todo_login_act.php</code>）
<ul>
<li>成功時（DBにユーザのデータが存在した場合）
<ul>
<li>DBにログイン情報があればセッション変数に格納（<code>todo_login_act.php</code>）</li>
<li>セッション変数にログイン情報を保持して<code>todo_read.php</code>に移動</li>
</ul>
</li>
<li>失敗時（DBにユーザのデータが存在しなかった場合）
<ul>
<li><code>todo_login.php</code>に戻るリンクを表示する（ログイン失敗）</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>ログインフォームに<code>action</code>，<code>method</code>，<code>name</code>を設定する．</p>
<p>データを<code>todo_login_act.php</code>に送信する．</p>
<pre><code class="language-php">// todo_login.php

&lt;form action=&quot;todo_login_act.php&quot; method=&quot;POST&quot;&gt;
  // ...
  &lt;div&gt;
    username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;	// name属性
  &lt;/div&gt;
  &lt;div&gt;
    password: &lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;	// name属性
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;Login&lt;/button&gt;
  &lt;/div&gt;
  // ...
&lt;/form&gt;

</code></pre>
<p>データを受け取ったら，ユーザのテーブルに該当するデータが存在するかどうかを確認する．</p>
<pre><code class="language-php">// todo_login_act.php

&lt;?php
session_start();
include('functions.php');

$username = $_POST['username'];
$password = $_POST['password'];

$pdo = connect_to_db();

// username，password，is_deletedの3項目全てを満たすデータを抽出する．
$sql = 'SELECT * FROM users_table WHERE username=:username AND password=:password AND is_deleted=0';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':username', $username, PDO::PARAM_STR);
$stmt-&gt;bindValue(':password', $password, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

</code></pre>
<p>データの有無で条件分岐する．</p>
<ul>
<li>データが存在しない場合はログイン画面へ移動するリンクを表示する．</li>
<li>データが存在した場合はセッション変数にsession_idとユーザのデータを入れ，一覧画面に移動する．</li>
</ul>
<pre><code class="language-php">if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $val = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
  if (!$val) {
    echo &quot;&lt;p&gt;ログイン情報に誤りがあります&lt;/p&gt;&quot;;
    echo &quot;&lt;a href=todo_login.php&gt;ログイン&lt;/a&gt;&quot;;
    exit();
  } else {
    $_SESSION = array();
    $_SESSION['session_id'] = session_id();
    $_SESSION['is_admin'] = $val['is_admin'];
    $_SESSION['username'] = $val['username'];
    header(&quot;Location:todo_read.php&quot;);
    exit();
  }
}

</code></pre>
<h3 id="-key-point-9"><a class="header" href="#-key-point-9">💡 Key Point</a></h3>
<blockquote>
<p><code>session_id</code>はこの後使用するので必ず保存しよう．</p>
<p>ユーザデータはアプリケーションに必要なものを適宜選別してセッションに保存する．</p>
</blockquote>
<h2 id="ログアウト"><a class="header" href="#ログアウト">ログアウト</a></h2>
<p>ログアウトの処理は前項のセッション終了のコードそのもの．</p>
<p>ユーザの痕跡をなくすことが肝要．</p>
<pre><code class="language-php">// todo_logout.php

&lt;?php
session_start();
$_SESSION = array();
if (isset($_COOKIE[session_name()])) {
  setcookie(session_name(), '', time() - 42000, '/');
}
session_destroy();
header('Location:todo_login.php');
exit();

</code></pre>
<h2 id="練習-10"><a class="header" href="#練習-10">練習</a></h2>
<p>ログインとログアウトの処理を実装しよう！</p>
<ol>
<li>ログインフォームを実装！（<code>todo_login.php</code>）</li>
<li>ログイン処理を実装！（<code>todo_login_act.php</code>）</li>
<li>ログアウト処理を実装！（<code>todo_logout.php</code>）</li>
</ol>
<p>以下の動作が確認できればOK．</p>
<ul>
<li>存在するユーザのusernameとpasswordを入力して一覧ページが表示される．</li>
<li>存在しないユーザのusernameとpasswordを入力してログインページへのリンクが表示される．</li>
</ul>
<p>ユーザデータがない場合は適当なデータを入れておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装2認証状態の確認"><a class="header" href="#認証処理の実装2認証状態の確認">認証処理の実装2（認証状態の確認）</a></h1>
<p>todoリストの機能はログインしているときのみアクセスできるようにしたい！</p>
<p>現状では，ログアウトした状態でもURLを手打ちするとアクセスできてしまう．．．</p>
<ul>
<li>登録画面，一覧画面などはログイン済ユーザのみ見られるようにする</li>
<li>ログインをチェックし，ログインしていない状態ならログイン画面に移動</li>
</ul>
<h2 id="ログインしているとはなにか"><a class="header" href="#ログインしているとはなにか">「ログインしている」とはなにか</a></h2>
<p>以下の2つの状態を「ログインしていない」とみなす！！</p>
<ul>
<li>「セッション変数に<code>session_id</code>を持っていない」</li>
<li>「idが最新ではない」はログインしていない状態</li>
</ul>
<h2 id="関数の定義-1"><a class="header" href="#関数の定義-1">関数の定義</a></h2>
<p>上記2条件を用いてログインの有無を判断する関数を作成する．</p>
<p>関数の役割は</p>
<ol>
<li>ログインしていない場合はログインページへ強制送還．</li>
<li>ログインしている場合は<code>session_id</code>を更新してセッション変数に保存する．
<ul>
<li>セッション変数には常に最新の<code>session_id</code>が入っている状態にする．</li>
</ul>
</li>
</ol>
<p>複数のファイルでチェックを行うため，関数ファイルに記述しよう！</p>
<pre><code class="language-php">// functions.php

function check_session_id()
{
  if (!isset($_SESSION[&quot;session_id&quot;]) ||$_SESSION[&quot;session_id&quot;] != session_id()) {
    header('Location:todo_login.php');
    exit();
  } else {
    session_regenerate_id(true);
    $_SESSION[&quot;session_id&quot;] = session_id();
  }
}

</code></pre>
<h2 id="関数の実行-1"><a class="header" href="#関数の実行-1">関数の実行</a></h2>
<p>あとは定義した関数を「ログインしていないときに動いてほしくないPHPファイル」で実行しよう．</p>
<p>セッションの機能を使用するため，<code>session_start();</code>を忘れないように注意！</p>
<p>下記ファイルで実行すると良き．</p>
<ul>
<li><code>todo_input.php</code></li>
<li><code>todo_read.php</code></li>
<li><code>todo_edit.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_update.php</code></li>
<li><code>todo_delete.php</code></li>
</ul>
<pre><code class="language-php">// ログインしていないときに動いてほしくないPHPファイル

&lt;?php
session_start();
include('functions.php');
check_session_id();

</code></pre>
<h3 id="-key-point-10"><a class="header" href="#-key-point-10">💡 Key Point</a></h3>
<blockquote>
<p>「ログインしているユーザだけがアクセスできる画面」と「誰でもアクセスできる画面」がそれぞれどの画面なのかを明確にすることが大切．</p>
<p>同様に管理者ユーザのみがアクセス可能な画面を切り分けることも同様の方法で可能．</p>
</blockquote>
<h2 id="練習-11"><a class="header" href="#練習-11">練習</a></h2>
<p>メインのコンテンツは未ログインだとアクセスできないようにしよう！</p>
<ul>
<li>ログイン状態を確認する関数をつくろう！（functions.php）</li>
<li>コンテンツのページで上記関数を実行しよう！</li>
</ul>
<p>ログアウトした状態で各ページにアクセスできない状態（ログインページに移動）になればOK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db応用_rdb"><a class="header" href="#php_db応用_rdb">PHP_DB応用_RDB</a></h1>
<h2 id="本講義の内容とゴール-4"><a class="header" href="#本講義の内容とゴール-4">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-4"><a class="header" href="#本講義の内容-4">本講義の内容</a></h3>
<ul>
<li>RDBのデータ構造紹介．</li>
<li>SQLを用いたデータ集計（Like機能）．</li>
<li>todoリスト一覧での集計結果表示．</li>
</ul>
<h3 id="本講義のゴール-4"><a class="header" href="#本講義のゴール-4">本講義のゴール</a></h3>
<ul>
<li>データ構造を知り，よくないテーブルのパターンを把握する！</li>
<li>データの件数をカウントし，集計する！</li>
<li>複数のテーブルを結合し，必要なデータをまとめる！</li>
</ul>
<h2 id="準備-4"><a class="header" href="#準備-4">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="rdbの構造"><a class="header" href="#rdbの構造">RDBの構造</a></h1>
<h2 id="rdbrelational-databaseとは"><a class="header" href="#rdbrelational-databaseとは">RDB（Relational Database）とは</a></h2>
<h3 id="複雑なデータが必要なとき"><a class="header" href="#複雑なデータが必要なとき">複雑なデータが必要なとき</a></h3>
<ul>
<li>一つのテーブルから取得できる情報は限られている．</li>
<li>ECで購入したユーザの情報と商品の情報を両方取得したい場合は．．？？</li>
</ul>
<h3 id="複数のテーブル同士を連携relationさせるッ"><a class="header" href="#複数のテーブル同士を連携relationさせるッ">複数のテーブル同士を連携（relation）させるッ！！</a></h3>
<ul>
<li>テーブルの設計段階で連携させたいidのカラムをつくっておく！</li>
<li>両方のテーブルを関連付けるテーブルを「SQLで」作成する！</li>
<li>大事なのはデータの構造を見極めること！！</li>
</ul>
<p>まずは下記2種類のデータ構造をマスターしよう！</p>
<h2 id="one-to-many学部テーブルと学生テーブル"><a class="header" href="#one-to-many学部テーブルと学生テーブル">One to Many（学部テーブルと学生テーブル）</a></h2>
<p>一つの学部には複数の学生が在籍するが，学生の所属は一つ．</p>
<h3 id="学部テーブルdepartment_table"><a class="header" href="#学部テーブルdepartment_table">学部テーブル（department_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>工学部</td></tr>
<tr><td align="right">2</td><td>理学部</td></tr>
<tr><td align="right">3</td><td>医学部</td></tr>
<tr><td align="right">4</td><td>歯学部</td></tr>
<tr><td align="right">5</td><td>農学部</td></tr>
<tr><td align="right">6</td><td>文学部</td></tr>
<tr><td align="right">7</td><td>経済学部</td></tr>
</tbody></table>
<h3 id="学生テーブルstudent_table"><a class="header" href="#学生テーブルstudent_table">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<p>「多」の側に対応するidを入れる構造にすればOK．</p>
<p>誰がどこに所属しているかがわかるようになる！</p>
<table><thead><tr><th align="right">id</th><th>name</th><th align="right">department_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td><td align="right">1</td></tr>
<tr><td align="right">3</td><td>リサリサ</td><td align="right">2</td></tr>
<tr><td align="right">4</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">6</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td><td align="right">4</td></tr>
<tr><td align="right">8</td><td>川尻早人</td><td align="right">4</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td><td align="right">5</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td><td align="right">5</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td><td align="right">6</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td><td align="right">6</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td><td align="right">7</td></tr>
</tbody></table>
<h2 id="many-to-many学生テーブルと講義テーブル"><a class="header" href="#many-to-many学生テーブルと講義テーブル">Many to Many（学生テーブルと講義テーブル）</a></h2>
<p>学生は複数の講義を選択し，講義も複数の学生に提供される．</p>
<h3 id="学生テーブルstudent_table-1"><a class="header" href="#学生テーブルstudent_table-1">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">student_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<h3 id="講義テーブルclass_table"><a class="header" href="#講義テーブルclass_table">講義テーブル（class_table）</a></h3>
<table><thead><tr><th align="right">class_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>線形代数学</td></tr>
<tr><td align="right">2</td><td>微分積分学</td></tr>
<tr><td align="right">3</td><td>電子回路</td></tr>
<tr><td align="right">4</td><td>電気回路</td></tr>
<tr><td align="right">5</td><td>情報学</td></tr>
<tr><td align="right">6</td><td>情報数学</td></tr>
<tr><td align="right">7</td><td>統計学</td></tr>
<tr><td align="right">8</td><td>信号処理</td></tr>
<tr><td align="right">9</td><td>電磁気学</td></tr>
</tbody></table>
<h3 id="中間テーブル"><a class="header" href="#中間テーブル">中間テーブル</a></h3>
<p>この場合，「どの講義を」「どの学生が選択するか」を表す別のテーブルを作成する．</p>
<p>このテーブルのことを「中間テーブル」と呼ぶ．</p>
<table><thead><tr><th align="right">class_id</th><th align="right">student_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">1</td><td align="right">2</td></tr>
<tr><td align="right">1</td><td align="right">7</td></tr>
<tr><td align="right">7</td><td align="right">7</td></tr>
<tr><td align="right">3</td><td align="right">9</td></tr>
<tr><td align="right">1</td><td align="right">6</td></tr>
<tr><td align="right">3</td><td align="right">1</td></tr>
<tr><td align="right">5</td><td align="right">5</td></tr>
<tr><td align="right">7</td><td align="right">5</td></tr>
</tbody></table>
<h2 id="テーブルの設計"><a class="header" href="#テーブルの設計">テーブルの設計</a></h2>
<p>データ構造を考える際には，「どうすればうまくいくか」よりも「このパターンはマズイ」を押さえるとうまくいきやすい．</p>
<p>マズイパターンのことを「アンチパターン」と呼ぶが，まずは下記のパターンがないかどうか確認しよう．</p>
<h3 id="-key-point-11"><a class="header" href="#-key-point-11">💡 Key Point</a></h3>
<blockquote>
<p>出やすいアンチパターン</p>
<ul>
<li>ユーザの操作でテーブルが増える（減る）．</li>
<li>ユーザの操作でカラムが増える（減る）．</li>
<li>一つのセル（でいいのかな？）に複数のデータ（数値など）が入る．</li>
<li>なにかのデータを更新したときに，別のテーブルのデータを更新する必要がある．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装1データの追加1"><a class="header" href="#like機能の実装1データの追加1">Like機能の実装1（データの追加1）</a></h1>
<p>前回までに作成したtodoリストにLike機能（Many to Manyの関係）を追加する！</p>
<h2 id="アプリケーションの動作"><a class="header" href="#アプリケーションの動作">アプリケーションの動作</a></h2>
<ul>
<li>各ユーザは複数のtodoにLikeし，各todoは複数のユーザからLikeされる．</li>
<li>一覧画面のLikeボタンをクリックしたらLikeすることができ，Like数が一覧画面に表示される．</li>
<li>Likeは1ユーザ1Likeに制限する（自演禁止）．</li>
</ul>
<h2 id="必要な作業処理"><a class="header" href="#必要な作業処理">必要な作業・処理</a></h2>
<ul>
<li>ユーザテーブルといいねテーブルを作成．</li>
<li>Likeボタン追加．</li>
<li>Likeボタンクリック時にLikeデータを作成．</li>
<li>Like数を一覧画面に表示する．</li>
</ul>
<h2 id="likeテーブルを作成"><a class="header" href="#likeテーブルを作成">Likeテーブルを作成</a></h2>
<p>新しくテーブルを作成する．テーブル名は「<code>like_table</code>」とする．</p>
<p>このテーブルでは「どのユーザが」「どのtodoに」Likeしたのかを記録する役割を持つ．</p>
<p>前項の「中間テーブル」にあたる．</p>
<h3 id="カラム構造"><a class="header" href="#カラム構造">カラム構造</a></h3>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>user_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>todo_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h2 id="todoリストのlike機能実装"><a class="header" href="#todoリストのlike機能実装">todoリストのLike機能実装</a></h2>
<h3 id="やりたいこと"><a class="header" href="#やりたいこと">やりたいこと</a></h3>
<p>いいねボタンをクリックしたら．．．</p>
<ul>
<li>like_tableに「誰が」「何に」いいねをしたのかを追加</li>
</ul>
<p>実装の方針</p>
<ul>
<li>todo_read.phpにいいねボタンを設置</li>
<li>GETでtodoのidとユーザのidを送信する</li>
<li>受け取り側のファイル（like_create.php）で受け取ったデータをdbに登録</li>
</ul>
<h2 id="todo一覧画面にlikeボタンの設置"><a class="header" href="#todo一覧画面にlikeボタンの設置">todo一覧画面にLikeボタンの設置</a></h2>
<p>一覧画面のタグ生成部分にLikeボタンを追記する．</p>
<p>user_idはログイン時にセッション変数に保存している値を使用している（<code>todo_login_act.php</code>を参照）．</p>
<p><code>user_id</code>と<code>todo_id</code>を<code>like_create.php</code>にGETで送信する．</p>
<pre><code class="language-php">// todo_read.php

$user_id = $_SESSION['id'];

// ↓タグ生成部分
$output .= &quot;&lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like&lt;/a&gt;&lt;/td&gt;&quot;;
// 以下編集ボタン，削除ボタンなど

</code></pre>
<h2 id="likeデータの追加"><a class="header" href="#likeデータの追加">Likeデータの追加</a></h2>
<p>LikeテーブルにGETで送信されてきた内容を追加する．</p>
<p>処理の流れ自体はシンプルなINSERT処理．</p>
<pre><code class="language-php">// like_create.php

include('functions.php');

$user_id = $_GET['user_id'];
$todo_id = $_GET['todo_id'];

$pdo = connect_to_db();

$sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, now())';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-12"><a class="header" href="#練習-12">練習</a></h2>
<p>todoリストにLike機能を追加しよう．</p>
<ul>
<li><code>todo_read.php</code>にLikeボタンを追加．</li>
<li><code>like_create.php</code>でテーブルにデータ作成．</li>
</ul>
<p>Likeボタンをクリックして，Likeテーブルにデータが作成されていればOK．</p>
<p>（phpmyadminでデータを確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装2データの追加2"><a class="header" href="#like機能の実装2データの追加2">Like機能の実装2（データの追加2）</a></h1>
<h2 id="ここまでのlike機能の問題点"><a class="header" href="#ここまでのlike機能の問題点">ここまでのLike機能の問題点</a></h2>
<h3 id="現状"><a class="header" href="#現状">現状</a></h3>
<ul>
<li>連打すれば無限にLikeできてしまう．．．</li>
<li>Likeしている状況であれば，Likeを取り消す処理にしたい！</li>
</ul>
<h3 id="実装の方針"><a class="header" href="#実装の方針">実装の方針</a></h3>
<ul>
<li>Likeボタンをクリックしたら，まずtodoとuserでテーブルを検索する．</li>
<li>データが1件以上存在すればDELETEのSQLを実行する．</li>
<li>データが存在しなければINSERTのSQL（前項で実装したもの）を実行する．</li>
</ul>
<h2 id="like状態の調査"><a class="header" href="#like状態の調査">Like状態の調査</a></h2>
<p>前項で作成した<code>like_create.php</code>のINSERT処理の前にデータの件数を確認したい．</p>
<p>件数の確認には<code>COUNT()</code>関数を使用する．</p>
<pre><code class="language-php">// like_create.php

// 省略

$sql = 'SELECT COUNT(*) FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $like_count = $stmt-&gt;fetchColumn();
  // まずはデータ確認
  var_dump($like_count);
  exit();
}

</code></pre>
<h2 id="like数で条件分岐削除or作成"><a class="header" href="#like数で条件分岐削除or作成">Like数で条件分岐（削除or作成）</a></h2>
<p><code>$like_count</code>で条件に該当するデータの件数が取得できるのでまずは確認する．</p>
<p>データの件数が確認できたら，件数が0かそれ以外で条件分岐する．0件でなければDELETE文が作成され，0件の場合はINSERT文が作成される．</p>
<pre><code class="language-php">// like_create.php

if ($like_count != 0) {
  // いいねされている状態
  $sql = 'DELETE FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
} else {
  // いいねされていない状態
  $sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, sysdate())';
}

// 以下は前項と変更なし
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<p>このように記述することで，1ユーザ1Likeの状態を実現することができる．</p>
<h2 id="練習-13"><a class="header" href="#練習-13">練習</a></h2>
<p>todoリストのLike機能を編集しよう．</p>
<ul>
<li><code>like_create.php</code>でLike数カウント -&gt; 条件分岐してDELETE or INSERT．</li>
</ul>
<p>以下2条件で動作確認！</p>
<ul>
<li>「Likeされていない状態」でLikeボタンをクリックして，Likeテーブルにデータが作成されていればOK．</li>
<li>「Likeされている状態」でLikeボタンをクリックして，Likeテーブルのデータが削除されていればOK．</li>
</ul>
<p>phpmyadminでデータを確認し，10件程度データが入っている状態にしておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装3集計とlike数表示"><a class="header" href="#like機能の実装3集計とlike数表示">Like機能の実装3（集計とLike数表示）</a></h1>
<h2 id="やりたいこと-1"><a class="header" href="#やりたいこと-1">やりたいこと</a></h2>
<ul>
<li>ここまででLike数を1ユーザあたり1件に制限する処理を実装した．</li>
<li>しかし，現状ではLike状況を確認するにはphpmyadminにアクセスして確認するしかなくアプリケーション側に情報が表示されない．</li>
<li>そこで，本項ではLikeされた件数をtodo一覧画面に表示するための処理を実装する．</li>
</ul>
<h2 id="手順"><a class="header" href="#手順">手順</a></h2>
<ul>
<li>Like情報が保存されている「Likeテーブル」を用いて，各todoが何件Likeされているのかを集計する．</li>
<li>「todoテーブル」と「集計結果のテーブル」を結合し，両方のデータを一度に取得できるようにする．</li>
<li>取得したデータを画面に表示する．</li>
</ul>
<h2 id="集計"><a class="header" href="#集計">集計</a></h2>
<p>GROUP BYを使うと集計ができる！</p>
<h3 id="例phpmyadminで実行しよう"><a class="header" href="#例phpmyadminで実行しよう">例（phpmyadminで実行しよう！）</a></h3>
<pre><code class="language-sql">SELECT
  todo_id,
  COUNT(id) AS like_count
FROM
  like_table
GROUP BY
  todo_id
</code></pre>
<p>「<code>like_table</code>」の「<code>todo_id</code>」ごとに「idの数」を「<code>like_count</code>」というカラム名で表示する．</p>
<p>集計したカラムのカラム名は自由に設定できる（しなくても良い）が，後ほど再利用する場合は何らかの名前を指定しておくのがオススメ．</p>
<p>実行すると下記のような集計結果のテーブルが表示される．下記は一例なので，<code>like_table</code>のデータによって件数は変化する．</p>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="-key-point-12"><a class="header" href="#-key-point-12">💡 Key Point</a></h3>
<blockquote>
<p>このSQL文は「集計結果のテーブル」を出力する！！</p>
</blockquote>
<h3 id="注意点"><a class="header" href="#注意点">注意点</a></h3>
<ul>
<li>COUNT()で件数を取得しているが，集計関数以外だとエラーになる</li>
<li>その他の集計関数
<ul>
<li><code>MIN()</code>, <code>MAX()</code>, <code>SUM()</code>, etc...</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装4データの結合"><a class="header" href="#like機能の実装4データの結合">Like機能の実装4（データの結合）</a></h1>
<h2 id="画面表示のためにデータをまとめる"><a class="header" href="#画面表示のためにデータをまとめる">画面表示のためにデータをまとめる．</a></h2>
<ul>
<li>現状，画面の表示は<code>todo_table</code>からデータなので，集計結果を組み込めない．．．</li>
<li>テーブルを結合させることで，集計結果もまとめて表示できる！</li>
</ul>
<h2 id="sqlの考え方"><a class="header" href="#sqlの考え方">SQLの考え方</a></h2>
<ul>
<li>「<code>todo_table</code>」と「集計結果のテーブル」をつなげる．</li>
<li>「<code>todo_table</code>の<code>id</code>」と「集計結果のテーブルの<code>todo_id</code>」を対応させる．</li>
<li>「集計結果のテーブル」は前項で取得したアレ</li>
</ul>
<h2 id="テーブルの結合join"><a class="header" href="#テーブルの結合join">テーブルの結合（JOIN）</a></h2>
<p>JOINを使うとテーブルの結合ができる！</p>
<h3 id="例-1"><a class="header" href="#例-1">例</a></h3>
<p>JOINを使う場合の書式は以下のとおり．この場合は以下の条件で結合する．</p>
<ul>
<li>別々のテーブルで管理している「ユーザ」と「ユーザが所属するカテゴリ」を1つの画面に表示したい．</li>
<li>「<code>user_table</code>」「<code>category_table</code>」を結合する．</li>
<li>結合する際には，「<code>user_table</code>の<code>category_id</code>カラム」と「<code>category_table</code>の<code>category_id</code>カラム」を対応させる．</li>
</ul>
<h3 id="user_table"><a class="header" href="#user_table">user_table</a></h3>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
</tbody></table>
<h3 id="category_table"><a class="header" href="#category_table">category_table</a></h3>
<table><thead><tr><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>ダイヤモンドは砕けない</td></tr>
<tr><td align="right">5</td><td>黄金の風</td></tr>
<tr><td align="right">6</td><td>ストーンオーシャン</td></tr>
<tr><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h3 id="sql文"><a class="header" href="#sql文">SQL文</a></h3>
<pre><code class="language-sql">SELECT
  *
FROM
  user_table
  LEFT OUTER JOIN
    category_table
  ON  user_table.category_id = category_table.category_id
</code></pre>
<h3 id="joinしたテーブル"><a class="header" href="#joinしたテーブル">JOINしたテーブル</a></h3>
<p>このテーブルがあれば，画面に必要な情報を全て表示することができる．SQL文の「ON」の後にどのカラムとどのカラムを対応させるのかと記述する．</p>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h2 id="今回のtodoリストで結合したいテーブルの状況"><a class="header" href="#今回のtodoリストで結合したいテーブルの状況">今回のtodoリストで結合したいテーブルの状況</a></h2>
<p>「<code>todo_table</code>」と「集計結果のテーブル」を結合する．</p>
<h3 id="todo_table"><a class="header" href="#todo_table"><code>todo_table</code></a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td></tr>
<tr><td align="right">2</td><td>PHP課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td></tr>
</tbody></table>
<h3 id="集計結果のテーブル"><a class="header" href="#集計結果のテーブル">集計結果のテーブル</a></h3>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="sql文-1"><a class="header" href="#sql文-1">SQL文</a></h3>
<ul>
<li>今回は「<code>todo_table</code>の<code>id</code>」と「集計結果の<code>todo_id</code>」が対応させる．</li>
<li>「集計結果のテーブル」は前項で<code>GROUP BY</code>して出力したテーブル．このテーブルには<code>result-table</code>という名前をつける．</li>
</ul>
<pre><code class="language-sql">SELECT
  *
FROM
  todo_table
  LEFT OUTER JOIN
    (
      SELECT
        todo_id,
        COUNT(id) AS like_count
      FROM
        like_table
      GROUP BY
        todo_id
    ) AS result_table
  ON  todo_table.id = result_table.todo_id
</code></pre>
<h3 id="出力結果"><a class="header" href="#出力結果">出力結果</a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td><td align="right">NULL</td><td align="right">NULL</td></tr>
</tbody></table>
<h3 id="参考inner-join"><a class="header" href="#参考inner-join">【参考】INNER JOIN</a></h3>
<p><code>LEFT OUTER JOIN</code>の代わりに<code>INNER JOIN</code>を使用すると下記のテーブルが得られる．</p>
<p>（結合元のどちらかのテーブルでデータが欠損している場合は結合結果に表示されない）</p>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="画面に結合したデータを表示"><a class="header" href="#画面に結合したデータを表示">画面に結合したデータを表示</a></h3>
<p>一覧画面で上記のデータを参照し，画面に集計結果を表示する．</p>
<pre><code class="language-php">// todo_read.php

// 省略

$sql = 'SELECT * FROM todo_table LEFT OUTER JOIN (SELECT todo_id, COUNT(id) AS like_count FROM like_table GROUP BY todo_id) AS result_table ON todo_table.id = result_table.todo_id';

// 省略
$output .= &quot;&lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like{$record['like_count']}&lt;/a&gt;&lt;/td&gt;&quot;;

</code></pre>
<h2 id="練習-14"><a class="header" href="#練習-14">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ol>
<li><code>GROUP BY</code>を使ってlike_tableのデータを集計しよう（phpmyadminで確認）．</li>
<li><code>JOIN</code>を使用して<code>todo_table</code>と集計結果のテーブルを結合しよう（phpmyadminで確認）．</li>
<li>2で結合したテーブルを用いて，todo一覧画面に集計結果を表示しよう．</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel事前準備"><a class="header" href="#laravel事前準備">Laravel事前準備</a></h1>
<ol>
<li>Docker Desktopのインストール</li>
<li>ストア的なところからubuntu20.04とWindowsターミナルをインストール</li>
<li>wsl2をダウンロードしてインストール（https://docs.microsoft.com/en-us/windows/wsl/install-win10#step-4---download-the-linux-kernel-update-package）</li>
<li>powershellでwsl2をデフォルトにする（wsl --set-default-version 2）</li>
<li>PC再起動</li>
<li>Docker DesktopのSetting -&gt; Resources -&gt; WSL INTEGRATIONのEnable Integration ...にチェックを入れ，Ubuntu 20.04のトグルをオンにする</li>
<li>Windowsターミナルをubuntu20.04で動かしてプロジェクト作成コマンド実行</li>
</ol>
<p>Docker Desctopをインストールする内容を追記する．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day06"><a class="header" href="#day06">Day06</a></h1>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day07"><a class="header" href="#day07">Day07</a></h1>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day08"><a class="header" href="#day08">Day08</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
