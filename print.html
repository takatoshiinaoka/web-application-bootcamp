<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>web-application-bootcamp</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> はじめに</a></li><li class="chapter-item expanded "><a href="work.html"><strong aria-hidden="true">2.</strong> Phase01 の課題について</a></li><li class="chapter-item expanded "><a href="php/php_setup/index.html"><strong aria-hidden="true">3.</strong> PHP 事前準備</a></li><li class="chapter-item expanded "><a href="php/php01/index.html"><strong aria-hidden="true">4.</strong> Day01</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php01/about-php.html"><strong aria-hidden="true">4.1.</strong> PHP 概要</a></li><li class="chapter-item expanded "><a href="php/php01/get-started.html"><strong aria-hidden="true">4.2.</strong> 開発の手順</a></li><li class="chapter-item expanded "><a href="php/php01/php-start.html"><strong aria-hidden="true">4.3.</strong> PHP 基礎</a></li><li class="chapter-item expanded "><a href="php/php01/get-post.html"><strong aria-hidden="true">4.4.</strong> クライアント - サーバ間の通信</a></li><li class="chapter-item expanded "><a href="php/php01/data-select.html"><strong aria-hidden="true">4.5.</strong> パラメータ送信による検索機能の実装</a></li></ol></li><li class="chapter-item expanded "><a href="php/php02/index.html"><strong aria-hidden="true">5.</strong> Day02</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php02/about-db.html"><strong aria-hidden="true">5.1.</strong> DB の基本</a></li><li class="chapter-item expanded "><a href="php/php02/start-db.html"><strong aria-hidden="true">5.2.</strong> DB / テーブルの作成</a></li><li class="chapter-item expanded "><a href="php/php02/db-sql.html"><strong aria-hidden="true">5.3.</strong> SQL による DB 操作</a></li><li class="chapter-item expanded "><a href="php/php02/sql-create.html"><strong aria-hidden="true">5.4.</strong> PHP と DB の連携 1（データ作成処理）</a></li><li class="chapter-item expanded "><a href="php/php02/sql-read.html"><strong aria-hidden="true">5.5.</strong> PHP と DB の連携 2（データ参照処理）</a></li></ol></li><li class="chapter-item expanded "><a href="php/php03/index.html"><strong aria-hidden="true">6.</strong> Day03</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php03/function-db-connect.html"><strong aria-hidden="true">6.1.</strong> DB 接続関数の作成</a></li><li class="chapter-item expanded "><a href="php/php03/sql-edit.html"><strong aria-hidden="true">6.2.</strong> PHP と DB の連携 3（編集画面の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-update.html"><strong aria-hidden="true">6.3.</strong> PHP と DB の連携 4（データ更新処理の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-delete.html"><strong aria-hidden="true">6.4.</strong> PHP と DB の連携 5（データ削除処理）</a></li></ol></li><li class="chapter-item expanded "><a href="php/php04/index.html"><strong aria-hidden="true">7.</strong> Day04</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php04/about-session.html"><strong aria-hidden="true">7.1.</strong> セッションとは</a></li><li class="chapter-item expanded "><a href="php/php04/session-variables.html"><strong aria-hidden="true">7.2.</strong> セッション変数</a></li><li class="chapter-item expanded "><a href="php/php04/auth-01.html"><strong aria-hidden="true">7.3.</strong> 認証処理の実装 1（ログインとログアウト）</a></li><li class="chapter-item expanded "><a href="php/php04/auth-02.html"><strong aria-hidden="true">7.4.</strong> 認証処理の実装 2（認証状態の確認）</a></li></ol></li><li class="chapter-item expanded "><a href="php/php05/index.html"><strong aria-hidden="true">8.</strong> Day05</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php05/about-rdb.html"><strong aria-hidden="true">8.1.</strong> RDB の構造</a></li><li class="chapter-item expanded "><a href="php/php05/like-add.html"><strong aria-hidden="true">8.2.</strong> Like 機能の実装 1（データの追加 1）</a></li><li class="chapter-item expanded "><a href="php/php05/like-delete.html"><strong aria-hidden="true">8.3.</strong> Like 機能の実装 2（データの追加 2）</a></li><li class="chapter-item expanded "><a href="php/php05/like-groupby.html"><strong aria-hidden="true">8.4.</strong> Like 機能の実装 3（データの集計）</a></li><li class="chapter-item expanded "><a href="php/php05/like-join.html"><strong aria-hidden="true">8.5.</strong> Like 機能の実装 4（データの結合）</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/index.html"><strong aria-hidden="true">9.</strong> Laravel 事前準備</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-for-mac.html"><strong aria-hidden="true">9.1.</strong> 【Mac 編】環境構築</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-for-windows.html"><strong aria-hidden="true">9.2.</strong> 【Windows 編】環境構築</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/create-project.html"><strong aria-hidden="true">9.3.</strong> Laravel プロジェクト作成</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/about-docker-and-docker-compose.html"><strong aria-hidden="true">9.4.</strong> 【補足】Docker と Docker Compose の解説</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/add-laravel-breeze.html"><strong aria-hidden="true">9.5.</strong> ライブラリ準備</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-db.html"><strong aria-hidden="true">9.6.</strong> 【今回は不要】データベース準備</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/phpmyadmin.html"><strong aria-hidden="true">9.7.</strong> phpmyadmin の追加</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel01/index.html"><strong aria-hidden="true">10.</strong> Day06</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel01/about-laravel-and-mvc.html"><strong aria-hidden="true">10.1.</strong> Laravel と MVC フレームワーク</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/migration.html"><strong aria-hidden="true">10.2.</strong> マイグレーションによるテーブル作成</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/route-and-controller.html"><strong aria-hidden="true">10.3.</strong> ルーティングとコントローラ</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/views.html"><strong aria-hidden="true">10.4.</strong> 必要な画面の作成と動作確認</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/create.html"><strong aria-hidden="true">10.5.</strong> tweet 作成処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/read.html"><strong aria-hidden="true">10.6.</strong> tweet 一覧画面の実装</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel02/index.html"><strong aria-hidden="true">11.</strong> Day07</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel02/show.html"><strong aria-hidden="true">11.1.</strong> tweet 詳細画面の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/delete.html"><strong aria-hidden="true">11.2.</strong> tweet 削除処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/update.html"><strong aria-hidden="true">11.3.</strong> tweet 更新処理の実装</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel03/index.html"><strong aria-hidden="true">12.</strong> Day08</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel02/auth.html"><strong aria-hidden="true">12.1.</strong> tweet とユーザ認証の連携</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/mypage.html"><strong aria-hidden="true">12.2.</strong> マイページ機能の実装（1 対多のデータ）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/auther.html"><strong aria-hidden="true">12.3.</strong> 投稿者名の表示（多対 1 のデータ）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/favorite01.html"><strong aria-hidden="true">12.4.</strong> Favorite 機能 1（多対多のデータ・中間テーブル）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/favorite02.html"><strong aria-hidden="true">12.5.</strong> Favorite 機能 2（各処理の実装）</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">web-application-bootcamp</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="はじめに"><a class="header" href="#はじめに">はじめに</a></h1>
<h2 id="内容について"><a class="header" href="#内容について">内容について</a></h2>
<p>本講座では前半にPHP，後半にLaravelを用いてWebアプリケーションの実装を学びます．</p>
<p>PHPではWebアプリケーションの仕組みや用いられている基礎的な技術を，Laravelでは実際のアプリケーション開発に対する考え方や実践的な開発を扱います．</p>
<p>プログラミング初心者でもできる構成にしています．毎回ハンズオン形式でアプリケーションを実装しながら進めますので，まずはわからなくても手を動かして「コードと動きの対応」を把握しながら進めていきましょう！</p>
<p>講義で使用するサンプルコードは全て下記URLに保存します．毎回の講義前にダウンロードをお願いします！</p>
<p><a href="https://bit.ly/2X9TaPC">https://bit.ly/2X9TaPC</a></p>
<h2 id="宿題など"><a class="header" href="#宿題など">宿題など</a></h2>
<p>毎回講義での宿題は特にありません．まずは講義内の内容をしっかり実装することが大切ですが，講義だけ受けていてもできるようにはなりません．</p>
<p>特に，講義でははじめてWebアプリ開発を行う方でも「自分の手で実装したWebアプリケーションを動かす」ことができるようにつくっているため，多少経験がある方には物足りないかもしれません．</p>
<p>そこで，そういった方は講義の内容に留まらず試行錯誤しながらガンガンチャレンジしてみましょう！</p>
<ul>
<li>【必須】まず講義内で扱った部分をしっかり実装する（講義中に一通りできるようになっています）．</li>
<li>【必須】講義内で全部終わらなかった部分は，次の講義までに必ず実装しておく．わからない部分などあればもう一度講義の内容を実装してみる．</li>
<li>【必須ではないけれど推奨】講義で扱った内容を元にオリジナルの機能や処理をつくって動かし，slackにシェアする．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phase01-の課題について"><a class="header" href="#phase01-の課題について">Phase01 の課題について</a></h1>
<h2 id="内容"><a class="header" href="#内容">内容</a></h2>
<h3 id="初級"><a class="header" href="#初級">初級</a></h3>
<ul>
<li>Laravel 講義で作成した SNS アプリケーションに何かひとつ以上機能を追加して動作する状態にする．</li>
</ul>
<h3 id="上級推奨"><a class="header" href="#上級推奨">上級（推奨）</a></h3>
<ul>
<li>PHP または Laravel でオリジナルの Web アプリケーションを制作する．</li>
<li>より実践的な開発にチャレンジするため Laravel をオススメするが，PHP でも可とするので自分のレベルに合わせて選択しましょう．</li>
<li>題材は自由とするが，DB と連携している実装とすること．</li>
<li>こちらにチャレンジする方は早いうちからどんなものつくるかを考えたり，いろいろ試行錯誤して試してみたりしましょう！</li>
</ul>
<h2 id="締切とスケジュール"><a class="header" href="#締切とスケジュール">締切とスケジュール</a></h2>
<p><strong>2021/10/13 23:59:59 までに</strong>所定の形式で提出を完了すること！</p>
<ul>
<li>2021/10/08 phase1 講義ラスト</li>
<li>2021/10/13 課題提出完了 &amp; 審査開始</li>
<li>2021/10/15 審査完了 &amp; phase1 クリアメンバーの告知</li>
<li>2021/10/16 phase2 スタート</li>
</ul>
<h2 id="提出の形式"><a class="header" href="#提出の形式">提出の形式</a></h2>
<p>大まかな流れは以下のとおりです．</p>
<p>作品は「デプロイする」または「画面収録する」のどちらかとなります．</p>
<ol>
<li>readme ファイルを作成する．</li>
<li>必要なファイルを指定の共有フォルダに保存する．</li>
<li>Google フォームに必要な次項を記載して送信する．</li>
</ol>
<p>共有フォルダは下記 URL の「phase01_課題提出」となります．</p>
<p><a href="https://bit.ly/2X9TaPC">https://bit.ly/2X9TaPC</a></p>
<h3 id="必ず作成readme-ファイルの準備"><a class="header" href="#必ず作成readme-ファイルの準備">【必ず作成】readme ファイルの準備</a></h3>
<p>readme ファイルとはプロダクトの紹介や操作方法を記述した案内です．提出にあたって必ず作成してください！</p>
<p>上記 URL にフォーマット（readme.md）がありますので活用してください！</p>
<h3 id="プロダクトをデプロイした場合"><a class="header" href="#プロダクトをデプロイした場合">プロダクトをデプロイした場合</a></h3>
<ol>
<li>readme ファイルにプロダクトの紹介や操作方法を記載する．</li>
<li>readme ファイルにデプロイ先の URL を記載する．</li>
<li>「phase01_課題提出フォルダ内の自分の受講番号のフォルダ」に readme ファイルを保存する．</li>
<li>Google フォームに必要事項を入力して送信する．</li>
</ol>
<h3 id="デプロイせずに画面収録した場合"><a class="header" href="#デプロイせずに画面収録した場合">デプロイせずに画面収録した場合</a></h3>
<ol>
<li>readme ファイルにプロダクトの紹介や操作方法を記載する．</li>
<li>自分の PC で readme ファイルに記載した操作方法で操作している様子を画面収録する．</li>
<li>readme ファイルに 2 で作成したファイル名を記載する．</li>
<li>「phase01_課題提出フォルダ内の自分の受講番号のフォルダ」に readme ファイルと 2 で作成した動画ファイルを保存する．</li>
<li>Google フォームに必要事項を入力して送信する．</li>
</ol>
<h3 id="必ず回答google-フォーム"><a class="header" href="#必ず回答google-フォーム">【必ず回答】Google フォーム</a></h3>
<p>下記 URL からアクセスして回答してください！</p>
<p><a href="https://bit.ly/3llfAXW">https://bit.ly/3llfAXW</a></p>
<h3 id="その他"><a class="header" href="#その他">その他</a></h3>
<p>よくわからない場合は，共有フォルダ内の「00」フォルダに画面収録の提出例をつくっておきましたので確認してみてください！</p>
<p>詰まりそうなら早めに「質問チャンネル」へ！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php事前準備"><a class="header" href="#php事前準備">PHP事前準備</a></h1>
<h2 id="サーバとクライアント"><a class="header" href="#サーバとクライアント">サーバとクライアント</a></h2>
<p>サーバで動作する言語（サーバサイド）</p>
<ul>
<li>webサーバ上でプログラムが実行される．</li>
<li>PHP, Ruby, Python, JAVA, (node.js), etc…</li>
</ul>
<p>クライアント（webブラウザ）で動作する言語（クライアントサイド）</p>
<ul>
<li>webブラウザでプログラムが実行される．</li>
<li>html, css, JavaScript</li>
</ul>
<p>=&gt;サーバサイド言語の開発にはサーバ上で動作させるアプリケーション（xamppなど）が必要！</p>
<p>（自分のPC上でサーバを動かすイメージ）</p>
<h2 id="サーバのしくみとxamppの役割"><a class="header" href="#サーバのしくみとxamppの役割">サーバのしくみとXAMPPの役割</a></h2>
<h3 id="サーバの役割及び構成"><a class="header" href="#サーバの役割及び構成">サーバの役割及び構成</a></h3>
<p>Webアプリケーションはクライアントとサーバの組み合わせで構成されている．</p>
<p>サーバには「アプリケーションサーバ」と「DBサーバ」が存在し，相互に連携することでアプリケーションを構築している．</p>
<p>（詳しい仕組みの理解は後からでOK．）</p>
<p><img src="php/php_setup/./img/php_file_about_server.svg" alt="サーバのしくみ" /></p>
<h3 id="サーバサイド言語での開発とxamppの役割"><a class="header" href="#サーバサイド言語での開発とxamppの役割">サーバサイド言語での開発とXAMPPの役割</a></h3>
<p>上記のとおり，PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身のPCで開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身のPC内で擬似的なサーバを用意してPHPを動作させることができるのが「xampp」である．</p>
<p>xamppは以下の役割を提供する．</p>
<ul>
<li>PHPを動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php_setup/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="xampp環境構築"><a class="header" href="#xampp環境構築">XAMPP環境構築</a></h2>
<h3 id="ダウンロード"><a class="header" href="#ダウンロード">ダウンロード</a></h3>
<p>下記URLにアクセスする．</p>
<p><a href="https://www.apachefriends.org/jp/download.html">https://www.apachefriends.org/jp/download.html</a></p>
<blockquote>
<p><strong>！！注意！！</strong></p>
<p>資料作成時時点では<code>7.3.6 / PHP 7.3.6</code>となっているが，現時点（2021/09/12）では<code>8.0.9 / PHP 8.0.9</code>が最新なのでこちらを用いること！！</p>
<p>上記バージョンより新しいものが表示される場合は最新版をインストールしてください！</p>
</blockquote>
<p>↓アクセス画面
<img src="php/php_setup/./img/php_setup_xampp_download_01.svg" alt="xamppダウンロード画面" /></p>
<p>Macの人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_02.svg" alt="xamppダウンロード画面" /></p>
<p>Windowsの人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_03.svg" alt="xamppダウンロード画面" /></p>
<h3 id="インストール"><a class="header" href="#インストール">インストール</a></h3>
<p>ダウンロードしたらインストールを進める．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_04.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認サーバ起動"><a class="header" href="#動作確認サーバ起動">動作確認（サーバ起動）</a></h3>
<p>インストールが済んだらアプリケーションを立ち上げる．</p>
<p>Macの人は以下のようにサーバを起動させる．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_05.svg" alt="xamppダウンロード画面" /></p>
<p>Windowsの人は以下の画面．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_06.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認画面表示"><a class="header" href="#動作確認画面表示">動作確認（画面表示）</a></h3>
<h4 id="アプリケーションサーバ動作確認"><a class="header" href="#アプリケーションサーバ動作確認">アプリケーションサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/">https://localhost/</a>にアクセスして下記画面が表示されればOK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_01.svg" alt="アプリケーションサーバ動作確認" /></p>
<h4 id="dbサーバ動作確認"><a class="header" href="#dbサーバ動作確認">DBサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/phpmyadmin">https://localhost/phpmyadmin</a>にアクセスして下記画面が表示されればOK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_02.svg" alt="DBサーバ動作確認" /></p>
<h2 id="まとめ"><a class="header" href="#まとめ">まとめ</a></h2>
<p>下記3点が実施できていることを確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎"><a class="header" href="#php基礎">PHP基礎</a></h1>
<h2 id="本講義の内容とゴール"><a class="header" href="#本講義の内容とゴール">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容"><a class="header" href="#本講義の内容">本講義の内容</a></h3>
<ul>
<li>Webアプリケーションの仕組み．</li>
<li>PHPの基本的な開発手順．</li>
<li>PHPを用いた簡単な処理の実装．</li>
</ul>
<h3 id="本講義のゴール"><a class="header" href="#本講義のゴール">本講義のゴール</a></h3>
<ul>
<li>Webアプリケーションの仕組みをと動きを把握する（大事）！</li>
<li>PHP（の開発手順）に慣れる！</li>
<li>PHPを用いたデータの送受信を通して，アプリケーションの動きをイメージする．</li>
</ul>
<h2 id="準備"><a class="header" href="#準備">準備</a></h2>
<p>以下3点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php概要"><a class="header" href="#php概要">PHP概要</a></h1>
<h2 id="webアプリケーションの仕組み動き方"><a class="header" href="#webアプリケーションの仕組み動き方">Webアプリケーションの仕組み（動き方）</a></h2>
<p>Webアプリケーション（のソースコード）は世界のどこかにある「サーバ」に置かれている．</p>
<p><img src="php/php01/./img/php_file_web01.svg" alt="webの仕組み" /></p>
<p>Webアプリケーションを使用するときは，Webブラウザに「URL」を指定する．</p>
<ul>
<li>Webブラウザから「http」方式でURLに「リクエスト」を送る．</li>
<li>URLはWeb上にたくさんあるファイルを必ず1つ指定できるようになっている（ユニークな文字列）．</li>
</ul>
<p>URLの構造は下記のようになっている．</p>
<pre><code class="language-txt">https://www.emperor-crimson.com/data/status.php
  ^       ^                      ^      ^
  |       |                      |      |
scheme hostname（サーバ名）    directory filename
</code></pre>
<h2 id="サーバ---クライアント型のアプリケーション"><a class="header" href="#サーバ---クライアント型のアプリケーション">サーバ - クライアント型のアプリケーション</a></h2>
<h3 id="サーバで動作する言語サーバサイド"><a class="header" href="#サーバで動作する言語サーバサイド">サーバで動作する言語（サーバサイド）</a></h3>
<p>サーバ上でプログラムが実行される．</p>
<p><img src="php/php01/./img/php_web_server.svg" alt="サーバサイド言語の動き方" /></p>
<ul>
<li>PHP</li>
<li>Ruby</li>
<li>Python</li>
<li>JAVA</li>
<li>Node.js</li>
<li>etc...</li>
</ul>
<h3 id="クライアントwebブラウザで動作する言語クライアントサイド"><a class="header" href="#クライアントwebブラウザで動作する言語クライアントサイド">クライアント（webブラウザ）で動作する言語（クライアントサイド）</a></h3>
<p><img src="php/php01/./img/php_web_client.svg" alt="クライアントサイド言語の動き方" /></p>
<p>webブラウザがプログラムを実行する．</p>
<ul>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
</ul>
<h2 id="サーバサイドの役割"><a class="header" href="#サーバサイドの役割">サーバサイドの役割</a></h2>
<p>様々なWebアプリケーションが存在するが，基本のサーバサイド処理は同様である．</p>
<p>基本の機能は何らかのデータを扱うことである．</p>
<h3 id="例"><a class="header" href="#例">例</a></h3>
<ul>
<li>twitter     =&gt;  ツイート，検索，タイムラインの表示，etc</li>
<li>facebook		=&gt;  投稿，検索，記事の更新，コメント，etc</li>
<li>wordpress		=&gt;  ブログ記事の投稿，編集，削除，etc</li>
</ul>
<p>※：アプリケーションは必ずしもPHPで作られているわけではない！！</p>
<h3 id="-key-point"><a class="header" href="#-key-point">💡 Key Point</a></h3>
<blockquote>
<p>上記の処理は以下の4つに集約される．</p>
<ul>
<li>📝 データの「作成」（Create）</li>
<li>📖 データの「参照」（Read）</li>
<li>🔄 データの「更新」（Update）</li>
<li>🗑 データの「削除」（Delete）</li>
</ul>
</blockquote>
<p>これら4種類の処理の頭文字をとって「CRUD」と呼ぶ．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎-1"><a class="header" href="#php基礎-1">PHP基礎</a></h1>
<h2 id="サーバサイド言語での開発"><a class="header" href="#サーバサイド言語での開発">サーバサイド言語での開発</a></h2>
<p>PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身のPCで開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身のPC内で擬似的なサーバを用意してPHPを動作させることができるのが「xampp」である．</p>
<p>xamppは以下の役割を提供する．</p>
<ul>
<li>PHPを動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php01/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="開発の手順"><a class="header" href="#開発の手順">開発の手順</a></h2>
<p>xamppはPC内に<code>localhost</code>というサーバを用意してくれる．</p>
<p>このサーバ内にPHPファイルを配置することでPHPのコードを動かすことができる．</p>
<p>PC内では予め指定されたディレクトリ（<code>htdocs</code>）がサーバの役割をするよう決められているため，まずPHPファイルを指定のディレクトリに配置する作業が必要となる．</p>
<p>サンプルフォルダを下記のディレクトリへ移動するとPHPを動かせる！</p>
<ul>
<li>windows : <code>C\xampp\htdocs\</code></li>
<li>mac : <code>/Applications/xampp/xamppfiles/htdocs/</code></li>
</ul>
<h2 id="便利な設定"><a class="header" href="#便利な設定">便利な設定</a></h2>
<ul>
<li><code>htdocs</code>はよく使うのでショートカットを用意しておくと便利！！</li>
<li><code>htdocs</code>内に講義用のフォルダを用意しておくと管理しやすい！</li>
<li><code>htdocs</code>内の<code>index.php</code>の名前を<code>index.php.old</code>に変更しておくとブラウザ画面から<code>htdocs</code>内のファイルが確認できて便利！！</li>
</ul>
<h3 id="-key-point-1"><a class="header" href="#-key-point-1">💡 Key Point</a></h3>
<blockquote>
<p><strong>【重要】開発の手順は以下の流れとなる．</strong></p>
<ol>
<li>xamppを起動する</li>
<li>phpファイルが入ったフォルダをhtdocsに配置</li>
<li>vs codeでhtdocsの上記フォルダを開く</li>
<li>phpのコードを書く</li>
<li>ブラウザでlocalhostにアクセスして動作確認</li>
</ol>
<p>以降，3-5の繰り返し！</p>
<p>※一通り終わったらxamppを終了させることを推奨（次回起動でコケる）</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php基礎-2"><a class="header" href="#php基礎-2">PHP基礎</a></h1>
<h2 id="phpの記述"><a class="header" href="#phpの記述">PHPの記述</a></h2>
<p>PHPは「PHPファイル」に記述する．</p>
<h3 id="phpファイルの作成"><a class="header" href="#phpファイルの作成">PHPファイルの作成</a></h3>
<ul>
<li>拡張子を「<code>.php</code>」にする．</li>
<li>例：「<code>index.php</code>」「<code>create.php</code>」など．</li>
</ul>
<h3 id="開始タグと終了タグ"><a class="header" href="#開始タグと終了タグ">開始タグと終了タグ</a></h3>
<ul>
<li>「<code>&lt;?php</code>」で始まり「<code>?&gt;</code>」で終了（phpしか書かない場合，終了タグは省略可）．</li>
<li>開始タグと終了タグの間に書かれた処理がサーバ上で実行される！</li>
<li>タグ以外の部分（HTMLなど記述した場合）はサーバでは実行されない（そのままソースコードがブラウザに送信される）．</li>
</ul>
<pre><code class="language-php">&lt;?php
// ここにPHPの処理を書く
// ...
?&gt;

// ここから下に書いたコードはサーバで実行されない
// （HTMLなどを書く）
</code></pre>
<h2 id="変数と文字列"><a class="header" href="#変数と文字列">変数と文字列</a></h2>
<p>変数の扱いはJavaScriptと大きく変わらないが，以下の点に注意する．</p>
<ul>
<li>変数名は必ず「<code>$****</code>」←$で始めるルール！</li>
<li>文字列はシングルクォーテーションかダブルクォーテーションで囲む．</li>
<li><code>$</code>の次に数字はNG（JavaScriptと同様）．</li>
<li><code>_</code>などの記号はOK．</li>
</ul>
<pre><code class="language-php">// 数値
$number = 100;

// 文字列
$name = 'engineer';

// 数値スタートはNG
$1lang = 'php';

// 後の数字はOK
$lang2 = 'javascript';

// 記号もOK
$_lang = 'Rust';
</code></pre>
<p>変数と文字列は「<code>.</code>」でつなげる．</p>
<p>ダブルクォーテーションを用いる場合は<code>{}</code>で変数を埋め込むことができる（JavaScriptの<code>``</code>と<code>${}</code>に相当）．</p>
<pre><code class="language-php">$str1 = 'ジーズで' . $lang2 . 'を勉強中！';

// こっちのほうが楽かな．．！
$str2 = &quot;ジーズで{$lang2}を勉強中！&quot;;
</code></pre>
<h2 id="配列と連想配列"><a class="header" href="#配列と連想配列">配列と連想配列</a></h2>
<h3 id="配列"><a class="header" href="#配列">配列</a></h3>
<p>JavaScriptと同様の形式．</p>
<p>データを確認する際には<code>echo</code>または<code>var_dump()</code>を用いる．</p>
<ul>
<li><code>echo</code>で値自体を出力する．</li>
<li><code>var_dump()</code>では配列などの構造も見られる．</li>
<li>デバッグの基本は<code>var_dump()</code>（JavaScriptの<code>console.log()</code>的な）！！！</li>
</ul>
<pre><code class="language-php">// 配列
$array = ['JavaScript', 'PHP', 'Rust', 'COBOL'];

// `echo`で画面上にデータを表示できる．
echo $array[2]; // Rust

// 変数や配列の中身や構造を表示
var_dump($array);

</code></pre>
<h3 id="連想配列"><a class="header" href="#連想配列">連想配列</a></h3>
<p>連想配列はJavaScriptにおける「オブジェクト」に相当する．</p>
<ul>
<li>「キー」「バリュー」のセット．</li>
<li>キー名を指定して値を取り出すことができる．</li>
</ul>
<pre><code class="language-php">// 連想配列
$array2 = [
  &quot;フロント&quot; =&gt; &quot;JavaScript&quot;,
  &quot;サーバ&quot; =&gt; &quot;PHP&quot;,
  &quot;iOS&quot; =&gt; &quot;Swift&quot;,
  &quot;関数型&quot; =&gt; &quot;Haskell&quot;
];

// キー名を指定して値を取り出す
echo $array2['サーバ'];
</code></pre>
<h2 id="条件分岐"><a class="header" href="#条件分岐">条件分岐</a></h2>
<p>条件分岐の構文はJavaScriptと同様．</p>
<pre><code class="language-php">// 0から1のランダムな数を発生させる
$number = rand(0, 1);

// 1かそれ以外で条件分岐
if ($number == 1) {
  echo '値は1です';
} else {
  echo '値は1以外です';
}

</code></pre>
<p>条件分岐を使用したおみくじの例</p>
<pre><code class="language-php">// 1から5の乱数を作成
$random_number = rand(1, 5);

// 乱数の値で条件分岐
if ($random_number == 1) {
  $result =  '大吉';
} elseif ($random_number == ...) {
  $result = ...
} elseif (...) {
  // ...
}
echo $result;

</code></pre>
<h2 id="phpとhtmlの組み合わせ"><a class="header" href="#phpとhtmlの組み合わせ">PHPとHTMLの組み合わせ</a></h2>
<p><code>echo</code>で処理結果を出力できるが，ブラウザに値が表示されるだけで気が利いていない．</p>
<p>そこで，PHPとHTMLを組み合わせて画面を作成する機能を利用してみる．</p>
<ul>
<li>html内に<code>&lt;?=変数名?&gt;</code>と記述することでPHPの変数を埋め込める．</li>
<li>PHPで処理した結果からHTMLをつくるイメージ．</li>
</ul>
<pre><code class="language-php">&lt;?php
// いろいろな処理
$result = '大吉';
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;今日の運勢は&lt;?=$result?&gt;です！&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="-key-point-2"><a class="header" href="#-key-point-2">💡 Key Point</a></h3>
<blockquote>
<p>PHPとHTMLが動く順序を把握しよう！</p>
<ol>
<li>PHPの処理が実行される．</li>
<li>処理の結果作成された値がHTMLに埋め込まれ，HTMLが完成する．</li>
<li>HTMLのデータがブラウザに送信される．</li>
<li>ブラウザがHTMLの内容を画面に表示する．</li>
</ol>
</blockquote>
<h2 id="phpの練習"><a class="header" href="#phpの練習">PHPの練習</a></h2>
<p><code>omikuji.php</code>におみくじの処理を作成し，HTMLと組み合わせて画面に結果を表示しよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="クライアント---サーバ間の通信"><a class="header" href="#クライアント---サーバ間の通信">クライアント - サーバ間の通信</a></h1>
<h2 id="サーバへデータを送るとは"><a class="header" href="#サーバへデータを送るとは">サーバへデータを送る，とは？？</a></h2>
<p>htmlファイルやphpファイルから別のphpファイルへデータを送る．
データを受け取ったphpファイルがDBへの保存などの処理を実行．</p>
<p>データ送信には以下の2種類が存在する．</p>
<ul>
<li>GET</li>
<li>POST</li>
</ul>
<p>どちらの場合も手順は同様．</p>
<h3 id="-key-point-3"><a class="header" href="#-key-point-3">💡 Key Point</a></h3>
<blockquote>
<p>必ず送信側ファイルと受信側ファイルの2つでやり取りを行う．</p>
</blockquote>
<h2 id="getでのデータ送受信"><a class="header" href="#getでのデータ送受信"><code>GET</code>でのデータ送受信</a></h2>
<h3 id="get方式でデータをやり取りする場合の流れ"><a class="header" href="#get方式でデータをやり取りする場合の流れ"><code>GET</code>方式でデータをやり取りする場合の流れ．</a></h3>
<h4 id="送信側の処理"><a class="header" href="#送信側の処理">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の3項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;data_get_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;GET&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理"><a class="header" href="#受信側の処理">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_GET</code>変数に値が格納される．</li>
<li><code>$_GET</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード"><a class="header" href="#送信側のコード">送信側のコード</a></h3>
<pre><code class="language-php">// data_get.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;data_get_confirm.php&quot; method=&quot;GET&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード"><a class="header" href="#受信側のコード">受信側のコード</a></h3>
<ul>
<li>GETで送信された情報は<code>$_GET</code>に入って送られる．</li>
<li>まず「情報が受け取れているかどうか」をチェックすることが大事！！</li>
<li>（情報が受け取れないと以降どうしようもない）</li>
<li><code>exit()</code>は以降の処理を中止する．</li>
</ul>
<pre><code class="language-php">// data_get_confirm.php

&lt;?php

// 必ず最初にチェック！！内容を確認したらコメントアウトすること．
var_dump($_GET);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_GET['todo'];
$deadline = $_GET['deadline'];

?&gt;

</code></pre>
<h3 id="get方式の特徴"><a class="header" href="#get方式の特徴"><code>GET</code>方式の特徴</a></h3>
<ul>
<li>サーバから情報を取得する． URLに情報を追加して送信できる．</li>
<li>データの特定（自分の名前で検索）など，少量のデータ送信に向く（URLにデータが含まれている）．</li>
<li>URLにデータが含まれるため，URLをシェアするだけでデータを共有できる．</li>
</ul>
<h2 id="postでのデータ送受信"><a class="header" href="#postでのデータ送受信"><code>POST</code>でのデータ送受信</a></h2>
<h3 id="post方式でデータをやり取りする場合の流れほとんどgetと同様"><a class="header" href="#post方式でデータをやり取りする場合の流れほとんどgetと同様"><code>POST</code>方式でデータをやり取りする場合の流れ（ほとんど<code>GET</code>と同様）．</a></h3>
<h4 id="送信側の処理-1"><a class="header" href="#送信側の処理-1">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の3項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;data_post_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;POST&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理-1"><a class="header" href="#受信側の処理-1">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_POST</code>変数に値が格納される．</li>
<li><code>$_POST</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード-1"><a class="header" href="#送信側のコード-1">送信側のコード</a></h3>
<pre><code class="language-php">// data_post.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;data_post_confirm.php&quot; method=&quot;POST&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード-1"><a class="header" href="#受信側のコード-1">受信側のコード</a></h3>
<ul>
<li>POSTで送信された情報は<code>$_POST</code>に入って送られる．</li>
<li>以降の流れは<code>GET</code>の場合と同様．</li>
</ul>
<pre><code class="language-php">// data_post_confirm.php

&lt;?php

// POSTの場合も必ず最初にチェック！！
var_dump($_POST);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

?&gt;

</code></pre>
<h3 id="post方式の特徴"><a class="header" href="#post方式の特徴"><code>POST</code>方式の特徴</a></h3>
<ul>
<li>サーバにデータを送信するときに使用．情報を見えないように送信する方法</li>
<li>個人情報など．（送れるデータ量がGETと比較して多い）</li>
<li>ファイルを送信する場合にも使用</li>
</ul>
<h2 id="参考xss--クロスサイトスクリプティング"><a class="header" href="#参考xss--クロスサイトスクリプティング">【参考】XSS : クロスサイトスクリプティング</a></h2>
<p>formに悪意あるJavaScriptを埋め込まれて実行される場合がある．</p>
<p>HTMLにデータを埋め込む際に対策できる．</p>
<pre><code class="language-php">&lt;?php
$hoge = $_POST['hoge'];
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;JavaScriptが送信されると実行されてしまいます&lt;?=$hoge?&gt;&lt;/p&gt;
    &lt;p&gt;ただの文字列として処理されます&lt;?=htmlspecialchars($hoge, ENT_QUOTES);?&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre>
<p>次の項では，データ送信機能を用いて検索処理を実装してみよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="パラメータ送信による検索機能の実装"><a class="header" href="#パラメータ送信による検索機能の実装">パラメータ送信による検索機能の実装</a></h1>
<p>サーバへのデータ送信を用いて，ユーザの入力値によるデータ検索を実装してみよう．</p>
<p>細かい処理はググりながら書けるので，まずは全体の流れを押さえるのが大事ッ！！</p>
<h2 id="処理の流れ"><a class="header" href="#処理の流れ">処理の流れ</a></h2>
<ol>
<li>ユーザがデータを入力する画面を準備する．</li>
<li>検索ボタンクリックでサーバにユーザが入力したデータを送信する．</li>
<li>サーバ側では，受け取ったキーワードを用いて予め用意されたデータの中から該当するものを抽出し，画面を構成する．</li>
</ol>
<h2 id="データの確認"><a class="header" href="#データの確認">データの確認</a></h2>
<p>今回は下記のデータを使用する（すでにファイル内にデータ用意済）．</p>
<p>入力画面でキーワードを入力し，下記のデータの中からキーワードが含まれるものだけを抽出して画面に表示する．</p>
<table><thead><tr><th>id</th><th>name</th><th>hero</th><th>rival</th></tr></thead><tbody>
<tr><td>1</td><td>ファントムブラッド</td><td>ジョナサン・ジョースター</td><td>ディオ・ブランドー</td></tr>
<tr><td>2</td><td>戦闘潮流</td><td>ジョセフ・ジョースター</td><td>カーズ</td></tr>
<tr><td>3</td><td>スターダストクルセイダース</td><td>空条承太郎</td><td>DIO</td></tr>
<tr><td>4</td><td>ダイヤモンドは砕けない</td><td>東方仗助</td><td>吉良吉影</td></tr>
<tr><td>5</td><td>黄金の風</td><td>ジョルノ・ジョバァーナ</td><td>ディアボロ</td></tr>
<tr><td>6</td><td>ストーンオーシャン</td><td>空条徐倫</td><td>エンリコ・プッチ</td></tr>
<tr><td>7</td><td>スティール・ボール・ラン</td><td>ジョニィ・ジョースター</td><td>ファニー・ヴァレンタイン</td></tr>
<tr><td>8</td><td>ジョジョリオン</td><td>東方定助</td><td>透龍</td></tr>
</tbody></table>
<h2 id="ユーザ入力データの送信"><a class="header" href="#ユーザ入力データの送信">ユーザ入力データの送信</a></h2>
<p>まずは検索フォームを用意し，GET でサーバにデータを送信する．</p>
<p>送信側では下記を設定！</p>
<ul>
<li>宛先（<code>action=&quot;data_select.php&quot;</code>）</li>
<li>メソッド（<code>method=&quot;get&quot;</code>）</li>
<li>データ名（<code>name=&quot;keyword&quot;</code>）</li>
</ul>
<pre><code class="language-php">// data_input.php

&lt;form action=&quot;data_select.php&quot; method=&quot;get&quot;&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;検索キーワード入力画面&lt;/legend&gt;
    &lt;div&gt;
      keyword: &lt;input type=&quot;text&quot; name=&quot;keyword&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;検索&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<h2 id="データの受け取り"><a class="header" href="#データの受け取り">データの受け取り</a></h2>
<p>データを受け取る場合には必ず<code>var_dump()</code>を用いてデータを受け取れていることを確認する．</p>
<pre><code class="language-php">// data_select.php

var_dump($_GET);
exit();

</code></pre>
<h2 id="キーワードを用いた検索と画面の構成"><a class="header" href="#キーワードを用いた検索と画面の構成">キーワードを用いた検索と画面の構成</a></h2>
<ol>
<li>受け取ったキーワードを用いて，該当するデータのみ含まれる配列を作成する．<code>id</code>，<code>name</code>，<code>hero</code>，<code>rival</code>いずれかにキーワードが含まれていれば OK とする．</li>
<li>作成した配列から，画面を構成するためのタグを構成する．</li>
</ol>
<pre><code class="language-php">// data_select.php

$keyword = $_GET['keyword'];

// 用意されたデータからキーワードがヒットするものを抽出する処理
$results = array_filter($data, function ($x) use ($keyword) {
  return str_contains($x['id'], $keyword)
    || str_contains($x['name'], $keyword)
    || str_contains($x['hero'], $keyword)
    || str_contains($x['rival'], $keyword);
});

$output = '';

foreach ($results as $result) {
  $output .= &quot;&lt;tr&gt;&lt;td&gt;{$result['id']}&lt;/td&gt;&lt;td&gt;{$result['name']}&lt;/td&gt;&lt;td&gt;{$result['hero']}&lt;/td&gt;&lt;td&gt;{$result['rival']}&lt;/td&gt;&lt;/tr&gt;&quot;;
}

</code></pre>
<p>構成したタグを HTML 部分に埋め込み．</p>
<pre><code class="language-php">// data_select.php

// 省略

&lt;body&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;検索結果&lt;/legend&gt;
    &lt;a href=&quot;data_input.php&quot;&gt;入力画面&lt;/a&gt;
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;id&lt;/th&gt;
          &lt;th&gt;name&lt;/th&gt;
          &lt;th&gt;hero&lt;/th&gt;
          &lt;th&gt;rival&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;!-- ここに`&lt;tr&gt;&lt;td&gt;'id'&lt;/td&gt;&lt;td&gt;'name'&lt;/td&gt;&lt;td&gt;'hero'&lt;/td&gt;&lt;td&gt;'rival'&lt;/td&gt;&lt;/tr&gt;`の形式でデータが表示する --&gt;
        &lt;?= $output ?&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/fieldset&gt;
&lt;/body&gt;

// 省略

</code></pre>
<h3 id="-key-point-4"><a class="header" href="#-key-point-4">💡 Key Point</a></h3>
<blockquote>
<p>処理の流れを把握するのが大事！！</p>
<ol>
<li>ユーザが画面に入力したキーワードをサーバに送信する．</li>
<li>サーバでキーワードを受け取り，もともと存在するデータからヒットするものを抽出する．</li>
<li>ヒットしたデータを元にHTMLをつくる．</li>
<li>HTMLのデータがブラウザに送信される．</li>
<li>画面にHTMLが表示される．</li>
</ol>
</blockquote>
<h2 id="練習"><a class="header" href="#練習">練習</a></h2>
<p><code>data_input.php</code>と<code>data_select.php</code>に上記の処理を記述して動作を確認しよう！</p>
<ol>
<li><code>data_input.php</code>のフォーム部分にデータ送信のためのコードを記述しよう．</li>
<li><code>data_select.php</code>でデータが受け取れることを確認！</li>
<li><code>data_select.php</code>で受け取ったデータを用いてデータを検索し，画面に表示する処理を記述！</li>
</ol>
<p><code>data_input.php</code>から検索キーワードを送信し，キーワードが含まれるデータのみ抽出されて表示されれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db連携_crud処理前半"><a class="header" href="#php_db連携_crud処理前半">PHP_DB連携_CRUD処理前半</a></h1>
<h2 id="本講義の内容とゴール-1"><a class="header" href="#本講義の内容とゴール-1">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-1"><a class="header" href="#本講義の内容-1">本講義の内容</a></h3>
<ul>
<li>DBの基本的な扱い．</li>
<li>SQLを用いたDB操作（データ作成，データ参照）．</li>
<li>PHP上でのSQL実行とtodoリスト（Webアプリケーション）の連携を実装．</li>
</ul>
<h3 id="本講義のゴール-1"><a class="header" href="#本講義のゴール-1">本講義のゴール</a></h3>
<ul>
<li>DBの構成や動き方を理解する！</li>
<li>SQLでDBを操作する基本を理解する！</li>
<li>PHPでDBを操作できるようになる！</li>
</ul>
<p><strong>今回の内容を実装できるようになると，Webアプリケーションのかなりの部分が実現できる！！</strong></p>
<h2 id="準備-1"><a class="header" href="#準備-1">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる（前回と同じ要領）</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="dbの基本"><a class="header" href="#dbの基本">DBの基本</a></h1>
<h2 id="dbとは"><a class="header" href="#dbとは">DBとは</a></h2>
<ul>
<li>web上にデータを保存するためのもの．</li>
<li>構造はエクセルなどと対比するとイメージしやすい！</li>
<li>データを操作するにはSQL（言語）を用いる．</li>
</ul>
<h2 id="使い所"><a class="header" href="#使い所">使い所</a></h2>
<ul>
<li>webアプリケーションでデータを保存する場合のほとんど．</li>
</ul>
<h3 id="利用シーンの例"><a class="header" href="#利用シーンの例">利用シーンの例</a></h3>
<ul>
<li>ECサイトの商品データ（商品名，画像，説明文）</li>
<li>サービスに登録しているユーザの情報（ユーザ名，アドレス，etc）</li>
<li>ブログの投稿内容（投稿日時，タイトル，画像，本文，etc）</li>
</ul>
<h2 id="dbのデータ構造と概念"><a class="header" href="#dbのデータ構造と概念">DBのデータ構造と概念</a></h2>
<p>エクセルと同様のデータ構造となっている．実際にデータが格納されるのは「テーブル」であり，テーブルをどう設計するかがアプリケーションの根幹となる．</p>
<table><thead><tr><th>DBの概念</th><th>エクセルの概念</th></tr></thead><tbody>
<tr><td>データベース</td><td>エクセルファイル</td></tr>
<tr><td>テーブル</td><td>シート</td></tr>
<tr><td>レコード</td><td>行</td></tr>
<tr><td>カラム</td><td>列</td></tr>
</tbody></table>
<h3 id="-key-point-5"><a class="header" href="#-key-point-5">💡 Key Point</a></h3>
<blockquote>
<p>テーブル設計を行う際には，エクセルやスプレッドシートに書き出しながら作業すると視覚的に確認できるのでオススメ．</p>
</blockquote>
<h3 id="データ構造の例"><a class="header" href="#データ構造の例">データ構造の例</a></h3>
<p>ECサイトの商品データをイメージしたテーブルを下記に示す．</p>
<p>（下記のデーブル構造はまだ改善点があるが，後の講義で解説する．）</p>
<table><thead><tr><th align="right">id</th><th>product_name</th><th align="right">price</th><th>category</th><th>image_url</th></tr></thead><tbody>
<tr><td align="right">1</td><td>Laphroaig</td><td align="right">40</td><td>whisky</td><td>./images/laphroaig.png</td></tr>
<tr><td align="right">2</td><td>Ardbeg</td><td align="right">45</td><td>whisky</td><td>./images/ardbeg.png</td></tr>
<tr><td align="right">3</td><td>Caolila</td><td align="right">50</td><td>whisky</td><td>./images/caolila.png</td></tr>
<tr><td align="right">4</td><td>Kilchoman</td><td align="right">50</td><td>whisky</td><td>./images/kilchoman.png</td></tr>
<tr><td align="right">5</td><td>Bowmore</td><td align="right">45</td><td>whisky</td><td>./images/bowmore.png</td></tr>
<tr><td align="right">6</td><td>PortCharlotte</td><td align="right">55</td><td>whisky</td><td>./images/portcharlotte.png</td></tr>
<tr><td align="right">...</td><td>...</td><td align="right">..</td><td>...</td><td>...</td></tr>
</tbody></table>
<h3 id="dbの動き方のイメージ"><a class="header" href="#dbの動き方のイメージ">DBの動き方のイメージ</a></h3>
<p>「サーバ」には3種類存在し，相互に連携しながらWebアプリケーションを動作させている．ただし，Webサーバとアプリケーションサーバは区別の概念が難しいため，一旦「DBサーバとそれ以外」という理解で進めてしまってOK．</p>
<ul>
<li>「Webサーバ」：ブラウザにデータを返す．</li>
<li>「アプリケーションサーバ」：PHPなどのサーバサイド言語を動かす．</li>
<li>「DBサーバ」：データを提供する．</li>
</ul>
<p>ブラウザ，PHP，DBが連携するイメージを以下に示す．</p>
<p><img src="php/php02/./img/php_crud01_about-db.svg" alt="DBの動き方イメージ" /></p>
<h3 id="-key-point-6"><a class="header" href="#-key-point-6">💡 Key Point</a></h3>
<blockquote>
<p>処理の流れを把握しよう！</p>
<p>例えば，PHPとDBを連携させ，保存されているデータを画面に表示する流れは以下のとおりとなる．</p>
<ol>
<li>PHPからDBサーバに接続する．</li>
<li>DBを操作するSQLを実行し，必要なデータを取得する．</li>
<li>取得したデータをHTML上に反映させ，画面に表示する．</li>
</ol>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db--テーブルの作成"><a class="header" href="#db--テーブルの作成">DB / テーブルの作成</a></h1>
<h2 id="dbの作成"><a class="header" href="#dbの作成">DBの作成</a></h2>
<p>まずは基本単位となるDBを作成する．</p>
<p>1つのアプリケーションに対して1つのDB，というイメージでOK．</p>
<ul>
<li><a href="http://localhost/phpmyadmin/">http://localhost/phpmyadmin/</a>にアクセス</li>
<li>「<code>Databases</code>」タブをクリック</li>
<li>「<code>Database name</code>」に「<code>dec_todo</code>」を入力（DB名）</li>
<li>「<code>utf8mb4_unicode_ci</code>」を選択→「作成」をクリック</li>
</ul>
<p>正常に作成されると，画面左側に作成したDB名が表示される．</p>
<h2 id="テーブルとカラムの作成"><a class="header" href="#テーブルとカラムの作成">テーブルとカラムの作成</a></h2>
<p>今回実装するtodoリストのデータ用テーブルを準備する．</p>
<p>テーブルは1つのDB内に複数作成し，相互に連携してWebアプリケーションのデータを構築する．</p>
<h3 id="テーブルの作成"><a class="header" href="#テーブルの作成">テーブルの作成</a></h3>
<p>以下の手順でテーブルを作成しよう．</p>
<ol>
<li>左側のDB一覧から前項で作成したDBを選択する．</li>
<li>名前欄に「<code>todo_table</code>」を入力（テーブル名）．</li>
<li>カラム数を「5」に設定する．</li>
<li>「Go」ボタンをクリック．</li>
</ol>
<h3 id="カラムの設定"><a class="header" href="#カラムの設定">カラムの設定</a></h3>
<p>テーブルに格納されるデータは定められた形式（文字列，数値，日付など）で保存しなければならない．</p>
<p>カラム設定時，各カラムに「名前」と「データ型」を設定する必要がある．下記の表に従ってカラム名とデータ型を設定しよう．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>todo</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>deadline</code></td><td>DATE</td><td>-</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<ul>
<li>idは単一のデータを取得するためのもので，インデックスを「PRIMARY」に設定する必要がある．</li>
<li>また，idは自動的に数値を1から順に振るため，「A_I（Auto Increment）」にチェックしておく</li>
</ul>
<p>全て入力したら右下の「保存する」をクリック！！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="sqlによるdb操作"><a class="header" href="#sqlによるdb操作">SQLによるDB操作</a></h1>
<h2 id="sqlとは"><a class="header" href="#sqlとは">SQLとは</a></h2>
<p>DBの操作には「SQL（言語）」を使用する．</p>
<p>PHPでDBを操作するときは，コード内でSQL文を実行する．</p>
<p>フレームワークなどではコード内では実行しない場合もある．ただし，フレームワークが関数の実行結果としてSQLを生成して実行するため，DB操作は必ずSQLで行われる．</p>
<h2 id="基本のsql4種"><a class="header" href="#基本のsql4種">基本のSQL4種</a></h2>
<p>まずはデータ操作の基本となる4種類を押さえましょう！</p>
<ul>
<li><code>INSERT</code>：データの「作成」</li>
<li><code>SELECT</code>：データの「参照」</li>
<li><code>UPDATE</code>：データの「更新」</li>
<li><code>DELETE</code>：データの「削除」</li>
</ul>
<p>※SQL文は大文字で記載していますが，小文字でも動作する．他の言語（本講座ではPHP）と組み合わせる際に区別しやすいよう大文字で記載している．他の言語でも大文字で扱うことが多い．</p>
<h2 id="insertデータの作成"><a class="header" href="#insertデータの作成">INSERT（データの作成）</a></h2>
<p>指定したテーブルに対して新規データの作成を行う．</p>
<p>ポイントは以下！</p>
<ul>
<li>「カラム名の数と順序」と「値の数と順序」を一致させる必要がある．</li>
<li><code>id</code>カラムはDB側でAuto incrementの設定をしているため<code>NULL</code>を送信する．</li>
<li>作成日時や更新日時は<code>now()</code>を使用して実行時の日付時刻が入力されるようにする．</li>
</ul>
<pre><code class="language-sql">
-- INSERT文の基本構造
INSERT INTO テーブル名 (カラム1, カラム2, ...) VALUES (値1, 値2, ...);

-- 例
INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES(NULL, 'SQL練習', '2021-12-31', now(), now());

</code></pre>
<h2 id="selectデータの参照"><a class="header" href="#selectデータの参照">SELECT（データの参照）</a></h2>
<p>SELECT文はデータの参照に使用されるが，フィルタリングやソートなど多様なオプションが用意されている．</p>
<h3 id="select文の基本"><a class="header" href="#select文の基本">SELECT文の基本</a></h3>
<pre><code class="language-sql">-- SELECT文の基本構造
SELECT 表示するカラム名 FROM テーブル名;

-- 例

-- 「*」で全て指定
SELECT * FROM todo_table;

-- 1つのカラムを指定
SELECT todo FROM todo_table;

-- 複数カラム指定
SELECT todo, deadline FROM todo_table;

</code></pre>
<h3 id="フィルタリング"><a class="header" href="#フィルタリング">フィルタリング</a></h3>
<p>データの条件を設定してフィルタリングをおこなうことができる．フィルタリングには<code>WHERE</code>を使用する．</p>
<pre><code class="language-sql">-- 「WHERE」を使用して値の条件を指定できる
SELECT * FROM todo_table WHERE deadline='2021-12-31';

-- 演算子の使用
SELECT * FROM todo_table WHERE deadline &lt;= '2021-12-31';
SELECT * FROM todo_table WHERE deadline &gt;= '2021-12-01' AND deadline &lt;= '2021-12-31';

-- あいまい検索
SELECT * FROM todo_table WHERE todo LIKE 'PHP%';
SELECT * FROM todo_table WHERE todo LIKE '%提出';
SELECT * FROM todo_table WHERE todo LIKE '%課題%';

</code></pre>
<h3 id="ソート"><a class="header" href="#ソート">ソート</a></h3>
<p>並び替えには<code>ORDER BY</code>を使用する．</p>
<ul>
<li>基準となるカラム名を指定し，</li>
<li>昇順（<code>ASC</code>）か降順（<code>DESC</code>）を指定する．</li>
</ul>
<pre><code class="language-sql">-- ORDER BYを使用した並び替え
-- `deadline`カラムの値で降順に並び替え
SELECT * FROM todo_table ORDER BY deadline DESC;
-- `todo`カラムの値で昇順に並び替え
SELECT * FROM todo_table ORDER BY todo ASC;

</code></pre>
<h3 id="取得するデータ件数の制限"><a class="header" href="#取得するデータ件数の制限">取得するデータ件数の制限</a></h3>
<p><code>LIMIT</code>を用いてデータ件数の制限を行うことができる．最新10件，などの使い方がメジャー．</p>
<pre><code class="language-sql">-- LIMITで表示件数の制限
SELECT * FROM todo_table LIMIT 5;

-- 並び替えとの組み合わせ
SELECT * FROM todo_table ORDER BY deadline DESC LIMIT 5;

</code></pre>
<h2 id="updateデータの更新"><a class="header" href="#updateデータの更新">UPDATE（データの更新）</a></h2>
<p>UPDATEは次回の講義で扱う．</p>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="deleteデータの削除"><a class="header" href="#deleteデータの削除">DELETE（データの削除）</a></h2>
<p>DELETEは次回の講義で扱う．</p>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="参考sqlの練習"><a class="header" href="#参考sqlの練習">【参考】SQLの練習</a></h2>
<p><a href="https://sqlzoo.net/">https://sqlzoo.net/</a></p>
<p>初歩から応用までSQL問題が出題．当面は最初の方の基本的なデータ取得ができればOK．</p>
<h2 id="練習-1"><a class="header" href="#練習-1">練習</a></h2>
<p>SQLはphpmyadminの「SQLタブ」から記述&amp;実行できる．</p>
<ol>
<li>INSERT文を用いて<code>todo_table</code>にデータを10件程度作成しよう．</li>
<li>SELECT文を用いて作成したデータを取り出そう．
<ul>
<li>WHERE, ORDER BY, LIMITを試して，想定どおりのデータを取得できるかどうか確認！</li>
</ul>
</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携データ作成処理"><a class="header" href="#phpとdbの連携データ作成処理">PHPとDBの連携（データ作成処理）</a></h1>
<h2 id="必要なファイル"><a class="header" href="#必要なファイル">必要なファイル</a></h2>
<ul>
<li><code>todo_input.php</code>：データ入力画面．</li>
<li><code>todo_create.php</code>：DB接続，データ作成処理を実行．</li>
</ul>
<h2 id="処理の流れ-1"><a class="header" href="#処理の流れ-1">処理の流れ</a></h2>
<ol>
<li><code>todo_input.php</code>で入力されたデータを<code>todo_create.php</code>へ送信（post）．</li>
<li><code>todo_create.php</code>でデータを受け取り，DBへの新規データ作成．</li>
<li>作成完了後，<code>todo_input.php</code>（入力画面）へ移動．（<code>todo_create.php</code>では画面表示なし）</li>
</ol>
<h2 id="送信側の処理-2"><a class="header" href="#送信側の処理-2">送信側の処理</a></h2>
<p>フォームからデータを送信する．以下3点の漏れやスペルミスがないよう確認しよう．</p>
<ul>
<li>action</li>
<li>method</li>
<li>name</li>
</ul>
<pre><code class="language-php">// todo_input.php

&lt;form action=&quot;todo_create.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<h2 id="受信側の処理-2"><a class="header" href="#受信側の処理-2">受信側の処理</a></h2>
<p>データ受け取り側では以下の処理を実装する．</p>
<ul>
<li>必須項目の入力チェック</li>
<li>データの受け取り</li>
<li>DB接続</li>
<li>SQL作成&amp;実行</li>
<li>SQL実行後の処理</li>
</ul>
<h3 id="入力チェック"><a class="header" href="#入力チェック">入力チェック</a></h3>
<p>DBにデータを格納する場合，基本的にデータの欠損は許されない（データなしを許可する設定もある）．</p>
<p>そのため，以下の条件に合致する場合は以降の処理を中止してエラー画面を表示する．</p>
<ul>
<li>必須項目（todoとdeadline）のデータが送信されていない．</li>
<li>必須項目（todoとdeadline）が空で送信されている．</li>
</ul>
<pre><code class="language-php">// todo_create.php

if (
  !isset($_POST['todo']) || $_POST['todo']=='' ||
  !isset($_POST['deadline']) || $_POST['deadline']==''
) {
  exit('ParamError');
}

</code></pre>
<h3 id="参考エラーメッセージを出力する意味"><a class="header" href="#参考エラーメッセージを出力する意味">【参考】エラーメッセージを出力する意味</a></h3>
<p>どこで失敗したのかをわかるようにする！</p>
<ul>
<li>PHPではエラーを見つけづらい．．．</li>
<li>データを扱うので，異常なデータなどが作成されるとまずい．</li>
<li>どこでエラーが出ているのかわからないと詰む．</li>
<li>エラーにも種類がある！
<ul>
<li>どこでうまくいっていないのかを把握できるようにエラーの処理を記述！</li>
</ul>
</li>
</ul>
<h3 id="データ受け取り"><a class="header" href="#データ受け取り">データ受け取り</a></h3>
<p>前回講義の場合と同様．今回はPOSTで送信しているため<code>$_POST</code>で受け取る．</p>
<pre><code class="language-php">// todo_create.php

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

</code></pre>
<h3 id="db接続"><a class="header" href="#db接続">DB接続</a></h3>
<p>DBに接続するコードは決まった形式（<code>PDO</code>）．</p>
<p>接続の際には以下の情報が必要になる．今回は<code>dbname</code>のみ設定が必要．</p>
<ul>
<li><code>mysql</code>：DBの種類（他に<code>PostgreSQL</code>，<code>Oracle Database</code>，などが存在する）</li>
<li><code>dbname</code>：DBの名前（今回はここを<code>dec_todo</code>に設定する！）</li>
<li><code>port</code>：接続ポート</li>
<li><code>host</code>：DBのホスト名</li>
<li><code>username</code>：DB接続時のユーザ名</li>
<li><code>password</code>：DB接続時のパスワード</li>
</ul>
<pre><code class="language-php">// todo_create.php

// 各種項目設定
$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

// DB接続
try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

// 「dbError:...」が表示されたらdb接続でエラーが発生していることがわかる．

</code></pre>
<h3 id="sql作成実行"><a class="header" href="#sql作成実行">SQL作成&amp;実行</a></h3>
<p>SQL（今回はINSERT文）を実行する場合も手順が決まっている．</p>
<ol>
<li>SQL文の記述．</li>
<li>バインド変数の設定．</li>
<li>SQL実行．</li>
</ol>
<pre><code class="language-php">// todo_create.php

// SQL作成&amp;実行
$sql = 'INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES (NULL, :todo, :deadline, now(), now())';

$stmt = $pdo-&gt;prepare($sql);

// バインド変数を設定
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);

// SQL実行（実行に失敗すると$statusにfalseが返ってくる）
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="補足バインド変数とsqlインジェクション"><a class="header" href="#補足バインド変数とsqlインジェクション">【補足】バインド変数とSQLインジェクション</a></h3>
<p>SQLインジェクションと呼ばれるハッキング手法が存在する．</p>
<p>例えば，下記のようにコードを記述されている場合．．．</p>
<pre><code class="language-php">$query = &quot;SELECT * FROM user WHERE id = '$user_id'&quot;;
</code></pre>
<p><code>$user_id</code>に「<code>' or 'A' = 'A</code>」を入れると，下記と同じ意味になってしまう！</p>
<pre><code class="language-sql">SELECT * FROM user;
</code></pre>
<p>-&gt; 不正にユーザのデータを取得できてしまう！！！</p>
<p>バインド変数を用いることで，SQL文として実行されないようにできる！</p>
<p>ユーザが入力した値をSQL文内で使用する場合には必ずバインド変数を使用すること．</p>
<h3 id="sql実行時の処理"><a class="header" href="#sql実行時の処理">SQL実行時の処理</a></h3>
<p>実行に失敗すると<code>$status</code>に<code>false</code>が返ってくるため，条件分岐して失敗を検出する．</p>
<p><code>$stmt-&gt;errorInfo()</code>と記述することでエラー内容（配列形式）を取得することができ，2番めのデータにエラーメッセージが格納されている．</p>
<p>SQLが正常に実行された場合は，データ入力画面に移動することとする．</p>
<pre><code class="language-php">// todo_create.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  header('Location:todo_input.php');
  exit();
}

</code></pre>
<h2 id="練習-2"><a class="header" href="#練習-2">練習</a></h2>
<p>DBにデータを追加する処理を実装しよう！</p>
<ol>
<li><code>todo_input.php</code>にフォームを作成</li>
<li><code>todo_create.php</code>で
<ul>
<li>データを受け取る</li>
<li>DBに接続</li>
<li>SQL文を書いて実行</li>
</ul>
</li>
</ol>
<p>phpmyadminでテーブルを確認し，データが作成されていればOK！</p>
<ul>
<li>phpmyadminの「表示」タブをクリックすると最新のデータを読み込める．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携データ参照処理"><a class="header" href="#phpとdbの連携データ参照処理">PHPとDBの連携（データ参照処理）</a></h1>
<h2 id="必要なファイル-1"><a class="header" href="#必要なファイル-1">必要なファイル</a></h2>
<ul>
<li><code>todo_read.php</code>：DBからデータを取得してデータの一覧画面を作成する．</li>
</ul>
<h2 id="処理の流れ-2"><a class="header" href="#処理の流れ-2">処理の流れ</a></h2>
<ol>
<li>表示ファイル（<code>todo_read.php</code>）へアクセス時，DB接続する．</li>
<li>データ参照用SQL作成→実行．</li>
<li>取得したデータをHTMLに埋め込んで画面を表示．</li>
</ol>
<p>※必要に応じて，並び替えやフィルタリングを実施してみよう．</p>
<h2 id="dbデータ作成処理の実装"><a class="header" href="#dbデータ作成処理の実装">DBデータ作成処理の実装</a></h2>
<h3 id="db接続-1"><a class="header" href="#db接続-1">DB接続</a></h3>
<p>新規データ作成の場合と同様の処理（DB名の設定を忘れずに！）．</p>
<pre><code class="language-php">// todo_read.php

$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

</code></pre>
<h3 id="sql作成実行-1"><a class="header" href="#sql作成実行-1">SQL作成&amp;実行</a></h3>
<p>データ作成処理と同様にSQLを記述して実行する．今回は「ユーザが入力したデータ」を使用しないのでバインド変数は不要．</p>
<p>また，<code>$status</code>には実行結果が入るが，この時点ではまだデータ自体の取得はできていない点に注意．</p>
<pre><code class="language-php">// todo_read.php

$sql = 'SELECT * FROM todo_table';
$stmt = $pdo-&gt;prepare($sql);
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="sql実行後の処理"><a class="header" href="#sql実行後の処理">SQL実行後の処理</a></h3>
<p>SQLの実行に失敗した場合はエラーを表示して処理を中止する．</p>
<p>SQLが正常に実行された場合は以下の流れで処理が実行される．</p>
<ul>
<li><code>fetchAll()</code>関数でデータ自体を取得する．</li>
<li>繰り返し処理を用いて，取得したデータからHTMLタグを生成する．</li>
<li>（HTML内の任意の位置に作成したタグを設置</li>
</ul>
<pre><code class="language-php">// todo_read.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
  $output = &quot;&quot;;
  foreach ($result as $record) {
    $output .= &quot;
      &lt;tr&gt;
        &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
        &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;/tr&gt;
    &quot;;
  }
}

</code></pre>
<h3 id="htmlにタグを埋め込み"><a class="header" href="#htmlにタグを埋め込み">HTMLにタグを埋め込み</a></h3>
<pre><code class="language-php">// todo_read.php

// html部分にデータを追加
&lt;tbody&gt;
  &lt;!-- ↓に&lt;tr&gt;&lt;td&gt;deadline&lt;/td&gt;&lt;td&gt;todo&lt;/td&gt;&lt;tr&gt;の形でデータが入る --&gt;
  &lt;?= $output ?&gt;
&lt;/tbody&gt;

</code></pre>
<h3 id="参考jsを用いたタグ生成"><a class="header" href="#参考jsを用いたタグ生成">【参考】JSを用いたタグ生成</a></h3>
<p>上記では「PHP内でタグを生成 → HTML内に埋め込み」という実装を行っているが，タグ生成部分をJSで行うこともできる．</p>
<p>どちらが正解というものではないので，自身のイメージしやすいパターンで実装すれば問題ない．</p>
<pre><code class="language-php">&lt;?php

// DB接続，SQL実行など

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  // PHPではデータを取得するところまで実施
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
}

?&gt;

&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;table&gt;
      &lt;tbody id=&quot;output&quot;&gt;&lt;/tbody&gt;
    &lt;table&gt;

    &lt;script&gt;
      // PHPのデータをJSに渡す
      const resultArray = &lt;?=json_encode($result) ?&gt;;
      // 配列からタグ生成し，#outputに表示する
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;


</code></pre>
<h2 id="練習-3"><a class="header" href="#練習-3">練習</a></h2>
<p>DBのデータを読み出して表示する処理を実装しよう！</p>
<p><code>todo_read.php</code>で</p>
<ul>
<li>DBに接続</li>
<li>SQL文を書いて実行</li>
<li>取得したデータをHTMLに埋め込み</li>
</ul>
<p>テーブルのデータが画面に一覧で表示されればOK！</p>
<p>できた人はSQL文を編集してフィルタリングやソートなどを実装してみよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db連携_crud処理後半"><a class="header" href="#php_db連携_crud処理後半">PHP_DB連携_CRUD処理後半</a></h1>
<h2 id="本講義の内容とゴール-2"><a class="header" href="#本講義の内容とゴール-2">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-2"><a class="header" href="#本講義の内容-2">本講義の内容</a></h3>
<ul>
<li>DB内のデータを更新する処理，削除する処理を実装する．</li>
<li>関数専用のファイルを作成し，読み込みを実行を行う．</li>
<li>todoリストの基本的な機能について実装を完了する．</li>
</ul>
<h3 id="本講義のゴール-2"><a class="header" href="#本講義のゴール-2">本講義のゴール</a></h3>
<ul>
<li>基本的なCRUD処理を実装し，処理の流れを理解する．</li>
<li>複数のファイルで使用する共通のコードの管理手法を学ぶ．</li>
<li>オリジナルWebサービスの構想からCRUD処理の設計につなげる．</li>
</ul>
<h3 id="todoアプリケーションの全体像"><a class="header" href="#todoアプリケーションの全体像">todoアプリケーションの全体像</a></h3>
<p><img src="php/php03/./img/php_crud02_app_construct.svg" alt="todoアプリ全体像" /></p>
<h2 id="準備-2"><a class="header" href="#準備-2">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db接続関数の作成"><a class="header" href="#db接続関数の作成">DB接続関数の作成</a></h1>
<h2 id="db接続は常に同じコード"><a class="header" href="#db接続は常に同じコード">DB接続は常に同じコード</a></h2>
<p>実は．．．</p>
<ul>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で記述したDB接続のコードは全く同じ！</li>
<li>今回作成する<code>todo_edit.php</code>, <code>todo_update.php</code>, <code>todo_delete.php</code>も同じ記述！</li>
</ul>
<p>であれば．．！</p>
<p>一つの関数にまとめられる！</p>
<p>=&gt; 関数用のファイルを作成しよう！（<code>functions.php</code>）</p>
<h2 id="関数の定義"><a class="header" href="#関数の定義">関数の定義</a></h2>
<p>DB接続の処理は様々なファイルで実行されるため，関数専用のファイル（<code>functions.php</code>）に記述して他のファイルから読み込むと効率が良い．</p>
<p>関数を実行すると，DB接続情報を出力するように実装すると良い（<code>return new PDO...</code>部分）．</p>
<pre><code class="language-php">// functions.php

function connect_to_db()
{
  $dbn='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
  $user = 'root';
  $pwd = '';
  try {
    return new PDO($dbn, $user, $pwd);
  } catch (PDOException $e) {
    exit('dbError:'.$e-&gt;getMessage());
  }
}

</code></pre>
<h2 id="関数の実行"><a class="header" href="#関数の実行">関数の実行</a></h2>
<p>上で定義した関数はDB接続が必要なファイルで<code>functions.php</code>を読み込むことで実行可能．</p>
<p>別ファイルの読み込みは<code>include()</code>関数を用いる．</p>
<pre><code class="language-php">// DB接続したいファイル（todo_create.php, todo_read.php, など）

include('functions.php');
$pdo = connect_to_db();

// 他のDB接続が必要なファイルでも上記の2行でOK！

</code></pre>
<h2 id="練習-4"><a class="header" href="#練習-4">練習</a></h2>
<ol>
<li><code>functions.php</code>にDB接続の関数を定義しよう！</li>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で<code>functions.php</code>を<code>include()</code>し，関数を実行しよう！</li>
</ol>
<p>今まで通りの動きが確認できればOK！</p>
<p>（これまでやっていた処理を関数にしただけなので，実行される内容はこれまでと変化なし）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携3編集画面の作成"><a class="header" href="#phpとdbの連携3編集画面の作成">PHPとDBの連携3（編集画面の作成）</a></h1>
<h2 id="処理の流れ-3"><a class="header" href="#処理の流れ-3">処理の流れ</a></h2>
<p>データ更新の処理はデータ作成処理の流れと似ている！</p>
<p>まずは本項で1と2を実装する．</p>
<ol>
<li>一覧画面に更新ページへのリンクを作成（urlにidを追加： todo_edit.php?id=**）</li>
<li>更新ページの作成（todo_edit.php）</li>
<li>更新処理の作成（todo_update.php）</li>
<li>一覧画面に戻る</li>
</ol>
<h2 id="一覧画面にリンク追加"><a class="header" href="#一覧画面にリンク追加">一覧画面にリンク追加</a></h2>
<p><code>&lt;a&gt;</code>を用いて編集画面（と削除処理）へのリンクを作成する．</p>
<p>GETメソッドが「データをURLに格納する」仕様を利用し，<code>&lt;a&gt;</code>のURLに各データの<code>id</code>を埋め込む．</p>
<pre><code class="language-php">// todo_read.php

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;
      &lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<p>下図のようにリンクが表示されればOK．</p>
<p>リンクにマウスカーソルを当てると，ブラウザ左下にリンク先のURLが表示される．<code>id=**</code>の形で数値が表示されれば正しく指定されている．</p>
<p><img src="php/php03/./img/php_crud02_todo_read.png" alt="一覧画面リンク表示" /></p>
<h2 id="編集画面の作成"><a class="header" href="#編集画面の作成">編集画面の作成</a></h2>
<p>続いて，編集画面を実装する．</p>
<p>本画面の役割は</p>
<ul>
<li>現在テーブルに保存されている<code>todo</code>と<code>deadline</code>を表示する．</li>
<li>ユーザが画面上でデータを編集する．</li>
<li>ユーザが編集したデータをテーブル更新用ファイル（<code>todo_update.php</code>）に送信する．</li>
</ul>
<p>コードのポイントは以下．</p>
<ul>
<li>SELECT文を用いて<code>id</code>指定し，<code>fetch()</code>関数でデータを取得する．</li>
<li>取得したデータを<code>&lt;input&gt;</code>の初期値として設定する．</li>
<li>次の更新処理で<code>id</code>が必要になるため，<code>&lt;input type=&quot;hidden&quot;&gt;</code>を用いて<code>id</code>を送信する．</li>
</ul>
<pre><code class="language-php">include(&quot;functions.php&quot;);

$id = $_GET['id'];

$pdo = connect_to_db();

$sql = 'SELECT * FROM todo_table WHERE id=:id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_INT);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $record = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
}
?&gt;

// 以下HTML部分
&lt;form action=&quot;todo_update.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;DB連携型todoリスト（編集画面）&lt;/legend&gt;
    &lt;a href=&quot;todo_read.php&quot;&gt;一覧画面&lt;/a&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot; value=&quot;&lt;?= $record['todo'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot; value=&quot;&lt;?= $record['deadline'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?= $record['id'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<p>下図のように現在のデータが画面に表示されればOK．</p>
<p><img src="php/php03/./img/php_crud02_todo_edit.png" alt="編集画面データ表示" /></p>
<h2 id="練習-5"><a class="header" href="#練習-5">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>一覧画面に<code>todo_edit.php</code>へのリンクを追加！（<code>todo_delete.php</code>へのリンクも一緒に！）</li>
<li><code>todo_edit.php</code>ではデータをIDで検索し，該当するデータを画面に表示！</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携4データ更新処理の作成"><a class="header" href="#phpとdbの連携4データ更新処理の作成">PHPとDBの連携4（データ更新処理の作成）</a></h1>
<h2 id="データ更新のsql"><a class="header" href="#データ更新のsql">データ更新のSQl</a></h2>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="更新の処理"><a class="header" href="#更新の処理">更新の処理</a></h2>
<p>前項の編集画面からデータを受け取り，DBのデータを更新する．</p>
<p>処理の流れは<code>todo_create.php</code>とよく似ている．</p>
<h3 id="データチェックと受け取り"><a class="header" href="#データチェックと受け取り">データチェックと受け取り</a></h3>
<p>まずは<code>todo</code>，<code>deadline</code>，<code>id</code>のデータが揃っていることを確認し，データを受け取る．</p>
<pre><code class="language-php">// todo_update.php

if (
  !isset($_POST['todo']) || $_POST['todo'] == '' ||
  !isset($_POST['deadline']) || $_POST['deadline'] == '' ||
  !isset($_POST['id']) || $_POST['id'] == ''
) {
  exit('paramError');
}

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];
$id = $_POST['id'];

</code></pre>
<h3 id="db接続とsql実行"><a class="header" href="#db接続とsql実行">DB接続とSQL実行</a></h3>
<p>続いてDB接続し，UPDATEのSQLを実行する．SQLが正常に実行された場合は一覧画面に移動する．</p>
<h3 id="-key-point-7"><a class="header" href="#-key-point-7">💡 Key Point</a></h3>
<blockquote>
<p>必ずWHEREでidを指定すること！！！</p>
</blockquote>
<pre><code class="language-php">// todo_update.php

include('functions.php');
$pdo = connect_to_db();

$sql = 'UPDATE todo_table SET todo=:todo, deadline=:deadline, updated_at=now() WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header('Location:todo_read.php');
  exit();
}

</code></pre>
<h2 id="練習-6"><a class="header" href="#練習-6">練習</a></h2>
<p><code>todo_update.php</code>でUPDATEの処理を実装しよう！</p>
<p>更新処理実行後，一覧ページでデータが更新されていればOK！</p>
<p>（phpmyadminでも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpとdbの連携5データ削除処理"><a class="header" href="#phpとdbの連携5データ削除処理">PHPとDBの連携5（データ削除処理）</a></h1>
<h2 id="データ削除のsql"><a class="header" href="#データ削除のsql">データ削除のSQL</a></h2>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="処理の流れ-4"><a class="header" href="#処理の流れ-4">処理の流れ</a></h2>
<ol>
<li>✅ 一覧画面に削除ページへのリンクを作成（urlにidを追加<code>todo_delete.php?id=**</code>）</li>
<li>削除処理の作成（<code>todo_delete.php</code>）</li>
<li>テーブルのデータを削除したら一覧画面に戻る</li>
</ol>
<h2 id="削除の実装"><a class="header" href="#削除の実装">削除の実装</a></h2>
<p>削除に必要なのは<code>id</code>のみである．編集画面に移動する場合と同様にGETで<code>id</code>を受け取る．</p>
<p>データを受け取ったら，下記の順で処理を記述する．</p>
<ul>
<li>DB接続</li>
<li>SQL実行（DELETE文）</li>
<li>一覧画面へ移動</li>
</ul>
<h3 id="-key-point-8"><a class="header" href="#-key-point-8">💡 Key Point</a></h3>
<blockquote>
<p>⚠️ DELETE文を実行する場合には必ずWHEREで<code>id</code>を指定すること．</p>
</blockquote>
<pre><code class="language-php">$id = $_GET['id'];

include('functions.php');
$pdo = connect_to_db();

$sql = 'DELETE FROM todo_table WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-7"><a class="header" href="#練習-7">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>✅ 一覧画面に<code>todo_delete.php</code>へのリンクを追加！</li>
<li><code>todo_delete.php</code>ではデータをIDで検索し，該当するデータを削除！</li>
<li>完了したら<code>todo_read.php</code>へ戻る．</li>
</ol>
<p>削除処理実行後，一覧ページでデータが削除されていればOK！</p>
<p>（phpmyadminでも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_セッション"><a class="header" href="#php_セッション">PHP_セッション</a></h1>
<h2 id="本講義の内容とゴール-3"><a class="header" href="#本講義の内容とゴール-3">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-3"><a class="header" href="#本講義の内容-3">本講義の内容</a></h3>
<ul>
<li>セッション機能の確認．</li>
<li>ログイン処理，ログアウト処理の実装．</li>
<li>todoリストをログインしていないと使えないようにする．</li>
</ul>
<h3 id="本講義のゴール-3"><a class="header" href="#本講義のゴール-3">本講義のゴール</a></h3>
<ul>
<li>ページ間でデータ共有する方法を知る！</li>
<li>プロダクトの中で最適なデータの管理方法を選べるようになる！</li>
<li>「ログインしているとはなにか」をマスター！</li>
</ul>
<h2 id="準備-3"><a class="header" href="#準備-3">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッションとは"><a class="header" href="#セッションとは">セッションとは</a></h1>
<h2 id="セッションとはなにか"><a class="header" href="#セッションとはなにか">セッションとはなにか</a></h2>
<ul>
<li>サーバに変数などを保存できる仕組み．</li>
<li>サーバ自体に変数を定義する．</li>
<li>サーバ上にあるどのファイルからでも値を取り出せる！</li>
</ul>
<h3 id="普通の変数を使用した例"><a class="header" href="#普通の変数を使用した例">普通の変数を使用した例</a></h3>
<p>各ファイルで用意した変数はそのファイル内でしか使用できない．</p>
<table><thead><tr><th>file</th><th>data</th></tr></thead><tbody>
<tr><td>hoge.php</td><td>$number = 100;</td></tr>
<tr><td>fuga.php</td><td>$keyword = 'ジーズ';</td></tr>
<tr><td>piyo.php</td><td>$array = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td></tr>
</tbody></table>
<h3 id="セッション変数を活用"><a class="header" href="#セッション変数を活用">セッション変数を活用</a></h3>
<p>セッション領域自体にデータを保存することができ，サーバ上のどのファイルからでもアクセスすることができる．</p>
<p>セッション変数は<code>$_SESSION</code>で記述する（後述）．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];
      </td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッションの使用とsession_id"><a class="header" href="#セッションの使用とsession_id">セッションの使用と「session_id」</a></h2>
<p>セッションは下記の流れで使用する．</p>
<ol>
<li>セッションの開始．
<ul>
<li>セッションがスタートすると「セッション領域」が作られる．</li>
<li>セッション領域識別用の id（<code>session_id</code>）が発行される．</li>
<li>セッションの機能が使えるようになり，情報を保存できる．</li>
<li>session_id の再生成ができる．</li>
</ul>
</li>
<li>必要に応じてセッション変数（<code>$_SESSION</code>）にデータを保存．</li>
<li><code>session_id</code>の再生成
<ul>
<li>悪意あるサイトに<code>session_id</code>を読まれてしまうとハッキングのリスク．</li>
<li>ページ移動などのタイミングで id を再生成し，最新版だけを有効にする．</li>
</ul>
</li>
<li>セッションの終了．
<ul>
<li>保存されている情報などを破棄する．</li>
</ul>
</li>
</ol>
<h3 id="session_id-の確認"><a class="header" href="#session_id-の確認">session_id の確認</a></h3>
<p>まずはセッションの開始を宣言する．
セッションに関連する機能を使用する場合には必ず記述する必要がある．</p>
<pre><code class="language-php">session_start();
</code></pre>
<p>セッションを開始すると自動的に id が発行されてブラウザに id が保存される．</p>
<p>id はサーバとブラウザの双方に保存され，下記の方法で確認することができる．</p>
<ol>
<li>PHP ファイル上で<code>session_id();</code>で取得可能．</li>
<li>ブラウザで「検証 → Application → Cookies → localhost」
<ul>
<li>現在有効な session_id が保存されている．</li>
</ul>
</li>
</ol>
<h3 id="session_id-の再生成"><a class="header" href="#session_id-の再生成">session_id の再生成</a></h3>
<p>session_id がバレると他の人に session の中身をいじられてしまう可能性がある．．！</p>
<p><code>session_regenerate_id();</code>を使用すると id を再生成して更新できる．</p>
<p>（保存されているデータ自体は変更なし）</p>
<p>使い所</p>
<ul>
<li>ログインしたら id 発行してログイン情報を管理．</li>
<li>ページ移動など特定の操作をしたタイミングで再生成して古い id を無効化する．</li>
</ul>
<pre><code class="language-php">// session_regenerate_id.php

&lt;?php
// セッションの開始
session_start();
$old_session_id = session_id();

// 再生成
session_regenerate_id(true);
$new_session_id = session_id();

// 新旧のidを画面に表示して更新されていることを確認
echo &quot;&lt;p&gt;旧id: {$old_session_id}&lt;/p&gt;&quot;;
echo &quot;&lt;p&gt;新id: {$new_session_id}&lt;/p&gt;&quot;;
exit();

?&gt;

</code></pre>
<h3 id="-key-point-9"><a class="header" href="#-key-point-9">💡 Key Point</a></h3>
<blockquote>
<p><code>session_regenerate_id(true);</code>の<code>true</code>が大切！！</p>
<p><code>true</code>を設定することで古い id を無効にすることができる．</p>
</blockquote>
<h3 id="セッションの終了"><a class="header" href="#セッションの終了">セッションの終了</a></h3>
<p>セッションの終了に際しては保存したデータの削除が必要になる．</p>
<p>以下の 3 つの手順でデータを削除する．</p>
<ol>
<li>セッション変数の削除．</li>
<li>ブラウザに保存されたセッション id の有効期間操作．</li>
<li>セッション領域の削除．</li>
</ol>
<p>これらの処理は後のステップで実装する．</p>
<pre><code class="language-php">// 指定したsession変数の削除
unset($_SESSION[key]);

// session情報の全削除
$_SESSION = array();

// ブラウザに保存した情報の有効期限を操作
setcookie(session_name(), '', time() - 42000, '/');

// session領域自体をを破壊
session_destroy();

</code></pre>
<p><a href="https://www.php.net/manual/ja/function.session-destroy.php">参考</a></p>
<h2 id="練習-8"><a class="header" href="#練習-8">練習</a></h2>
<p>下記の処理を実装してセッションと session_id の挙動を確認しよう．</p>
<ul>
<li>id を発行して確認しよう！</li>
<li>再生成して旧 id と新 id を表示しよう！</li>
</ul>
<p>検証画面で確認し，リロードの度に新 ID と一致すれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッション変数"><a class="header" href="#セッション変数">セッション変数</a></h1>
<p>セッション領域に保存される変数を使用することで，複数のファイルで横断的にデータを扱うことができる．</p>
<h2 id="セッション変数の形式"><a class="header" href="#セッション変数の形式">セッション変数の形式</a></h2>
<p>セッション変数は<code>$_SESSION</code>で記述する．</p>
<p>連想配列形式（JavaScriptのオブジェクトに相当）で扱われる．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッション変数の定義"><a class="header" href="#セッション変数の定義">セッション変数の定義</a></h2>
<p>セッション変数を扱う際にも<code>session_start();</code>は必須！</p>
<p>セッション変数は<code>$_SESSION['キー名']</code>の形式で宣言するが，使い方は通常の変数と同様である．</p>
<pre><code class="language-php">// session01.php

&lt;?php
session_start();

// セッション変数に値を代入
$_SESSION['keyword'] = 'PHP';

echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="セッション変数の使用"><a class="header" href="#セッション変数の使用">セッション変数の使用</a></h2>
<p>セッション変数はセッション領域に保存されているので，ファイル内で定義していなくても呼び出すことができる．</p>
<p>使い方は通常の変数と同様．</p>
<pre><code class="language-php">&lt;?php
// session02.php

session_start();

// `$_SESSION['keyword']`はセッション変数なので定義していなくても呼び出せる
$string = $_SESSION['keyword'] . '&amp;MySQL';
echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="練習-9"><a class="header" href="#練習-9">練習</a></h2>
<p>下記の処理を記述して，セッション変数の動き方を確認しよう．</p>
<ul>
<li><code>session01.php</code>でsession変数を定義しよう！</li>
<li><code>session02.php</code>で定義した変数を呼び出して出力しよう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装1ログインとログアウト"><a class="header" href="#認証処理の実装1ログインとログアウト">認証処理の実装1（ログインとログアウト）</a></h1>
<h2 id="ユーザテーブルの準備"><a class="header" href="#ユーザテーブルの準備">ユーザテーブルの準備</a></h2>
<p>ユーザのデータを格納するテーブルが必要になる．テーブルの構成は以下のとおりである．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>username</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>password</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>is_admin</code></td><td>INT</td><td>1</td><td>管理者ユーザと一般ユーザの識別に使用</td></tr>
<tr><td><code>is_deleted</code></td><td>INT</td><td>1</td><td>論理削除に使用</td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<p>テーブルを数件のテストデータを作成するため，下記のSQL文を実行する．</p>
<p><code>phpmyadmin</code>画面で<code>dec_todo</code>のデータベースを選択し，<code>SQL</code>タブから実行する．</p>
<pre><code class="language-sql">CREATE TABLE users_table(
  id int(12) not null primary key auto_increment,
  username varchar(128) not null,
  password varchar(128) not null,
  is_admin int(1) not null,
  is_deleted int(1) not null,
  created_at datetime not null,
  updated_at datetime not null
)
;
INSERT INTO users_table(
  id,
  username,
  password,
  is_admin,
  is_deleted,
  created_at,
  updated_at
)
VALUES(
  NULL,
  'testuser01',
  '111111',
  1,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser02',
  '222222',
  0,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser03',
  '333333',
  0,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser04',
  '444444',
  0,
  0,
  now(),
  now()
)
;

</code></pre>
<h2 id="処理に必要なファイル"><a class="header" href="#処理に必要なファイル">処理に必要なファイル</a></h2>
<p>ログイン処理に<code>todo_login.php</code>と<code>todo_login.php</code>，ログアウト処理に<code>todo_logout.php</code>を使用する．</p>
<table><thead><tr><th>file</th><th>役割</th></tr></thead><tbody>
<tr><td><code>todo_login.php</code></td><td>ログイン情報（username, password）を入力して送信する．</td></tr>
<tr><td><code>todo_login_act.php</code></td><td>送信されたデータを受け取り，DB関連の処理を実行する．</td></tr>
<tr><td><code>todo_logout.php</code></td><td>セッション，ログイン情報を破棄する．</td></tr>
</tbody></table>
<h2 id="ログイン処理"><a class="header" href="#ログイン処理">ログイン処理</a></h2>
<h3 id="ログイン処理の流れ"><a class="header" href="#ログイン処理の流れ">ログイン処理の流れ</a></h3>
<ol>
<li>ログインフォーム情報を入力して送信（<code>todo_login.php</code>）</li>
<li>送信されたデータを受け取る（<code>todo_login_act.php</code>）</li>
<li>受け取ったデータがDBにあるかどうかチェック（<code>todo_login_act.php</code>）
<ul>
<li>成功時（DBにユーザのデータが存在した場合）
<ul>
<li>DBにログイン情報があればセッション変数に格納（<code>todo_login_act.php</code>）</li>
<li>セッション変数にログイン情報を保持して<code>todo_read.php</code>に移動</li>
</ul>
</li>
<li>失敗時（DBにユーザのデータが存在しなかった場合）
<ul>
<li><code>todo_login.php</code>に戻るリンクを表示する（ログイン失敗）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="ログイン画面の実装"><a class="header" href="#ログイン画面の実装">ログイン画面の実装</a></h2>
<p>ログインフォームに<code>action</code>，<code>method</code>，<code>name</code>を設定する．</p>
<p>データを<code>todo_login_act.php</code>に送信する．</p>
<pre><code class="language-php">// todo_login.php

&lt;form action=&quot;todo_login_act.php&quot; method=&quot;POST&quot;&gt;
  // ...
  &lt;div&gt;
    username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    password: &lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;Login&lt;/button&gt;
  &lt;/div&gt;
  // ...
&lt;/form&gt;

</code></pre>
<h2 id="データ受け取り--ログイン処理"><a class="header" href="#データ受け取り--ログイン処理">データ受け取り → ログイン処理</a></h2>
<p>データを受け取ったら，ユーザのテーブルに該当するデータが存在するかどうかを確認する．</p>
<pre><code class="language-php">// todo_login_act.php

&lt;?php
session_start();
include('functions.php');

$username = $_POST['username'];
$password = $_POST['password'];

$pdo = connect_to_db();

// username，password，is_deletedの3項目全てを満たすデータを抽出する．
$sql = 'SELECT * FROM users_table WHERE username=:username AND password=:password AND is_deleted=0';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':username', $username, PDO::PARAM_STR);
$stmt-&gt;bindValue(':password', $password, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

</code></pre>
<p>データの有無で条件分岐する．</p>
<ul>
<li>データが存在しない場合はログイン画面へ移動するリンクを表示する．</li>
<li>データが存在した場合はセッション変数にsession_idとユーザのデータを入れ，一覧画面に移動する．</li>
</ul>
<pre><code class="language-php">if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $val = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
  if (!$val) {
    echo &quot;&lt;p&gt;ログイン情報に誤りがあります&lt;/p&gt;&quot;;
    echo &quot;&lt;a href=todo_login.php&gt;ログイン&lt;/a&gt;&quot;;
    exit();
  } else {
    $_SESSION = array();
    $_SESSION['session_id'] = session_id();
    $_SESSION['is_admin'] = $val['is_admin'];
    $_SESSION['username'] = $val['username'];
    header(&quot;Location:todo_read.php&quot;);
    exit();
  }
}

</code></pre>
<h3 id="-key-point-10"><a class="header" href="#-key-point-10">💡 Key Point</a></h3>
<blockquote>
<p><code>session_id</code>はこの後使用するので必ず保存しよう．</p>
<p>ユーザデータはアプリケーションに必要なものを適宜選別してセッションに保存する．</p>
</blockquote>
<h2 id="ログアウト"><a class="header" href="#ログアウト">ログアウト</a></h2>
<p>ログアウトの処理は前項のセッション終了のコードそのもの．</p>
<p>ユーザの痕跡をなくすことが肝要．</p>
<pre><code class="language-php">// todo_logout.php

&lt;?php
session_start();
$_SESSION = array();
if (isset($_COOKIE[session_name()])) {
  setcookie(session_name(), '', time() - 42000, '/');
}
session_destroy();
header('Location:todo_login.php');
exit();

</code></pre>
<h2 id="練習-10"><a class="header" href="#練習-10">練習</a></h2>
<p>ログインとログアウトの処理を実装しよう！</p>
<ol>
<li>ログインフォームを実装！（<code>todo_login.php</code>）</li>
<li>ログイン処理を実装！（<code>todo_login_act.php</code>）</li>
<li>ログアウト処理を実装！（<code>todo_logout.php</code>）</li>
</ol>
<p>以下の動作が確認できればOK．</p>
<ul>
<li>存在するユーザの username と password を入力して一覧ページが表示される．</li>
<li>存在しないユーザの username と password を入力してログインページへのリンクが表示される．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装2認証状態の確認"><a class="header" href="#認証処理の実装2認証状態の確認">認証処理の実装2（認証状態の確認）</a></h1>
<p>todoリストの機能はログインしているときのみアクセスできるようにしたい！</p>
<p>現状では，ログアウトした状態でもURLを手打ちするとアクセスできてしまう．．．</p>
<ul>
<li>登録画面，一覧画面などはログイン済ユーザのみ見られるようにする</li>
<li>ログインをチェックし，ログインしていない状態ならログイン画面に移動</li>
</ul>
<h2 id="ログインしているとはなにか"><a class="header" href="#ログインしているとはなにか">「ログインしている」とはなにか</a></h2>
<p>以下の2つの状態を「ログインしていない」とみなす！！</p>
<ul>
<li>「セッション変数に<code>session_id</code>を持っていない」</li>
<li>「idが最新ではない」はログインしていない状態</li>
</ul>
<h2 id="関数の定義-1"><a class="header" href="#関数の定義-1">関数の定義</a></h2>
<p>上記2条件を用いてログインの有無を判断する関数を作成する．</p>
<p>関数の役割は</p>
<ol>
<li>ログインしていない場合はログインページへ強制送還．</li>
<li>ログインしている場合は<code>session_id</code>を更新してセッション変数に保存する．
<ul>
<li>セッション変数には常に最新の<code>session_id</code>が入っている状態にする．</li>
</ul>
</li>
</ol>
<p>複数のファイルでチェックを行うため，関数ファイルに記述しよう！</p>
<pre><code class="language-php">// functions.php

function check_session_id()
{
  if (!isset($_SESSION[&quot;session_id&quot;]) ||$_SESSION[&quot;session_id&quot;] != session_id()) {
    header('Location:todo_login.php');
    exit();
  } else {
    session_regenerate_id(true);
    $_SESSION[&quot;session_id&quot;] = session_id();
  }
}

</code></pre>
<h2 id="関数の実行-1"><a class="header" href="#関数の実行-1">関数の実行</a></h2>
<p>あとは定義した関数を「ログインしていないときに動いてほしくないPHPファイル」で実行しよう．</p>
<p>セッションの機能を使用するため，<code>session_start();</code>を忘れないように注意！</p>
<p>下記ファイルで実行すると良き．</p>
<ul>
<li><code>todo_input.php</code></li>
<li><code>todo_read.php</code></li>
<li><code>todo_edit.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_update.php</code></li>
<li><code>todo_delete.php</code></li>
</ul>
<pre><code class="language-php">// ログインしていないときに動いてほしくないPHPファイル

&lt;?php
session_start();
include('functions.php');
check_session_id();

</code></pre>
<h3 id="-key-point-11"><a class="header" href="#-key-point-11">💡 Key Point</a></h3>
<blockquote>
<p>「ログインしているユーザだけがアクセスできる画面」と「誰でもアクセスできる画面」がそれぞれどの画面なのかを明確にすることが大切．</p>
<p>同様に管理者ユーザのみがアクセス可能な画面を切り分けることも同様の方法で可能．</p>
</blockquote>
<h2 id="練習-11"><a class="header" href="#練習-11">練習</a></h2>
<p>メインのコンテンツは未ログインだとアクセスできないようにしよう！</p>
<ul>
<li>ログイン状態を確認する関数をつくろう！（functions.php）</li>
<li>コンテンツのページで上記関数を実行しよう！</li>
</ul>
<p>ログアウトした状態で各ページにアクセスできない状態（ログインページに移動）になればOK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db応用_rdb"><a class="header" href="#php_db応用_rdb">PHP_DB応用_RDB</a></h1>
<h2 id="本講義の内容とゴール-4"><a class="header" href="#本講義の内容とゴール-4">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-4"><a class="header" href="#本講義の内容-4">本講義の内容</a></h3>
<ul>
<li>RDBのデータ構造紹介．</li>
<li>SQLを用いたデータ集計（Like機能）．</li>
<li>todoリスト一覧での集計結果表示．</li>
</ul>
<h3 id="本講義のゴール-4"><a class="header" href="#本講義のゴール-4">本講義のゴール</a></h3>
<ul>
<li>データ構造を知り，よくないテーブルのパターンを把握する！</li>
<li>データの件数をカウントし，集計する！</li>
<li>複数のテーブルを結合し，必要なデータをまとめる！</li>
</ul>
<h2 id="準備-4"><a class="header" href="#準備-4">準備</a></h2>
<p>以下4点ができているか確認しよう！</p>
<ul>
<li>XAMPPの起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="rdbの構造"><a class="header" href="#rdbの構造">RDBの構造</a></h1>
<h2 id="rdbrelational-databaseとは"><a class="header" href="#rdbrelational-databaseとは">RDB（Relational Database）とは</a></h2>
<h3 id="複雑なデータが必要なとき"><a class="header" href="#複雑なデータが必要なとき">複雑なデータが必要なとき</a></h3>
<ul>
<li>一つのテーブルから取得できる情報は限られている．</li>
<li>ECで購入したユーザの情報と商品の情報を両方取得したい場合は．．？？</li>
</ul>
<h3 id="複数のテーブル同士を連携relationさせるッ"><a class="header" href="#複数のテーブル同士を連携relationさせるッ">複数のテーブル同士を連携（relation）させるッ！！</a></h3>
<ul>
<li>テーブルの設計段階で連携させたいidのカラムをつくっておく！</li>
<li>両方のテーブルを関連付けるテーブルを「SQLで」作成する！</li>
<li>大事なのはデータの構造を見極めること！！</li>
</ul>
<p>まずは下記2種類のデータ構造をマスターしよう！</p>
<h2 id="one-to-many学部テーブルと学生テーブル"><a class="header" href="#one-to-many学部テーブルと学生テーブル">One to Many（学部テーブルと学生テーブル）</a></h2>
<p>一つの学部には複数の学生が在籍するが，学生の所属は一つ．</p>
<h3 id="学部テーブルdepartment_table"><a class="header" href="#学部テーブルdepartment_table">学部テーブル（department_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>工学部</td></tr>
<tr><td align="right">2</td><td>理学部</td></tr>
<tr><td align="right">3</td><td>医学部</td></tr>
<tr><td align="right">4</td><td>歯学部</td></tr>
<tr><td align="right">5</td><td>農学部</td></tr>
<tr><td align="right">6</td><td>文学部</td></tr>
<tr><td align="right">7</td><td>経済学部</td></tr>
</tbody></table>
<h3 id="学生テーブルstudent_table"><a class="header" href="#学生テーブルstudent_table">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<p>「多」の側に対応するidを入れる構造にすればOK．</p>
<p>誰がどこに所属しているかがわかるようになる！</p>
<table><thead><tr><th align="right">id</th><th>name</th><th align="right">department_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td><td align="right">1</td></tr>
<tr><td align="right">3</td><td>リサリサ</td><td align="right">2</td></tr>
<tr><td align="right">4</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">6</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td><td align="right">4</td></tr>
<tr><td align="right">8</td><td>川尻早人</td><td align="right">4</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td><td align="right">5</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td><td align="right">5</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td><td align="right">6</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td><td align="right">6</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td><td align="right">7</td></tr>
</tbody></table>
<h2 id="many-to-many学生テーブルと講義テーブル"><a class="header" href="#many-to-many学生テーブルと講義テーブル">Many to Many（学生テーブルと講義テーブル）</a></h2>
<p>学生は複数の講義を選択し，講義も複数の学生に提供される．</p>
<h3 id="学生テーブルstudent_table-1"><a class="header" href="#学生テーブルstudent_table-1">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">student_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<h3 id="講義テーブルclass_table"><a class="header" href="#講義テーブルclass_table">講義テーブル（class_table）</a></h3>
<table><thead><tr><th align="right">class_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>線形代数学</td></tr>
<tr><td align="right">2</td><td>微分積分学</td></tr>
<tr><td align="right">3</td><td>電子回路</td></tr>
<tr><td align="right">4</td><td>電気回路</td></tr>
<tr><td align="right">5</td><td>情報学</td></tr>
<tr><td align="right">6</td><td>情報数学</td></tr>
<tr><td align="right">7</td><td>統計学</td></tr>
<tr><td align="right">8</td><td>信号処理</td></tr>
<tr><td align="right">9</td><td>電磁気学</td></tr>
</tbody></table>
<h3 id="中間テーブル"><a class="header" href="#中間テーブル">中間テーブル</a></h3>
<p>この場合，「どの講義を」「どの学生が選択するか」を表す別のテーブルを作成する．</p>
<p>このテーブルのことを「中間テーブル」と呼ぶ．</p>
<table><thead><tr><th align="right">class_id</th><th align="right">student_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">1</td><td align="right">2</td></tr>
<tr><td align="right">1</td><td align="right">7</td></tr>
<tr><td align="right">7</td><td align="right">7</td></tr>
<tr><td align="right">3</td><td align="right">9</td></tr>
<tr><td align="right">1</td><td align="right">6</td></tr>
<tr><td align="right">3</td><td align="right">1</td></tr>
<tr><td align="right">5</td><td align="right">5</td></tr>
<tr><td align="right">7</td><td align="right">5</td></tr>
</tbody></table>
<h2 id="テーブルの設計"><a class="header" href="#テーブルの設計">テーブルの設計</a></h2>
<p>データ構造を考える際には，「どうすればうまくいくか」よりも「このパターンはマズイ」を押さえるとうまくいきやすい．</p>
<p>マズイパターンのことを「アンチパターン」と呼ぶが，まずは下記のパターンがないかどうか確認しよう．</p>
<h3 id="-key-point-12"><a class="header" href="#-key-point-12">💡 Key Point</a></h3>
<blockquote>
<p>出やすいアンチパターン</p>
<ul>
<li>ユーザの操作でテーブルが増える（減る）．</li>
<li>ユーザの操作でカラムが増える（減る）．</li>
<li>一つのセル（でいいのかな？）に複数のデータ（数値など）が入る．</li>
<li>なにかのデータを更新したときに，別のテーブルのデータを更新する必要がある．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装1データの追加1"><a class="header" href="#like機能の実装1データの追加1">Like機能の実装1（データの追加1）</a></h1>
<p>前回までに作成したtodoリストにLike機能（Many to Manyの関係）を追加する！</p>
<h2 id="アプリケーションの動作"><a class="header" href="#アプリケーションの動作">アプリケーションの動作</a></h2>
<ul>
<li>各ユーザは複数のtodoにLikeし，各todoは複数のユーザからLikeされる．</li>
<li>一覧画面のLikeボタンをクリックしたらLikeすることができ，Like数が一覧画面に表示される．</li>
<li>Likeは1ユーザ1Likeに制限する（自演禁止）．</li>
</ul>
<h2 id="必要な作業処理"><a class="header" href="#必要な作業処理">必要な作業・処理</a></h2>
<ul>
<li>ユーザテーブルといいねテーブルを作成．</li>
<li>Likeボタン追加．</li>
<li>Likeボタンクリック時にLikeデータを作成．</li>
<li>Like数を一覧画面に表示する．</li>
</ul>
<h2 id="likeテーブルを作成"><a class="header" href="#likeテーブルを作成">Likeテーブルを作成</a></h2>
<p>新しくテーブルを作成する．テーブル名は「<code>like_table</code>」とする．</p>
<p>このテーブルでは「どのユーザが」「どのtodoに」Likeしたのかを記録する役割を持つ．</p>
<p>前項の「中間テーブル」にあたる．</p>
<h3 id="カラム構造"><a class="header" href="#カラム構造">カラム構造</a></h3>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>user_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>todo_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h2 id="todoリストのlike機能実装"><a class="header" href="#todoリストのlike機能実装">todoリストのLike機能実装</a></h2>
<h3 id="やりたいこと"><a class="header" href="#やりたいこと">やりたいこと</a></h3>
<p>いいねボタンをクリックしたら．．．</p>
<ul>
<li>like_tableに「誰が」「何に」いいねをしたのかを追加</li>
</ul>
<p>実装の方針</p>
<ul>
<li>todo_read.phpにいいねボタンを設置</li>
<li>GETでtodoのidとユーザのidを送信する</li>
<li>受け取り側のファイル（like_create.php）で受け取ったデータをdbに登録</li>
</ul>
<h2 id="todo一覧画面にlikeボタンの設置"><a class="header" href="#todo一覧画面にlikeボタンの設置">todo一覧画面にLikeボタンの設置</a></h2>
<p>一覧画面のタグ生成部分にLikeボタンを追記する．</p>
<p>user_idはログイン時にセッション変数に保存している値を使用する（<code>todo_login_act.php</code>に追記）．</p>
<pre><code class="language-php">// todo_login_act.php

if (!$val) {
  echo &quot;&lt;p&gt;ログイン情報に誤りがあります&lt;/p&gt;&quot;;
  echo &quot;&lt;a href=todo_login.php&gt;ログイン&lt;/a&gt;&quot;;
  exit();
} else {
  $_SESSION = array();
  // ↓ここを追記
  $_SESSION['user_id'] = $val['id'];
  $_SESSION['session_id'] = session_id();
  $_SESSION['is_admin'] = $val['is_admin'];
  $_SESSION['username'] = $val['username'];
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<p><code>user_id</code>と<code>todo_id</code>を<code>like_create.php</code>にGETで送信する．</p>
<pre><code class="language-php">// todo_read.php

$user_id = $_SESSION['user_id'];

// ↓タグ生成部分
foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      // ↓ここ1行追記
      &lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<h2 id="likeデータの追加"><a class="header" href="#likeデータの追加">Likeデータの追加</a></h2>
<p>LikeテーブルにGETで送信されてきた内容を追加する．</p>
<p>処理の流れ自体はシンプルなINSERT処理．</p>
<pre><code class="language-php">// like_create.php

include('functions.php');

$user_id = $_GET['user_id'];
$todo_id = $_GET['todo_id'];

$pdo = connect_to_db();

$sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, now())';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-12"><a class="header" href="#練習-12">練習</a></h2>
<p>todoリストにLike機能を追加しよう．</p>
<ul>
<li><code>todo_read.php</code>にLikeボタンを追加．</li>
<li><code>like_create.php</code>でテーブルにデータ作成．</li>
</ul>
<p>Likeボタンをクリックして，Likeテーブルにデータが作成されていればOK．</p>
<p>（phpmyadminでデータを確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装2データの追加2"><a class="header" href="#like機能の実装2データの追加2">Like機能の実装2（データの追加2）</a></h1>
<h2 id="ここまでのlike機能の問題点"><a class="header" href="#ここまでのlike機能の問題点">ここまでのLike機能の問題点</a></h2>
<h3 id="現状"><a class="header" href="#現状">現状</a></h3>
<ul>
<li>連打すれば無限にLikeできてしまう．．．</li>
<li>Likeしている状況であれば，Likeを取り消す処理にしたい！</li>
</ul>
<h3 id="実装の方針"><a class="header" href="#実装の方針">実装の方針</a></h3>
<ul>
<li>Likeボタンをクリックしたら，まずtodoとuserでテーブルを検索する．</li>
<li>データが1件以上存在すればDELETEのSQLを実行する．</li>
<li>データが存在しなければINSERTのSQL（前項で実装したもの）を実行する．</li>
</ul>
<h2 id="like状態の調査"><a class="header" href="#like状態の調査">Like状態の調査</a></h2>
<p>前項で作成した<code>like_create.php</code>のINSERT処理の前にデータの件数を確認したい．</p>
<p>件数の確認には<code>COUNT()</code>関数を使用する．</p>
<pre><code class="language-php">// like_create.php

// 省略

$sql = 'SELECT COUNT(*) FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $like_count = $stmt-&gt;fetchColumn();
  // まずはデータ確認
  var_dump($like_count);
  exit();
}

</code></pre>
<h2 id="like数で条件分岐削除or作成"><a class="header" href="#like数で条件分岐削除or作成">Like数で条件分岐（削除or作成）</a></h2>
<p><code>$like_count</code>で条件に該当するデータの件数が取得できるのでまずは確認する．</p>
<p>データの件数が確認できたら，件数が0かそれ以外で条件分岐する．0件でなければDELETE文が作成され，0件の場合はINSERT文が作成される．</p>
<pre><code class="language-php">// like_create.php

if ($like_count != 0) {
  // いいねされている状態
  $sql = 'DELETE FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
} else {
  // いいねされていない状態
  $sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, sysdate())';
}

// 以下は前項と変更なし
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<p>このように記述することで，1ユーザ1Likeの状態を実現することができる．</p>
<h2 id="練習-13"><a class="header" href="#練習-13">練習</a></h2>
<p>todoリストのLike機能を編集しよう．</p>
<ul>
<li><code>like_create.php</code>でLike数カウント -&gt; 条件分岐してDELETE or INSERT．</li>
</ul>
<p>以下2条件で動作確認！</p>
<ul>
<li>「Likeされていない状態」でLikeボタンをクリックして，Likeテーブルにデータが作成されていればOK．</li>
<li>「Likeされている状態」でLikeボタンをクリックして，Likeテーブルのデータが削除されていればOK．</li>
</ul>
<p>phpmyadminでデータを確認し，10件程度データが入っている状態にしておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装3集計とlike数表示"><a class="header" href="#like機能の実装3集計とlike数表示">Like機能の実装3（集計とLike数表示）</a></h1>
<h2 id="やりたいこと-1"><a class="header" href="#やりたいこと-1">やりたいこと</a></h2>
<ul>
<li>ここまででLike数を1ユーザあたり1件に制限する処理を実装した．</li>
<li>しかし，現状ではLike状況を確認するにはphpmyadminにアクセスして確認するしかなくアプリケーション側に情報が表示されない．</li>
<li>そこで，本項ではLikeされた件数をtodo一覧画面に表示するための処理を実装する．</li>
</ul>
<h2 id="手順"><a class="header" href="#手順">手順</a></h2>
<ul>
<li>Like情報が保存されている「Likeテーブル」を用いて，各todoが何件Likeされているのかを集計する．</li>
<li>「todoテーブル」と「集計結果のテーブル」を結合し，両方のデータを一度に取得できるようにする．</li>
<li>取得したデータを画面に表示する．</li>
</ul>
<h2 id="集計"><a class="header" href="#集計">集計</a></h2>
<p>GROUP BYを使うと集計ができる！</p>
<h3 id="例phpmyadminで実行しよう"><a class="header" href="#例phpmyadminで実行しよう">例（phpmyadminで実行しよう！）</a></h3>
<pre><code class="language-sql">SELECT
  todo_id,
  COUNT(id) AS like_count
FROM
  like_table
GROUP BY
  todo_id
</code></pre>
<p>「<code>like_table</code>」の「<code>todo_id</code>」ごとに「idの数」を「<code>like_count</code>」というカラム名で表示する．</p>
<p>集計したカラムのカラム名は自由に設定できる（しなくても良い）が，後ほど再利用する場合は何らかの名前を指定しておくのがオススメ．</p>
<p>実行すると下記のような集計結果のテーブルが表示される．下記は一例なので，<code>like_table</code>のデータによって件数は変化する．</p>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="-key-point-13"><a class="header" href="#-key-point-13">💡 Key Point</a></h3>
<blockquote>
<p>このSQL文は「集計結果のテーブル」を出力する！！</p>
</blockquote>
<h3 id="注意点"><a class="header" href="#注意点">注意点</a></h3>
<ul>
<li>COUNT()で件数を取得しているが，集計関数以外だとエラーになる</li>
<li>その他の集計関数
<ul>
<li><code>MIN()</code>, <code>MAX()</code>, <code>SUM()</code>, etc...</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like機能の実装4データの結合"><a class="header" href="#like機能の実装4データの結合">Like機能の実装4（データの結合）</a></h1>
<h2 id="画面表示のためにデータをまとめる"><a class="header" href="#画面表示のためにデータをまとめる">画面表示のためにデータをまとめる．</a></h2>
<ul>
<li>現状，画面の表示は<code>todo_table</code>からデータなので，集計結果を組み込めない．．．</li>
<li>テーブルを結合させることで，集計結果もまとめて表示できる！</li>
</ul>
<h2 id="sqlの考え方"><a class="header" href="#sqlの考え方">SQLの考え方</a></h2>
<ul>
<li>「<code>todo_table</code>」と「集計結果のテーブル」をつなげる．</li>
<li>「<code>todo_table</code>の<code>id</code>」と「集計結果のテーブルの<code>todo_id</code>」を対応させる．</li>
<li>「集計結果のテーブル」は前項で取得したアレ</li>
</ul>
<h2 id="テーブルの結合join"><a class="header" href="#テーブルの結合join">テーブルの結合（JOIN）</a></h2>
<p>JOINを使うとテーブルの結合ができる！</p>
<h3 id="例-1"><a class="header" href="#例-1">例</a></h3>
<p>JOINを使う場合の書式は以下のとおり．この場合は以下の条件で結合する．</p>
<ul>
<li>別々のテーブルで管理している「ユーザ」と「ユーザが所属するカテゴリ」を1つの画面に表示したい．</li>
<li>「<code>user_table</code>」「<code>category_table</code>」を結合する．</li>
<li>結合する際には，「<code>user_table</code>の<code>category_id</code>カラム」と「<code>category_table</code>の<code>category_id</code>カラム」を対応させる．</li>
</ul>
<h3 id="user_table"><a class="header" href="#user_table">user_table</a></h3>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
</tbody></table>
<h3 id="category_table"><a class="header" href="#category_table">category_table</a></h3>
<table><thead><tr><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>ダイヤモンドは砕けない</td></tr>
<tr><td align="right">5</td><td>黄金の風</td></tr>
<tr><td align="right">6</td><td>ストーンオーシャン</td></tr>
<tr><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h3 id="sql文"><a class="header" href="#sql文">SQL文</a></h3>
<pre><code class="language-sql">SELECT
  *
FROM
  user_table
  LEFT OUTER JOIN
    category_table
  ON  user_table.category_id = category_table.category_id
</code></pre>
<h3 id="joinしたテーブル"><a class="header" href="#joinしたテーブル">JOINしたテーブル</a></h3>
<p>このテーブルがあれば，画面に必要な情報を全て表示することができる．SQL文の「ON」の後にどのカラムとどのカラムを対応させるのかと記述する．</p>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h2 id="今回のtodoリストで結合したいテーブルの状況"><a class="header" href="#今回のtodoリストで結合したいテーブルの状況">今回のtodoリストで結合したいテーブルの状況</a></h2>
<p>「<code>todo_table</code>」と「集計結果のテーブル」を結合する．</p>
<h3 id="todo_table"><a class="header" href="#todo_table"><code>todo_table</code></a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td></tr>
<tr><td align="right">2</td><td>PHP課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td></tr>
</tbody></table>
<h3 id="集計結果のテーブル"><a class="header" href="#集計結果のテーブル">集計結果のテーブル</a></h3>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="sql文-1"><a class="header" href="#sql文-1">SQL文</a></h3>
<ul>
<li>今回は「<code>todo_table</code>の<code>id</code>」と「集計結果の<code>todo_id</code>」が対応させる．</li>
<li>「集計結果のテーブル」は前項で<code>GROUP BY</code>して出力したテーブル．このテーブルには<code>result-table</code>という名前をつける．</li>
</ul>
<pre><code class="language-sql">SELECT
  *
FROM
  todo_table
  LEFT OUTER JOIN
    (
      SELECT
        todo_id,
        COUNT(id) AS like_count
      FROM
        like_table
      GROUP BY
        todo_id
    ) AS result_table
  ON  todo_table.id = result_table.todo_id
</code></pre>
<h3 id="出力結果"><a class="header" href="#出力結果">出力結果</a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td><td align="right">NULL</td><td align="right">NULL</td></tr>
</tbody></table>
<h3 id="参考inner-join"><a class="header" href="#参考inner-join">【参考】INNER JOIN</a></h3>
<p><code>LEFT OUTER JOIN</code>の代わりに<code>INNER JOIN</code>を使用すると下記のテーブルが得られる．</p>
<p>（結合元のどちらかのテーブルでデータが欠損している場合は結合結果に表示されない）</p>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="画面に結合したデータを表示"><a class="header" href="#画面に結合したデータを表示">画面に結合したデータを表示</a></h3>
<p>一覧画面で上記のデータを参照し，画面に集計結果を表示する．</p>
<pre><code class="language-php">// todo_read.php

// 省略

$sql = 'SELECT * FROM todo_table LEFT OUTER JOIN (SELECT todo_id, COUNT(id) AS like_count FROM like_table GROUP BY todo_id) AS result_table ON todo_table.id = result_table.todo_id';

// タグ生成部分

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      // ↓ここに`$record[&quot;like_count&quot;]`を追加！
      &lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like{$record[&quot;like_count&quot;]}&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<h2 id="練習-14"><a class="header" href="#練習-14">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ol>
<li><code>GROUP BY</code>を使ってlike_tableのデータを集計しよう（phpmyadminで確認）．</li>
<li><code>JOIN</code>を使用して<code>todo_table</code>と集計結果のテーブルを結合しよう（phpmyadminで確認）．</li>
<li>2で結合したテーブルを用いて，todo一覧画面に集計結果を表示しよう．</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-事前準備"><a class="header" href="#laravel-事前準備">Laravel 事前準備</a></h1>
<p>Laravel で開発をするためには，開発環境を用意する必要がある．一人で開発するときだけでなく，複数人で開発する際には「同じ開発環境」を揃えることが大切である．</p>
<p>更に，フレームワークやライブラリを多用する場合，個々の PC 環境によって細かいバージョンの差異や動作具合に影響が生じることがある．</p>
<p>主な Laravel の開発環境には以下のようなものがある．</p>
<ul>
<li>ローカル環境（XAMPP など）</li>
<li>ローカル上の仮想マシン（vagrant など）</li>
<li>仮想コンテナ（Docker など）</li>
<li>クラウド上の仮想マシン（AWS Cloud9 など）</li>
</ul>
<p>今回は Laravel 公式が準備する機能を用い，仮想マシン上で開発を行う．</p>
<h2 id="多用するコマンドまとめ"><a class="header" href="#多用するコマンドまとめ">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる"><a class="header" href="#仮想コンテナを立ち上げる">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる"><a class="header" href="#仮想コンテナを終了させる">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする"><a class="header" href="#laravel-コンテナへログインする">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする"><a class="header" href="#mysql-コンテナへログインする">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする"><a class="header" href="#コンテナからログアウトする">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="mac-編環境構築"><a class="header" href="#mac-編環境構築">【Mac 編】環境構築</a></h1>
<p>Docker を使用するための準備を進めていく．</p>
<p>必要なもの</p>
<ul>
<li>Docker Desktop</li>
<li>ターミナル（Mac に入っているもので OK）</li>
</ul>
<h2 id="docker-desktop-のダウンロードとインストール"><a class="header" href="#docker-desktop-のダウンロードとインストール">Docker Desktop のダウンロードとインストール</a></h2>
<p>下記の URL にアクセスし，必要なファイルをダウンロードする．</p>
<p>Intel CPU と M1 CPU で異なるので，ダウンロード時は注意すること．</p>
<p><a href="https://hub.docker.com/editions/community/docker-ce-desktop-mac/">https://hub.docker.com/editions/community/docker-ce-desktop-mac/</a></p>
<ol>
<li>
<p>ダウンロードした <code>Docker.dmg</code> をダブルクリックしてインストーラを起動したら，アプリケーション・フォルダに Docker アイコンをドラッグする．</p>
</li>
<li>
<p>アプリケーション・フォルダ内にある <code>Docker.app</code> をダブルクリックし， <code>Docker</code> を起動する．</p>
</li>
<li>
<p>トップステータスバーにある <code>Docker</code> メニュー（クジラのマーク）で， <code>Docker Desktop</code> が実行中で，ターミナルからアクセスできる状態になる．</p>
</li>
</ol>
<h2 id="docker-の動作確認"><a class="header" href="#docker-の動作確認">Docker の動作確認</a></h2>
<p>ターミナルを開いて下記のコマンドを実行し， <code>docker</code> のバージョンが表示されれば準備完了（バージョンなどの数値は資料より新しくて問題ない）．</p>
<pre><code class="language-bash">$ docker -v
Docker version 20.10.8, build 3967b7d

</code></pre>
<p>バージョンが表示されたら，「Laravel プロジェクト作成」項に進もう！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="windows-編環境構築"><a class="header" href="#windows-編環境構築">【Windows 編】環境構築</a></h1>
<p>Docker を使用するための準備を進めていく．</p>
<p>必要なもの</p>
<ul>
<li>Docker Desktop</li>
<li>Windows ターミナル</li>
<li>Ubuntu 20.04</li>
<li>WSL2</li>
<li>PowerShell（Windows にもともと入っている）</li>
</ul>
<h2 id="docker-desktop-のダウンロードとインストール-1"><a class="header" href="#docker-desktop-のダウンロードとインストール-1">Docker Desktop のダウンロードとインストール</a></h2>
<p>下記の URL にアクセスし，必要なファイルをダウンロードする．</p>
<p><a href="https://hub.docker.com/editions/community/docker-ce-desktop-windows/">https://hub.docker.com/editions/community/docker-ce-desktop-windows/</a></p>
<ol>
<li>
<p><code>Docker Desktop Installer.exe</code> をダブルクリックし，インストーラを起動する．</p>
</li>
<li>
<p>確認画面が出たら， <code>Enable Hyper-V Windows Features</code> （Hyper V の Windows 機能を有効にする）のオプションが，設定ページで選択されているかどうかを確認する．OS の状況によっては出てこない場合もあるので，その場合もそのまま進める．</p>
</li>
<li>
<p>インストール・ウィザードの指示に従い，利用規約（ライセンス）を承諾し，インストーラに権限を与えてインストールを進める．</p>
</li>
<li>
<p>インストールに成功したら， <code>Close</code> （閉じる）をクリックしてインストールを終了する．</p>
</li>
</ol>
<h2 id="windows-ターミナルと-ubuntu-2004-のインストール"><a class="header" href="#windows-ターミナルと-ubuntu-2004-のインストール">Windows ターミナルと Ubuntu 20.04 のインストール</a></h2>
<p>以下の URL からそれぞれをインストールする．</p>
<ul>
<li><a href="https://www.microsoft.com/ja-jp/p/windows-terminal/9n0dx20hk701">Windows ターミナル（https://www.microsoft.com/ja-jp/p/windows-terminal/9n0dx20hk701）</a></li>
<li><a href="https://www.microsoft.com/ja-jp/p/ubuntu-2004-lts/9n6svws3rx71">Ubuntu 20.04（https://www.microsoft.com/ja-jp/p/ubuntu-2004-lts/9n6svws3rx71）</a></li>
</ul>
<h2 id="wsl2-のダウンロードインストールと設定"><a class="header" href="#wsl2-のダウンロードインストールと設定">WSL2 のダウンロード，インストールと設定</a></h2>
<ol>
<li>下記の URL から必要なファイルをダウンロードする．</li>
</ol>
<p><a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi</a></p>
<blockquote>
<p>注意</p>
<p>ARM64 マシンを使用している場合は，代わりに<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi">https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi</a>をダウンロードする．</p>
</blockquote>
<ol start="2">
<li>
<p>ダウンロードしたファイルをダブルクリックして実行する．管理者特権のアクセス許可を求めるメッセージが表示される．<code>はい</code> を選択して，インストールを進める．</p>
</li>
<li>
<p>PowerShell を開いて次のコマンドを実行し，新しい Linux ディストリビューションをインストールする際の既定のバージョンとして WSL 2 を設定する．</p>
</li>
</ol>
<pre><code class="language-bash">wsl --set-default-version 2
</code></pre>
<!-- 1. 下記の URL の「Step 4」と「Step 5」を実行する．
    - [https://docs.microsoft.com/en-us/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package](https://docs.microsoft.com/en-us/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package) -->
<ol start="4">
<li>PC を再起動する．</li>
</ol>
<h2 id="docker-の動作確認-1"><a class="header" href="#docker-の動作確認-1">Docker の動作確認</a></h2>
<ol>
<li>
<p>Docker Desktop を起動する．</p>
</li>
<li>
<p>「<code>Setting</code>（画面上部の ⚙ アイコン）」 -&gt; 「<code>General</code>」 -&gt; 「<code>Use the WSL2 based engine</code>」にチェックを入れる．すでにチェックが入っていてユーザが操作できない状態となっている場合があるが，その場合はそのままで OK．</p>
</li>
</ol>
<p><img src="laravel/laravel_setup/./img/docker_setting01.PNG" alt="docker 設定画面01" /></p>
<ol start="3">
<li>「<code>Setting</code>（画面上部の ⚙ アイコン）」 -&gt; 「<code>Resources</code>」 -&gt; 「<code>WSL INTEGRATION</code>」の <code>Enable Integration ...</code> にチェックを入れ，「<code>Ubuntu 20.04</code>」のトグルをオンにする．</li>
</ol>
<ul>
<li>トグルが出てこない場合は PC を再起動する．</li>
<li>再起動してもダメなら以下の手順を試す．
<ul>
<li>Windows のスタートメニューをクリックして「Ubuntu」と入力し，Ubuntu を起動する．</li>
<li>ターミナルのような画面でユーザ名を設定するよう表示されるので，任意のユーザ名を入力する．</li>
<li>続けて，パスワードを設定する．</li>
<li>設定が終了したら <code>exit</code> を入力 →Enter して Ubuntu を終了する．</li>
<li>PowerShell を管理者モードで起動し，<code>wsl --set-default-version 2</code> のコマンドを実行する．</li>
<li>PC を再起動し，Docker Desktop の設定項目を確認する．</li>
</ul>
</li>
</ul>
<p><img src="laravel/laravel_setup/./img/docker_setting02.PNG" alt="docker 設定画面02" /></p>
<ol start="4">
<li>Windows ターミナルを Ubuntu 20.04 で動かす．</li>
</ol>
<p>↓Windows ターミナルを開いて上部の「∨」をクリックするとメニューが出るので，ここで <code>Ubuntu 20.04</code> を選ぶ．出てこない場合は PC を再起動する．</p>
<p><img src="laravel/laravel_setup/./img/terminal_image01.png" alt="Ubuntu 設定箇所" /></p>
<p>↓ このようになっていればコマンドが実行できる．<strong>次項以降もこの状態でコマンドを実行していく．</strong></p>
<p><img src="laravel/laravel_setup/./img/terminal_image02.png" alt="Windows ターミナル動作画面" /></p>
<ol start="5">
<li>下記のコマンドを実行し， <code>docker</code> のバージョンが表示されれば準備完了（バージョンなどの数値は資料より新しくて問題ない）．</li>
</ol>
<pre><code class="language-bash">$ docker -v
Docker version 20.10.8, build 3967b7d

</code></pre>
<p>バージョンが表示されたら，「Laravel プロジェクト作成」項に進もう！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-プロジェクト作成"><a class="header" href="#laravel-プロジェクト作成">Laravel プロジェクト作成</a></h1>
<p>Mac の人は「ターミナル」，Windows の人は「Windows ターミナル」を起動する．</p>
<p>（Windows の人は Ubuntu 20.04 で動かしている状態でコマンドを実行する必要があるので，適宜前項の「Docker の動作確認」を確認しておく．）</p>
<p>下記コマンドでプロジェクトのフォルダができる．<code>laratter</code>部分がプロジェクト名となる．</p>
<p><strong>コマンドはデスクトップなどわかりやすい場所で実行する．作成された<code>laratter</code>フォルダに必要なファイルが全て含まれている．</strong></p>
<pre><code class="language-bash">$ curl -s https://laravel.build/laratter | bash
</code></pre>
<p>実行結果</p>
<pre><code>
 _                               _
| |                             | |
| |     __ _ _ __ __ ___   _____| |
| |    / _` | '__/ _` \ \ / / _ \ |
| |___| (_| | | | (_| |\ V /  __/ |
|______\__,_|_|  \__,_| \_/ \___|_|

Warning: TTY mode requires /dev/tty to be read/writable.
    Creating a &quot;laravel/laravel&quot; project at &quot;./laratter&quot;
    Installing laravel/laravel (v8.6.2)
      - Downloading laravel/laravel (v8.6.2)
      - Installing laravel/laravel (v8.6.2): Extracting archive
    Created project in /opt/laratter
    &gt; @php -r &quot;file_exists('.env') || copy('.env.example', '.env');&quot;
    Loading composer repositories with package information
    Updating dependencies
...

</code></pre>
<p>途中，Laravel 側でいろいろ実行するため PC のログインパスワードを求められるので入力する．</p>
<pre><code class="language-bash">Please provide your password so we can make some final adjustments to your application's permissions.

[sudo] password for taroosg:

Thank you! We hope you build something incredible. Dive in with: cd laratter &amp;&amp; ./vendor/bin/sail up

</code></pre>
<h2 id="権限の変更"><a class="header" href="#権限の変更">権限の変更</a></h2>
<p>この方法でプロジェクトを作成するとエディタで操作する場合に権限で引っかかる場合があるので権限を変更する．</p>
<pre><code class="language-bash">$ sudo chmod -R 777 laratter
</code></pre>
<p>権限が変更できない場合は下記 URL の設定を行い再度コマンドを実行する．</p>
<p><a href="https://gori.me/mac/mac-tips/112082">参考 URL</a></p>
<h2 id="起動"><a class="header" href="#起動">起動</a></h2>
<p>早速仮想コンテナを立ち上げる．</p>
<pre><code class="language-bash">$ cd laratter
$ ./vendor/bin/sail up -d
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Creating network &quot;laratter_sail&quot; with driver &quot;bridge&quot;
Creating volume &quot;laratter_sailmysql&quot; with local driver
Creating volume &quot;laratter_sailredis&quot; with local driver
Creating volume &quot;laratter_sailmeilisearch&quot; with local driver
Creating laratter_mailhog_1     ... done
Creating laratter_redis_1       ... done
Creating laratter_mysql_1       ... done
Creating laratter_selenium_1    ... done
Creating laratter_meilisearch_1 ... done
Creating laratter_laravel.test_1 ... done
</code></pre>
<h2 id="動作確認"><a class="header" href="#動作確認">動作確認</a></h2>
<p>ブラウザで<code>localhost</code>にアクセスし，下記画面が表示されれば OK．</p>
<p><img src="laravel/laravel_setup/./img/laravel-firstview.png" alt="トップ画面" /></p>
<p><strong>！！！この画面が表示されたら OK！次項の「終了するとき」を実行して事前準備は完了！！！</strong></p>
<p>コマンド実行時にエラーが出る場合や，画面が表示されない場合は以下の「エラーが出る場合」を確認しよう．</p>
<h2 id="終了するとき"><a class="header" href="#終了するとき">終了するとき</a></h2>
<p>仮想マシン（コンテナ）を終了させる場合は以下のコマンドを実行する．</p>
<p>コンテナが立ち上がっていると XAMPP が立ち上がらなくなるため，開発が終わったら下記コマンドで終了させること．</p>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h2 id="エラーが出る場合"><a class="header" href="#エラーが出る場合">エラーが出る場合</a></h2>
<h3 id="xampp-が動いている"><a class="header" href="#xampp-が動いている">XAMPP が動いている</a></h3>
<p>XAMPP が動いていると立ち上がらない場合があるため，一度 XAMPP を終了させてから再度コマンドを実行する．</p>
<p>また，Laravel の仮想コンテナが立ち上がっていると XAMPP が動かない場合があるので，XAMPP で開発を行う場合には仮想コンテナを終了させておく．</p>
<h3 id="pc-再起動"><a class="header" href="#pc-再起動">PC 再起動</a></h3>
<p>PC を再起動すると解決する場合が多い．</p>
<h3 id="docker-desktop-のバージョンアップ"><a class="header" href="#docker-desktop-のバージョンアップ">Docker Desktop のバージョンアップ</a></h3>
<p>Docker Desktop を以前からインストールしていた場合，バージョンが古いと起動しない場合はあるので最新バージョンにアップデートを行う．</p>
<h3 id="ファイヤーウォールを無効化する"><a class="header" href="#ファイヤーウォールを無効化する">ファイヤーウォールを無効化する</a></h3>
<p>途中でエラーが出る場合はファイヤーウォールで必要なファイルのダウンロードができていない場合がある．その場合は一旦ファイヤーウォールを無効化して，再度プロジェクト作成コマンドを実行する．</p>
<h3 id="m1-の-mac-でerror-no-matching-manifest-for-linuxarm64v8-in-the-manifest-list-entriesが出る"><a class="header" href="#m1-の-mac-でerror-no-matching-manifest-for-linuxarm64v8-in-the-manifest-list-entriesが出る">M1 の Mac で<code>ERROR: no matching manifest for linux/arm64/v8 in the manifest list entries</code>が出る</a></h3>
<p>エディタなどで<code>docker-compoes.yml</code>を開き，下記を追加する，</p>
<pre><code class="language-yml">platform: &quot;linux/x86_64&quot;
</code></pre>
<p>追記場所はこのへん．</p>
<pre><code class="language-yml">mysql:
  image: &quot;mysql:8.0&quot;
  platform: &quot;linux/x86_64&quot;
</code></pre>
<p><a href="https://neoighodaro.com/posts/3-running-laravel-and-docker-on-the-apple-mac-m1">参考：https://neoighodaro.com/posts/3-running-laravel-and-docker-on-the-apple-mac-m1</a></p>
<h3 id="m1-の-mac-でlaraveltest-failed的なエラーが出る"><a class="header" href="#m1-の-mac-でlaraveltest-failed的なエラーが出る">M1 の Mac で<code>laravel.test failed</code>的なエラーが出る</a></h3>
<p>エディタで<code>laratter/vendor/laravel/sail/runtimes/8.0/Dockerfile</code>を開き．34 行目と 35 行目をコメントアウトする．</p>
<p>↓ この 2 行をコメントアウトする（バージョンによって異なるので，該当ファイルの記述内容をよく確認すること）</p>
<pre><code>&amp;&amp; curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \
&amp;&amp; echo &quot;deb https://dl.yarnpkg.com/debian/ stable main&quot; &gt; /etc/apt/sources.list.d/yarn.list \
</code></pre>
<h2 id="いけてそうだけどブラウザで表示できない"><a class="header" href="#いけてそうだけどブラウザで表示できない">いけてそうだけどブラウザで表示できない</a></h2>
<p>アクセスするときの URL を<code>https://localhost</code>から<code>http://localhost</code>に変更</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="補足docker-と-docker-compose-の解説"><a class="header" href="#補足docker-と-docker-compose-の解説">【補足】Docker と Docker Compose の解説</a></h1>
<h2 id="docker-とは"><a class="header" href="#docker-とは">Docker とは</a></h2>
<p>コンテナ型の仮想化技術を提供するプロダクト．</p>
<h2 id="仮想化とは"><a class="header" href="#仮想化とは">「仮想化」とは</a></h2>
<p>物理的な PC やサーバ上に仮想的なマシンを動かすこと．</p>
<p>仮想化を用いる利点としては下記が挙げられる．</p>
<ul>
<li>異なるコンピュータ間でも同じ環境を用意できる．</li>
<li>コンピュータ内の状況に依らず，開発や運用をおこなうことができる（仮想マシン同士は独立に動作する）．</li>
<li>不具合があった場合にもすぐに環境を作り直すことができる．</li>
</ul>
<p>反面，デメリットとしては下記が挙げられる．</p>
<ul>
<li>コンピュータ上でマシンを複数台動作させている状況なので，リソースを圧迫する．</li>
<li>それなりのマシンスペックが求められる．</li>
<li>仮想マシンを共有する場合にファイルが重い．</li>
</ul>
<p>↓ 仮想マシンの大雑把な仕組み</p>
<p><img src="laravel/laravel_setup/./img/docker_vm.svg" alt="仮想マシンの大雑把な仕組み" /></p>
<h2 id="コンテナ型とは"><a class="header" href="#コンテナ型とは">「コンテナ型」とは</a></h2>
<p>通常の仮想化が「仮想マシン」を OS レベルから構成していたのに対し，コンテナ型の場合は Docker が OS などの環境を準備してくれる．</p>
<p>そのため，通常の仮想化よりも</p>
<ul>
<li>軽量であるため，複数のコンテナを同時に動作させることもできる．各コンテナは独立に動作し，お互いに影響しない．</li>
<li>Docker さえ準備しておけば，「Dockerfile」という設定ファイルを共有することで簡単に環境を再現可能．</li>
</ul>
<p>などの利点がある．</p>
<p>これにより，Docker では複雑なアーキテクチャを持つプロダクトであっても簡単に複数のマシンで実行環境を共有できる．</p>
<p>↓ コンテナの大雑把な仕組み</p>
<p><img src="laravel/laravel_setup/./img/docker_container.svg" alt="コンテナの大雑把な仕組み" /></p>
<h2 id="コンテナの仕組み"><a class="header" href="#コンテナの仕組み">コンテナの仕組み</a></h2>
<p>コンテナは以下の要素から作られている．</p>
<ul>
<li>Application</li>
<li>Image</li>
</ul>
<h3 id="application-とは"><a class="header" href="#application-とは">Application とは</a></h3>
<p>実際にコンテナ内で開発，動作させるアプリケーション．今回は Laravel がこれに当たり，開発しているときは個々の部分のコードを書くこととなる．</p>
<h3 id="image-とは"><a class="header" href="#image-とは">Image とは</a></h3>
<p>イメージは「仮想マシンの構成を定義するもの」で，アプリケーションを動作させるために必要なもの（OS，言語，など）を用意する．「Docker Image」と呼ばれ，オンライン上の「DockerHub」からダウンロードして用いることができる．</p>
<p>また，用意する OS 上で任意のコマンドなど実行してライブラリ等インストールしたい場合は「Dockerfile」と呼ばれる設定ファイルにその旨を記述する．</p>
<p>イメージは「環境」であるため一度作成されたら編集は不可能．</p>
<h2 id="コンテナの問題点"><a class="header" href="#コンテナの問題点">コンテナの問題点</a></h2>
<p>コンテナを用意するときは，「1 コンテナ 1 役割」で用意する．</p>
<p>そのため，アプリケーションを開発する際には複数のコンテナが必要になることが多い．</p>
<p>例：</p>
<ul>
<li>Web サーバ用コンテナ</li>
<li>アプリケーションサーバ用コンテナ</li>
<li>DB サーバ用コンテナ</li>
</ul>
<p>しかし，コンテナ数が多くなると管理が面倒な上，「各コンテナは独立に動作し，お互いに影響しない」ため，実行順などによってはうまく連携しない場合も発生する．</p>
<h2 id="docker-compose-とは"><a class="header" href="#docker-compose-とは">Docker Compose とは</a></h2>
<p>Docker Compose は上記のような場合に「複数のコンテナを連携させて管理・運用するプロダクト」である．</p>
<p>連携させるコンテナの情報は「<code>Docker-compose.yaml</code>」ファイルに記述する．</p>
<p><code>Docker-compose.yaml</code> はインデントによってデータ構成を表すため，不用意にインデントを崩さないよう注意する．</p>
<p>まずは「ファイル内の <code>services</code> 直下部分がコンテナを表す」を押さえておけば OK．</p>
<p>↓ Docker compose のイメージ</p>
<p><img src="laravel/laravel_setup/./img/docker_docker-conpose.svg" alt="Docker Composeのイメージ" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ライブラリ準備"><a class="header" href="#ライブラリ準備">ライブラリ準備</a></h1>
<h2 id="ライブラリ準備-1"><a class="header" href="#ライブラリ準備-1">ライブラリ準備</a></h2>
<p>作成するアプリケーションでライブラリを使用する場合はコマンドでインストールを行う．今回は認証を実装するための<code>Laravel Breeze</code>をインストールする．</p>
<p>Laravel のプロジェクト内でコマンドを実行する場合には，下記コマンドで仮想コンテナにログインする必要がある．</p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@81f8517c4e7f:/var/www/html#
</code></pre>
<p>仮想コンテナから出る場合には下記のコマンドを実行する．</p>
<pre><code class="language-bash">root@81f8517c4e7f:/var/www/html# exit
exit
$
</code></pre>
<p><strong>以降のコマンドは仮想コンテナにログインした状態（ターミナルが<code>/var/www/html# </code>になっている状態）で行うこと</strong></p>
<p>下記コマンドを実行し，必要なファイルをダウンロードする．</p>
<pre><code class="language-bash">$ composer require laravel/breeze --dev
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">...
Discovered Package: nesbot/carbon
Discovered Package: nunomaduro/collision
Package manifest generated successfully.
73 packages you are using are looking for funding.
Use the `composer fund` command to find out more!
</code></pre>
<p>下記コマンドでインストールする．</p>
<pre><code class="language-bash">$ php artisan breeze:install
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Breeze scaffolding installed successfully.
Please execute the &quot;npm install &amp;&amp; npm run dev&quot; command to build your assets.
</code></pre>
<p>下記コマンドを実行し，その他必要なパッケージをインストールしてビルドする（ここで Node.js が動く）．</p>
<pre><code class="language-bash">$ npm install &amp;&amp; npm run dev
</code></pre>
<p>実行結果（やや時間がかかる）</p>
<pre><code class="language-bash">✔ Compiled Successfully in 4720ms
┌───────────────────────────────────────────────────────────────────┬──────────┐
│                                                              File │ Size     │
├───────────────────────────────────────────────────────────────────┼──────────┤
│                                                        /js/app.js │ 673 KiB  │
│                                                       css/app.css │ 3.82 MiB │
└───────────────────────────────────────────────────────────────────┴──────────┘
webpack compiled successfully
</code></pre>
<p>ブラウザで localhost にアクセスし，動作を確認する．</p>
<p>以下の画面が表示されれば OK（右上に<code>Login</code>と<code>register</code>が表示される）．</p>
<p><img src="laravel/laravel_setup/./img/breeze-installed.png" alt="breezeインストール確認" /></p>
<p>右上の<code>register</code>をクリックするとユーザ登録画面に移動するが，まだこの段階ではユーザ登録機能は動作しない．ユーザ登録画面が表示されれば OK．</p>
<p><img src="laravel/laravel_setup/./img/register.png" alt="register画面" /></p>
<p>ここまででライブラリの準備は完了．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="今回は不要データベース準備"><a class="header" href="#今回は不要データベース準備">【今回は不要】データベース準備</a></h1>
<h2 id="mysql-の状態を確認"><a class="header" href="#mysql-の状態を確認">MySQL の状態を確認</a></h2>
<p>今回の SNS アプリケーションでは，DB として MySQL を使用する．</p>
<p>すでに MySQL 自体は動作する状態になっているが，自分で確認したい場合もある．下記手順を実行し，MySQL にログインする．</p>
<p><strong>コンテナへログインしている場合は一旦<code>exit</code>で通常のターミナルに戻って実行すること</strong></p>
<h3 id="db-用のコンテナへログイン"><a class="header" href="#db-用のコンテナへログイン">DB 用のコンテナへログイン</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
root@d984f6614597:/#
</code></pre>
<h3 id="mysql-へログイン"><a class="header" href="#mysql-へログイン">MySQL へログイン</a></h3>
<p>ユーザ名<code>sail</code>，パスワード<code>password</code>でログインできる．</p>
<p>パスワードを求められるので「<code>password</code>」を入力して Enter（パスワードは画面上に表示されないので注意）．</p>
<pre><code class="language-bash">root@d984f6614597:/# mysql -u sail -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 29
Server version: 8.0.25 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
</code></pre>
<h3 id="db-状況の確認"><a class="header" href="#db-状況の確認">DB 状況の確認</a></h3>
<p>すでに今回のアプリケーションで使用するデータベースを作成されている．データベース名は <code>laratter</code>（プロジェクト名を同じ）．</p>
<p>下記コマンドを実行してデータベースの一覧を表示する．</p>
<pre><code class="language-bash">mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| laratter           |
+--------------------+
2 rows in set (0.03 sec)
</code></pre>
<p>確認できたらログアウトする．</p>
<pre><code class="language-bash">mysql&gt; exit;
Bye
</code></pre>
<h2 id="laravel-から-db-に接続するための設定"><a class="header" href="#laravel-から-db-に接続するための設定">Laravel から DB に接続するための設定</a></h2>
<p>続いて，Laravel から MySQL にアクセスするための設定を行う．今回はプロジェクト作成の時点で設定されているため項目の確認のみ行う．</p>
<p>エディタから<code>.env</code>ファイルを開く．<code>.env</code>ファイルは<code>laratter</code>ディレクトリの直下に配置されている．</p>
<pre><code class="language-env">DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=laratter
DB_USERNAME=sail
DB_PASSWORD=password
</code></pre>
<p>それぞれ下記の意味となっている．デプロイする場合などはサービス提供者側からそれぞれ情報が提供されるため，必要に応じて編集する．</p>
<table><thead><tr><th>項目</th><th>意味</th></tr></thead><tbody>
<tr><td>DB_CONNECTION</td><td>DB の種類</td></tr>
<tr><td>DB_HOST</td><td>DB のホスト名</td></tr>
<tr><td>DB_PORT</td><td>DB のポート</td></tr>
<tr><td>DB_DATABASE</td><td>DB 名</td></tr>
<tr><td>DB_USERNAME</td><td>DB にログインするときのユーザ名</td></tr>
<tr><td>DB_PASSWORD</td><td>DB にログインするときのパスワード</td></tr>
</tbody></table>
<p>もし<code>.env</code>ファイルを更新する場合はキャッシュをクリアする．</p>
<blockquote>
<p>設定ファイルはサーバ起動時にキャッシュに保存されるため，変更した場合は「キャッシュをクリアする」「コンテナを立ち上げ直す」のどちらかが必要になる．</p>
<p>キャッシュクリアのコマンドを実行する場合は Laravel の仮想コンテナにログインした状態で行うこと．</p>
</blockquote>
<pre><code class="language-bash">$ php artisan config:cache
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Configuration cache cleared!
Configuration cached successfully!
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpmyadmin-の追加"><a class="header" href="#phpmyadmin-の追加">phpmyadmin の追加</a></h1>
<h2 id="コンテナの停止"><a class="header" href="#コンテナの停止">コンテナの停止</a></h2>
<p>コンテナが動いている場合は下記コマンドで停止させる．</p>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h2 id="phpmyadmin-のコンテナを追加"><a class="header" href="#phpmyadmin-のコンテナを追加">phpmyadmin のコンテナを追加</a></h2>
<p><code>docker-compose.yml</code>に下記を追記する．</p>
<pre><code class="language-yml">phpmyadmin:
  image: phpmyadmin/phpmyadmin
  links:
    - mysql:mysql
  ports:
    - 8080:80
  environment:
    MYSQL_USERNAME: &quot;${DB_USERNAME}&quot;
    MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
    PMA_HOST: mysql
  networks:
    - sail
</code></pre>
<p>追記場所は<code>selenium</code>付近．</p>
<pre><code class="language-yml">selenium:
  image: &quot;selenium/standalone-chrome&quot;
  volumes:
    - &quot;/dev/shm:/dev/shm&quot;
  networks:
    - sail
# この下に追記
</code></pre>
<p><strong>yaml ファイルはインデントが重要となるため全コピペ推奨．</strong></p>
<p>↓【M1 Mac 以外の人】</p>
<pre><code class="language-yaml"># For more information: https://laravel.com/docs/sail
version: &quot;3&quot;
services:
  laravel.test:
    build:
      context: ./vendor/laravel/sail/runtimes/8.0
      dockerfile: Dockerfile
      args:
        WWWGROUP: &quot;${WWWGROUP}&quot;
    image: sail-8.0/app
    extra_hosts:
      - &quot;host.docker.internal:host-gateway&quot;
    ports:
      - &quot;${APP_PORT:-80}:80&quot;
    environment:
      WWWUSER: &quot;${WWWUSER}&quot;
      LARAVEL_SAIL: 1
      XDEBUG_MODE: &quot;${SAIL_XDEBUG_MODE:-off}&quot;
      XDEBUG_CONFIG: &quot;${SAIL_XDEBUG_CONFIG:-client_host=host.docker.internal}&quot;
    volumes:
      - &quot;.:/var/www/html&quot;
    networks:
      - sail
    depends_on:
      - mysql
      - redis
      - meilisearch
      - selenium
  mysql:
    image: &quot;mysql:8.0&quot;
    ports:
      - &quot;${FORWARD_DB_PORT:-3306}:3306&quot;
    environment:
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_DATABASE: &quot;${DB_DATABASE}&quot;
      MYSQL_USER: &quot;${DB_USERNAME}&quot;
      MYSQL_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_ALLOW_EMPTY_PASSWORD: &quot;yes&quot;
    volumes:
      - &quot;sailmysql:/var/lib/mysql&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-p${DB_PASSWORD}&quot;]
      retries: 3
      timeout: 5s
  redis:
    image: &quot;redis:alpine&quot;
    ports:
      - &quot;${FORWARD_REDIS_PORT:-6379}:6379&quot;
    volumes:
      - &quot;sailredis:/data&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      retries: 3
      timeout: 5s
  meilisearch:
    image: &quot;getmeili/meilisearch:latest&quot;
    ports:
      - &quot;${FORWARD_MEILISEARCH_PORT:-7700}:7700&quot;
    volumes:
      - &quot;sailmeilisearch:/data.ms&quot;
    networks:
      - sail
    healthcheck:
      test:
        [
          &quot;CMD&quot;,
          &quot;wget&quot;,
          &quot;--no-verbose&quot;,
          &quot;--spider&quot;,
          &quot;http://localhost:7700/health&quot;,
        ]
      retries: 3
      timeout: 5s
  mailhog:
    image: &quot;mailhog/mailhog:latest&quot;
    ports:
      - &quot;${FORWARD_MAILHOG_PORT:-1025}:1025&quot;
      - &quot;${FORWARD_MAILHOG_DASHBOARD_PORT:-8025}:8025&quot;
    networks:
      - sail
  selenium:
    image: &quot;selenium/standalone-chrome&quot;
    volumes:
      - &quot;/dev/shm:/dev/shm&quot;
    networks:
      - sail
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    links:
      - mysql:mysql
    ports:
      - 8080:80
    environment:
      MYSQL_USERNAME: &quot;${DB_USERNAME}&quot;
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      PMA_HOST: mysql
    networks:
      - sail
networks:
  sail:
    driver: bridge
volumes:
  sailmysql:
    driver: local
  sailredis:
    driver: local
  sailmeilisearch:
    driver: local
</code></pre>
<p>↓【M1 Mac の人】</p>
<pre><code class="language-yaml"># For more information: https://laravel.com/docs/sail
version: &quot;3&quot;
services:
  laravel.test:
    build:
      context: ./vendor/laravel/sail/runtimes/8.0
      dockerfile: Dockerfile
      args:
        WWWGROUP: &quot;${WWWGROUP}&quot;
    image: sail-8.0/app
    extra_hosts:
      - &quot;host.docker.internal:host-gateway&quot;
    ports:
      - &quot;${APP_PORT:-80}:80&quot;
    environment:
      WWWUSER: &quot;${WWWUSER}&quot;
      LARAVEL_SAIL: 1
      XDEBUG_MODE: &quot;${SAIL_XDEBUG_MODE:-off}&quot;
      XDEBUG_CONFIG: &quot;${SAIL_XDEBUG_CONFIG:-client_host=host.docker.internal}&quot;
    volumes:
      - &quot;.:/var/www/html&quot;
    networks:
      - sail
    depends_on:
      - mysql
      - redis
      - meilisearch
      - selenium
  mysql:
    image: &quot;mysql:8.0&quot;
    platform: &quot;linux/x86_64&quot;
    ports:
      - &quot;${FORWARD_DB_PORT:-3306}:3306&quot;
    environment:
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_DATABASE: &quot;${DB_DATABASE}&quot;
      MYSQL_USER: &quot;${DB_USERNAME}&quot;
      MYSQL_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_ALLOW_EMPTY_PASSWORD: &quot;yes&quot;
    volumes:
      - &quot;sailmysql:/var/lib/mysql&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-p${DB_PASSWORD}&quot;]
      retries: 3
      timeout: 5s
  redis:
    image: &quot;redis:alpine&quot;
    ports:
      - &quot;${FORWARD_REDIS_PORT:-6379}:6379&quot;
    volumes:
      - &quot;sailredis:/data&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      retries: 3
      timeout: 5s
  meilisearch:
    image: &quot;getmeili/meilisearch:latest&quot;
    ports:
      - &quot;${FORWARD_MEILISEARCH_PORT:-7700}:7700&quot;
    volumes:
      - &quot;sailmeilisearch:/data.ms&quot;
    networks:
      - sail
    healthcheck:
      test:
        [
          &quot;CMD&quot;,
          &quot;wget&quot;,
          &quot;--no-verbose&quot;,
          &quot;--spider&quot;,
          &quot;http://localhost:7700/health&quot;,
        ]
      retries: 3
      timeout: 5s
  mailhog:
    image: &quot;mailhog/mailhog:latest&quot;
    ports:
      - &quot;${FORWARD_MAILHOG_PORT:-1025}:1025&quot;
      - &quot;${FORWARD_MAILHOG_DASHBOARD_PORT:-8025}:8025&quot;
    networks:
      - sail
  selenium:
    image: &quot;selenium/standalone-chrome&quot;
    volumes:
      - &quot;/dev/shm:/dev/shm&quot;
    networks:
      - sail
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    links:
      - mysql:mysql
    ports:
      - 8080:80
    environment:
      MYSQL_USERNAME: &quot;${DB_USERNAME}&quot;
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      PMA_HOST: mysql
    networks:
      - sail
networks:
  sail:
    driver: bridge
volumes:
  sailmysql:
    driver: local
  sailredis:
    driver: local
  sailmeilisearch:
    driver: local
</code></pre>
<h2 id="動作確認-1"><a class="header" href="#動作確認-1">動作確認</a></h2>
<p>下記コマンドでコンテナを起動する．</p>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<p>立ち上がったら，ブラウザで<code>localhost:8080</code>にアクセスすると phpmyadmin にアクセスできる．</p>
<p>ユーザ名とパスワードは以下の通り．</p>
<table><thead><tr><th>ユーザ名</th><th>パスワード</th></tr></thead><tbody>
<tr><td><code>sail</code></td><td><code>password</code></td></tr>
</tbody></table>
<h2 id="注意点-1"><a class="header" href="#注意点-1">注意点</a></h2>
<p>Laravel ではテーブルの設定などはマイグレーションによって行うため，phpmyadmin で不用意に操作すると予期しないエラーが発生する場合がある．</p>
<p>そのため，カラム名の調整などは phpmyadmin から行わないことをオススメする．</p>
<p>レコードの追加などは問題ないので適宜活用していきましょう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day06"><a class="header" href="#day06">Day06</a></h1>
<h2 id="コンテナの起動と-vs-code-の準備"><a class="header" href="#コンテナの起動と-vs-code-の準備">コンテナの起動と vs code の準備</a></h2>
<p>laratter ディレクトリに移動して下記コマンドでコンテナを起動！</p>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<p>↓ 起動したときのターミナル</p>
<p><img src="laravel/laravel01/./img/laratter_start_terminal.png" alt="コンテナ起動時のターミナル" /></p>
<p>↓ ブラウザは <code>localhost</code> にアクセス！</p>
<p><img src="laravel/laravel01/./img/laratter_start_browser.png" alt="localhost画面" /></p>
<p>↓ vs code で laratter フォルダを開く（エディタ画面左のディレクトリ構成を確認）！</p>
<p><img src="laravel/laravel01/./img/laratter_start_vscode.png" alt="vs code 画面" /></p>
<h2 id="本日の内容"><a class="header" href="#本日の内容">本日の内容</a></h2>
<ul>
<li>MVC フレームワークについての解説．</li>
<li>開発環境についての解説．</li>
<li>SNS アプリケーションの実装（データ作成，一覧表示まで）．</li>
</ul>
<h2 id="本日の目標"><a class="header" href="#本日の目標">本日の目標</a></h2>
<ul>
<li>MVC フレームワークである Laravel の動き方や考え方を学ぶ．</li>
<li>SNS アプリケーションの実装を通して，開発の手順や流れに慣れる．</li>
<li>PHP での実装と Laravel での実装について，共通点や相違点を把握する．</li>
</ul>
<h2 id="ルーティング表"><a class="header" href="#ルーティング表">ルーティング表</a></h2>
<p>後ほど解説します！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドまとめ-1"><a class="header" href="#多用するコマンドまとめ-1">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる-1"><a class="header" href="#仮想コンテナを立ち上げる-1">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる-1"><a class="header" href="#仮想コンテナを終了させる-1">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする-1"><a class="header" href="#laravel-コンテナへログインする-1">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする-1"><a class="header" href="#mysql-コンテナへログインする-1">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする-1"><a class="header" href="#コンテナからログアウトする-1">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-と-mvc-フレームワーク"><a class="header" href="#laravel-と-mvc-フレームワーク">Laravel と MVC フレームワーク</a></h1>
<p>Laravel とは PHP の MVC フレームワークである．</p>
<h2 id="フレームワークとは"><a class="header" href="#フレームワークとは">フレームワークとは</a></h2>
<p>フレームワークとは．．．</p>
<ul>
<li>ある言語で作るシステムの枠組み．考え方．</li>
<li>よく使う関数やクラスが用意されている．</li>
<li>規則が決まっているので，誰が書いても似たコードになる．</li>
</ul>
<h3 id="メリットとデメリット"><a class="header" href="#メリットとデメリット">メリットとデメリット</a></h3>
<ul>
<li>✅ 組み込まれている機能があるので実装の負荷が少ない．</li>
<li>✅ コードの品質担保による保守管理の負荷低減．</li>
<li>✅ セキュリティ面での担保．</li>
<li>🔼 学習コスト．</li>
<li>🔼 環境構築．</li>
</ul>
<h3 id="各言語のフレームワークの例"><a class="header" href="#各言語のフレームワークの例">各言語のフレームワークの例</a></h3>
<table><thead><tr><th>言語</th><th>フレームワーク</th></tr></thead><tbody>
<tr><td>PHP</td><td>Laravel, CakePHP, Symphony</td></tr>
<tr><td>Ruby</td><td>Ruby on Rails</td></tr>
<tr><td>Python</td><td>Django, Flask</td></tr>
<tr><td>Node.js</td><td>Express, NestJS</td></tr>
<tr><td>JavaScript</td><td>Next.js, Gatsby.js, Nuxt.js</td></tr>
</tbody></table>
<p>※あくまで一例，他にもたくさんあります．．！</p>
<h3 id="laravel-の特徴"><a class="header" href="#laravel-の特徴">Laravel の特徴</a></h3>
<ul>
<li>今最もアツい PHP フレームワーク！</li>
<li>Web サービスで使用する機能が豊富に用意されている．
<ul>
<li>DB 操作関連の機能（論理削除など）</li>
<li>メール通知機能</li>
</ul>
</li>
<li>画面を柔軟に作成できる blade テンプレート．</li>
<li><code>artisan</code>コマンドによる手軽なライブラリ操作．</li>
<li>とにかく自由（ディレクトリ構成，処理の記述場所など）</li>
</ul>
<h2 id="mvc-とは"><a class="header" href="#mvc-とは">MVC とは</a></h2>
<p><strong>MVC とは，役割分担の概念であるッ！</strong></p>
<p>これまでは適当な PHP ファイルに処理を全部書いていた！</p>
<ul>
<li>ファイル数が増える．．．</li>
<li>あの処理，どのファイルに書いたっけ．．？？</li>
<li>バグあったけど次の処理が他の人の書いたファイルに．．．（チーム開発）</li>
</ul>
<p>=&gt; いずれ詰む未来が見える．．．</p>
<p>=&gt; せや，処理毎に別々のところに書いて管理や分類をしやすくしたろ！MVC の 3 つくらいでええやろ！</p>
<h3 id="役割分担"><a class="header" href="#役割分担">役割分担</a></h3>
<table><thead><tr><th>name</th><th>役割</th></tr></thead><tbody>
<tr><td>Model</td><td>データの操作を行う役割．<br>データの「作成」「参照」「更新」「削除」し，その結果を出力．</td></tr>
<tr><td>View</td><td>ブラウザの表示領域を作成する役割．<br>受け取ったデータ処理の結果を html に埋め込み，出力する．</td></tr>
<tr><td>Controller</td><td>リクエストとレスポンスを行う．その間のことをいい感じにやる．<br>Model と View に司令を出す，処理の流れを決める役割．</td></tr>
<tr><td>Route</td><td>アクセスされた URL に応じて処理を振り分ける．URL と Controller の関数の対応を決める．<br>実際の処理は Controller を通じて Model や View が実行する．</td></tr>
</tbody></table>
<h3 id="処理のイメージ"><a class="header" href="#処理のイメージ">処理のイメージ</a></h3>
<p>MVC では処理によって役割分担されているため，「処理の順番」と「データ流れ」を把握することが理解への近道である．</p>
<p>例として，DB から取り出したデータを一覧画面に表示する流れを考えてみる．</p>
<h3 id="リクエストからの処理の流れ"><a class="header" href="#リクエストからの処理の流れ">リクエストからの処理の流れ</a></h3>
<p>リクエスト -&gt; Route -&gt; Controller の順で処理が実行される．</p>
<p><img src="laravel/laravel01/./img/laravel_mvc_01.svg" alt="MVCの流れ1" /></p>
<h3 id="db-から取り出したデータの流れ"><a class="header" href="#db-から取り出したデータの流れ">DB から取り出したデータの流れ</a></h3>
<p>Model -&gt; Controller -&gt; View の順で処理が実行される．</p>
<p><img src="laravel/laravel01/./img/laravel_mvc_02.svg" alt="MVCの流れ2" /></p>
<h2 id="コツ"><a class="header" href="#コツ">コツ</a></h2>
<h3 id="習うより慣れろッ"><a class="header" href="#習うより慣れろッ">習うより慣れろッ！</a></h3>
<ul>
<li>初見で理解することは不可能！
<ul>
<li>まずはアプリケーションを作って動かそう！</li>
<li>処理を見ながら，どこでどの処理を行っているのかを考えよう！</li>
</ul>
</li>
<li>MVC 間でのデータの流れを追えるようになると Good！！</li>
<li>慣れゲー &amp; 周回ゲー！
<ul>
<li>何度も作ることで処理のイメージが湧き，余裕が生まれる．</li>
<li>「そういえば前回もこの処理書いたな」で OK．</li>
<li>10 周くらいするとだいぶわかる！</li>
</ul>
</li>
</ul>
<h3 id="余計なことをせずにフレームワークに従う"><a class="header" href="#余計なことをせずにフレームワークに従う">余計なことをせずにフレームワークに従う</a></h3>
<p><strong>フレームワーク &gt; 越えられない壁 &gt;&gt;&gt; 人間</strong></p>
<ul>
<li>フレームワークは人類の叡智！</li>
<li>素人が安易に改造すると台無し．</li>
<li>細かい設定などは弄らない！</li>
<li>自分で実装せずにフレームワークに用意された機能を使え！</li>
<li>ゴリ押しで書くな！（よくある処理はドキュメントに載ってる）</li>
</ul>
<!-- ## Get Started!!!

**【超重要】下記の手順でAWS Educateアカウントにログイン**

1. [https://aws.amazon.com/jp/education/awseducate/](https://aws.amazon.com/jp/education/awseducate/)にアクセス
2. 「AWS Educate にサインイン」をクリック
3. ページ上段 「My Classroom」をクリック
4. 今回のクラスに入る -> AWS console
5. 今後作業途中で再度ログインが必要になっても上記手順でログイン！ -->
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="マイグレーションによるテーブル作成"><a class="header" href="#マイグレーションによるテーブル作成">マイグレーションによるテーブル作成</a></h1>
<p>プロダクトの実装を進める上で，Laravel コンテナ内や DB コンテナ内など「実行場所」を確認すること．</p>
<h2 id="テーブル設計マイグレーションファイル"><a class="header" href="#テーブル設計マイグレーションファイル">テーブル設計（マイグレーションファイル）</a></h2>
<blockquote>
<p><strong>📦 Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>今回のアプリケーションは twitter ライクな SNS なので「tweets」テーブルを作成する．</p>
<p>Laravel では「マイグレーション」という仕組みを使用してテーブルの管理を行う．また，テーブル内のデータは「Model」を使用して操作する．Laravel では<code>Eroquent Model</code>と呼ばれる ORM を使用する．</p>
<blockquote>
<p>【解説 / マイグレーション】</p>
<ul>
<li>マイグレーションとは「マイグレーションファイル」を用いてテーブルを管理する仕組み．</li>
<li>「マイグレーションファイル」にテーブル名やカラム名を記述し，指定されたコマンドを実行することで設定したテーブルが生成される．</li>
</ul>
</blockquote>
<blockquote>
<p>【解説 / Eloquent Model】</p>
<ul>
<li>Eloquent Model は Laravel 標準の ORM（object-relational mapper）である．</li>
<li>ORM とは，DB のレコードをオブジェクトとして直感的に扱えるようにしたもので，SQL を意識せずにプログラムで処理を記述することができる．</li>
<li>Eloquent Model は定義された「Model」を用いることで簡単に DB へのデータ保存・取得などを行える．</li>
<li>1 つのモデルが 1 つのテーブルに対応する．例えば，<code>tweets</code>テーブルに対して<code>Tweet</code>のようにモデルを定義すると自動的に対応する．モデル内に明示的に対応を記述することもできる．</li>
<li>テーブルに対してデータ操作を行う場合，対応するモデルに対して処理を実行することで DB 操作を行うことができる．</li>
</ul>
</blockquote>
<p>Model とマイグレーションファイルは一度に両方とも作成することができる．</p>
<p>下記コマンドは Model を作成するコマンドだが（<code>Tweet</code>がモデル名），<code>-m</code>をつけることでマイグレーションファイルも同時に作成できる．この手法を用いることで，Model 名とマイグレーションファイル内のテーブル名が自動的に対応する．</p>
<p>早速実行．</p>
<pre><code class="language-bash">$ php artisan make:model Tweet -m

# 実行結果（日付時刻は毎回変わる）
Model created successfully.
Created Migration: 2021_09_23_130915_create_tweets_table

</code></pre>
<p><code>database/migration/2021_09_23_130915_create_tweets_table.php</code>を開く．これがマイグレーションファイルである．</p>
<p>カラムを追加するため，下記にように編集する．今回は<code>tweet</code>，<code>description</code>の 2 カラムを追加する．</p>
<p>カラムを追加するときはデータ型も設定する．<code>tweet</code>は文字列（<code>string</code>），<code>description</code>はテキスト（<code>text</code>）を設定している．</p>
<p><code>id</code>ははじめから用意されているので設定不要．</p>
<blockquote>
<p>【tips】</p>
<ul>
<li><code>nullable()</code>を記述することで，入力必須でなくすることができる．他に<code>unique()</code>で重複を禁止することもできる．</li>
<li><code>timestamps()</code>は<code>created_at</code>カラムと<code>updated_at</code>カラムを自動的に設定してくれる．</li>
</ul>
</blockquote>
<pre><code class="language-php">// database/migrations/2021_09_23_130915_create_tweets_table.php

&lt;?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateTweetsTable extends Migration
{
  /**
   * Run the migrations.
   *
   * @return void
   */
  public function up()
  {
    Schema::create('tweets', function (Blueprint $table) {
      $table-&gt;id();
      // ↓ここから追加
      $table-&gt;string('tweet');
      $table-&gt;text('description')-&gt;nullable();
      // ↑ここまで追加
      $table-&gt;timestamps();
    });
  }

  /**
   * Reverse the migrations.
   *
   * @return void
   */
  public function down()
  {
    Schema::dropIfExists('tweets');
  }
}

</code></pre>
<!-- ## 【今回は不要】文字列最大長の変更

これでテーブルの設計は完了だが，MySQL のバージョンによってはエラーが発生するため，次の設定を行う．

`app/Providers/AppServiceProvider.php`の内容を以下のように編集する．`string`型の最大長を 191 に変更する．

> 【解説】
>
> - この設定が必要かどうかは MySQL のバージョンによる．MySQL のバージョンが`5.7.7`以下の場合は必要となる．
> - Laravel のマイグレーションでは文字列の最大長が`255`として実行するが，MySQL5.7.7 以下では最大長が`191`となっているためである．

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
// ↓ 1行追加
use Illuminate\Support\Facades\Schema;

class AppServiceProvider extends ServiceProvider
{
  /**
   * Register any application services.
   *
   * @return void
   */
  public function register()
  {
    //
  }

  /**
   * Bootstrap any application services.
   *
   * @return void
   */
  public function boot()
  {
    // 1行追加
    Schema::defaultStringLength(191);
  }
}
``` -->
<h2 id="マイグレーション実行"><a class="header" href="#マイグレーション実行">マイグレーション実行</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>マイグレーションを実行するとテーブルが作成される．以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migration table created successfully.
Migrating: 2014_10_12_000000_create_users_table
Migrated:  2014_10_12_000000_create_users_table (88.55ms)
Migrating: 2014_10_12_100000_create_password_resets_table
Migrated:  2014_10_12_100000_create_password_resets_table (90.49ms)
Migrating: 2019_08_19_000000_create_failed_jobs_table
Migrated:  2019_08_19_000000_create_failed_jobs_table (89.10ms)
Migrating: 2019_12_14_000001_create_personal_access_tokens_table
Migrated:  2019_12_14_000001_create_personal_access_tokens_table (155.49ms)
Migrating: 2021_09_23_130915_create_tweets_table
Migrated:  2021_09_23_130915_create_tweets_table (57.06ms)

</code></pre>
<p>エラーになる場合はマイグレーションファイルの内容が間違っていることが多い．修正して以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate:fresh
</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>:fresh</code>をつけることで，存在しているテーブルを一旦削除し，再度マイグレーションを実行することができる．</li>
<li>マイグレーションに失敗した場合はエラーが発生するまでに実行された部分はテーブルが作成される．しかし，マイグレーション実行時に，すでに同名のテーブルが存在している場合はエラーになるため，既存テーブルを削除する必要がある．</li>
</ul>
</blockquote>
<h2 id="テーブル確認"><a class="header" href="#テーブル確認">テーブル確認</a></h2>
<p>phpmyadmin でテーブルの状況を確認する．<code>tweets</code>が以下の内容で作成されていれば OK．</p>
<pre><code class="language-txt">+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】コマンドで確認する場合は以下の手順で行う．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

うまくいったら，mysql にログインしてテーブルを確認する．パスワードは`password`．

```bash
$ mysql -u sail -p

mysql> use laratter;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweets                 |
| users                  |
+------------------------+
6 rows in set (0.00 sec)

mysql> desc tweets;
+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

mysql> exit
Bye

``` -->
<h2 id="テストユーザーデータの作成"><a class="header" href="#テストユーザーデータの作成">テストユーザーデータの作成</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>この段階で，ユーザテーブルなどの認証に使用するテーブルも用意された状態となる．</p>
<p>Laravel には「seeder」という機能があり，テスト用のデータを簡単に作成することができる．</p>
<p>今回はダミーデータを 10 件作成する．<code>database/seeders/DatabaseSeeder.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// database/seeders/DatabaseSeeder.php

&lt;?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
  /**
   * Seed the application's database.
   *
   * @return void
   */
  public function run()
  {
    // ↓この行のコメントから外す
    \App\Models\User::factory(10)-&gt;create();
  }
}

</code></pre>
<p>下記コマンドを実行してテストユーザを作成する．</p>
<pre><code class="language-bash">$ php artisan db:seed

# 実行結果
Database seeding completed successfully.

</code></pre>
<p>コマンドを実行したら phpmyadmin でユーザーデータを確認する．パスワードはハッシュ化されているが全員<code>password</code>となっている．</p>
<p>ブラウザの画面からメールアドレスとパスワードでログインできることを確認しよう．</p>
<p>ログインすると，下記の画面が表示される．</p>
<p><img src="laravel/laravel01/./img/register-success.png" alt="ユーザ登録完了" /></p>
<blockquote>
<p>【tips】</p>
<p><code>Email</code>は<code>example.com</code>を使用する．これはテスト用に用意されているドメインであり，誰かのメールアドレスを使用してしまうリスクを回避できる．</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ルーティングとコントローラ"><a class="header" href="#ルーティングとコントローラ">ルーティングとコントローラ</a></h1>
<p>Laravel では，クライアントからリクエストされた URL に対して，どの関数を実行するかを決める．この対応を決定するのが「ルーティング」であり，実際に実行される関数を記述するのが「コントローラ」である．</p>
<h2 id="ルーティングとコントローラの作成"><a class="header" href="#ルーティングとコントローラの作成">ルーティングとコントローラの作成</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>コントローラとルーティングを作成する．今回のコントローラ名は<code>TweetController</code>とする．</p>
<p><code>--resource</code>をつけることで，よく使用する処理（代表的な CRUD 処理）を一括して作成することができる．</p>
<p>下記コマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:controller TweetController --resource

# 実行結果
Controller created successfully.

</code></pre>
<p>これでコントローラファイルが作成された．続いてルーティングを作成する．</p>
<p><strong>ルーティングファイルは<code>routes</code>以下に配置される．</strong></p>
<p><code>routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
// ↓追加
use App\Http\Controllers\TweetController;

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| contains the &quot;web&quot; middleware group. Now create something great!
|
*/

// ↓追加
Route::resource('tweet', TweetController::class);

Route::get('/', function () {
    return view('welcome');
});

Route::get('/dashboard', function () {
    return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__.'/auth.php';

</code></pre>
<p>ルーティングの一覧は下記で確認できる．</p>
<pre><code class="language-bash">$ php artisan route:list

# 実行結果（ユーザ操作などのルーティングは省略）
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+

</code></pre>
<blockquote>
<p>【解説】</p>
<p><strong>この表は非常に重要．</strong></p>
<ul>
<li>例えば，<code>/tweet/</code>に<code>GET</code>でリクエストが来た場合，<code>TweetController</code>の<code>index</code>関数が動作することを示している．</li>
<li>このように，URL と動作する関数の対応を決めているのがルーティングである．</li>
</ul>
</blockquote>
<p>これで，ルーティング部分は完了である．</p>
<h2 id="コントローラの実装一部"><a class="header" href="#コントローラの実装一部">コントローラの実装（一部）</a></h2>
<p>URL にリクエストが来た場合に実行される関数はコントローラに記述される．まずはリクエストが来た場合に特定の画面を表示するよう処理を記述する．</p>
<p><strong>コントローラは<code>app/Http/Controllers</code>以下に配置される．</strong></p>
<p><code>app/Http/Controllers/TweetController.php</code>の内容を以下のように編集する．</p>
<p><code>view()</code>関数は指定したビューファイル（画面）を表示する．<code>tweet.index</code>は<code>tweet</code>フォルダの<code>index.blade.php</code>の意味．ビューファイルは次項で作成する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
// ↓2行追加
use Validator;
use App\Models\Tweet;

class TweetController extends Controller
{
  /**
   * Display a listing of the resource.
   *
   * @return \Illuminate\Http\Response
   */
  public function index()
  {
    // ↓追加
    return view('tweet.index');
  }

  /**
   * Show the form for creating a new resource.
   *
   * @return \Illuminate\Http\Response
   */
  public function create()
  {
    // ↓追加
    return view('tweet.create');
  }

  // 以降は変更なし

}

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="必要な画面の作成と動作確認"><a class="header" href="#必要な画面の作成と動作確認">必要な画面の作成と動作確認</a></h1>
<h2 id="共通画面の作成"><a class="header" href="#共通画面の作成">共通画面の作成</a></h2>
<p>実際にブラウザ画面に表示される内容を記述する．ビューファイルは<code>*.blade.php</code>の形式で作成する．これは「blade テンプレート」と呼ばれる形式であり，コントローラとのデータのやり取りなどに最適化されている．</p>
<p><strong>ビューファイルは<code>latavel_tweet/resources/views</code>ディレクトリ以下に配置する．</strong></p>
<p>blade テンプレートでは共通パーツと個別パーツを組み合わせて画面を構成する．例えば，アプリケーション全体を通して表示されるナビゲーションバーやエラー画面などは共通パーツである．</p>
<p>それぞれのパーツは「コンポーネント」と呼ばれる．</p>
<h2 id="共通パーツエラー表示の作成"><a class="header" href="#共通パーツエラー表示の作成">共通パーツ（エラー表示）の作成</a></h2>
<p>入力値が不正な場合などはエラー画面を表示して対応する．</p>
<p>tweet の入力や編集など複数の画面で必要となるため，共通のコンポーネントとして作成する．</p>
<p><code>latavel_tweet/resources/views</code>の中に<code>common</code>フォルダを作成する．
<code>common</code>フォルダの中に<code>errors.blade.php</code>ファイルを作成する．</p>
<p><code>errors.blade.php</code>に以下の内容を記述する．</p>
<pre><code class="language-php">@if (count($errors) &gt; 0)
&lt;div&gt;
  &lt;div class=&quot;font-medium text-red-600&quot;&gt;
    {{ __('Whoops! Something went wrong.') }}
  &lt;/div&gt;

  &lt;ul class=&quot;mt-3 list-disc list-inside text-sm text-red-600&quot;&gt;
    @foreach ($errors-&gt;all() as $error)
    &lt;li&gt;{{ $error }}&lt;/li&gt;
    @endforeach
  &lt;/ul&gt;
&lt;/div&gt;
@endif

</code></pre>
<h2 id="共通パーツナビゲーションバーの調整"><a class="header" href="#共通パーツナビゲーションバーの調整">共通パーツ（ナビゲーションバー）の調整</a></h2>
<p>ナビゲーションバーもアプリケーションを通じて使用するため，共通パーツとして作成する．</p>
<p>「tweet 一覧」と「tweet 作成」の 2 種類のリンクを作成しておく．</p>
<p><code>resources/views/layouts/navigation.blade.php</code>の内容を以下のように編集する．</p>
<p>全部で 4 箇所追記があるので注意．長いので全コピペ推奨．</p>
<pre><code class="language-php">&lt;nav x-data=&quot;{ open: false }&quot; class=&quot;bg-white border-b border-gray-100&quot;&gt;
  &lt;!-- Primary Navigation Menu --&gt;
  &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
    &lt;div class=&quot;flex justify-between h-16&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;!-- Logo --&gt;
        &lt;div class=&quot;flex-shrink-0 flex items-center&quot;&gt;
          &lt;a href=&quot;{{ route('dashboard') }}&quot;&gt;
            &lt;x-application-logo class=&quot;block h-10 w-auto fill-current text-gray-600&quot; /&gt;
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Navigation Links --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
            {{ __('Dashboard') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- ↓一覧ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
            {{ __('Index') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- ↓作成ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
            {{ __('Create') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Settings Dropdown --&gt;
      &lt;div class=&quot;hidden sm:flex sm:items-center sm:ml-6&quot;&gt;
        &lt;x-dropdown align=&quot;right&quot; width=&quot;48&quot;&gt;
          &lt;x-slot name=&quot;trigger&quot;&gt;
            &lt;button class=&quot;flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out&quot;&gt;
              &lt;div&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;

              &lt;div class=&quot;ml-1&quot;&gt;
                &lt;svg class=&quot;fill-current h-4 w-4&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                  &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
            &lt;/button&gt;
          &lt;/x-slot&gt;

          &lt;x-slot name=&quot;content&quot;&gt;
            &lt;!-- Authentication --&gt;
            &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
              @csrf

              &lt;x-dropdown-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                                this.closest('form').submit();&quot;&gt;
                {{ __('Logout') }}
              &lt;/x-dropdown-link&gt;
            &lt;/form&gt;
          &lt;/x-slot&gt;
        &lt;/x-dropdown&gt;
      &lt;/div&gt;

      &lt;!-- Hamburger --&gt;
      &lt;div class=&quot;-mr-2 flex items-center sm:hidden&quot;&gt;
        &lt;button @click=&quot;open = ! open&quot; class=&quot;inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out&quot;&gt;
          &lt;svg class=&quot;h-6 w-6&quot; stroke=&quot;currentColor&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;
            &lt;path :class=&quot;{'hidden': open, 'inline-flex': ! open }&quot; class=&quot;inline-flex&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M4 6h16M4 12h16M4 18h16&quot; /&gt;
            &lt;path :class=&quot;{'hidden': ! open, 'inline-flex': open }&quot; class=&quot;hidden&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M6 18L18 6M6 6l12 12&quot; /&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Responsive Navigation Menu --&gt;
  &lt;div :class=&quot;{'block': open, 'hidden': ! open}&quot; class=&quot;hidden sm:hidden&quot;&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
        {{ __('Dashboard') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- ↓一覧ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
        {{ __('Index') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- ↓作成ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
        {{ __('Create') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;

    &lt;!-- Responsive Settings Options --&gt;
    &lt;div class=&quot;pt-4 pb-1 border-t border-gray-200&quot;&gt;
      &lt;div class=&quot;flex items-center px-4&quot;&gt;
        &lt;div class=&quot;flex-shrink-0&quot;&gt;
          &lt;svg class=&quot;h-10 w-10 fill-current text-gray-400&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;
            &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot; /&gt;
          &lt;/svg&gt;
        &lt;/div&gt;

        &lt;div class=&quot;ml-3&quot;&gt;
          &lt;div class=&quot;font-medium text-base text-gray-800&quot;&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;
          &lt;div class=&quot;font-medium text-sm text-gray-500&quot;&gt;{{ Auth::user()-&gt;email }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;mt-3 space-y-1&quot;&gt;
        &lt;!-- Authentication --&gt;
        &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
          @csrf

          &lt;x-responsive-nav-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                        this.closest('form').submit();&quot;&gt;
            {{ __('Logout') }}
          &lt;/x-responsive-nav-link&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li>Laravel8 のビューは CSS フレームワークの<code>tailwind.css</code>を使用している．</li>
<li>予め用意されたクラス名を記述するだけでスタイルを適用できるので，ドキュメントを読みながらスタイルを変更してみよう．</li>
</ul>
</blockquote>
<p>画面をリロードすると下記のようにナビゲーションが設置された状態となる（一覧ページと作成ページはまだ作成していないので動作しない点に注意）．</p>
<p><img src="laravel/laravel01/./img/laratter_logged_in.png" alt="ナビゲーション設置" /></p>
<h2 id="tweet-作成画面の作成"><a class="header" href="#tweet-作成画面の作成">tweet 作成画面の作成</a></h2>
<p>まず，<code>resources/views</code>の中に<code>tweet</code>フォルダを作成する．</p>
<p>続いて，<code>tweet</code>フォルダの中に以下のファイルを作成する．今後必要になる画面のファイルも合わせて作成している．</p>
<ul>
<li><code>index.blade.php</code>（tweet 一覧画面）</li>
<li><code>create.blade.php</code>（tweet 作成画面）</li>
<li><code>show.blade.php</code>（tweet 詳細画面）</li>
<li><code>edit.blade.php</code>（tweet 編集画面）</li>
</ul>
<p>ファイルを作成したら<code>create.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/create.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Create New Tweet') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          @include('common.errors')
          &lt;form class=&quot;mb-6&quot; action=&quot;{{ route('tweet.store') }}&quot; method=&quot;POST&quot;&gt;
            @csrf
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;tweet&quot;&gt;Tweet&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;tweet&quot; id=&quot;tweet&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;description&quot;&gt;Description&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;description&quot; id=&quot;description&quot;&gt;
            &lt;/div&gt;
            &lt;button type=&quot;submit&quot; class=&quot;w-full py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
              Create
            &lt;/button&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>route('tweet.store')</code>は<code>TweetController</code>の<code>store()</code>関数にデータを送ることを示している．</li>
<li><code>@csrf</code>はセキュリティ対策．フォームからデータを送信するときには必ず記述すること．</li>
</ul>
</blockquote>
<h2 id="動作確認作成画面"><a class="header" href="#動作確認作成画面">動作確認（作成画面）</a></h2>
<p>編集したらブラウザから<code>localhost/tweet/create</code>にアクセスして動作確認．
下記画面になっていれば OK．</p>
<p><img src="laravel/laravel01/./img/laratter_create.png" alt="tweet作成画面" /></p>
<h2 id="tweet-一覧画面の作成"><a class="header" href="#tweet-一覧画面の作成">tweet 一覧画面の作成</a></h2>
<p>続いて，<code>index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<p>こちらはエラーが発生する．</p>
<p><img src="laravel/laravel01/./img/laratter_index_error.png" alt="一覧画面のエラー" /></p>
<p>コントローラから<code>$tweets</code>という名前でデータを受け取るよう記述しているが，コントローラからデータが送られていないためである．</p>
<p>とりあえず空のデータを送るように<code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>view()</code>関数の第 2 引数に渡したいデータを配列で記述する．</li>
<li>ここでは「<code>tweets</code>」という名前で「空の配列」を送っている．</li>
<li>ビューファイル側では<code>$tweets</code>とすることで渡されたデータを使うことができる．</li>
<li>また，変数などのデータは<code>var_dump()</code>または<code>dd()</code>または<code>ddd()</code>で確認することができる．これらを使ってデータの構造を確認しながら進めると良いだろう．</li>
</ul>
</blockquote>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function index()
{
  // ↓編集
  return view('tweet.index', [
    'tweets' =&gt; []
  ]);
}

</code></pre>
<h2 id="動作確認-2"><a class="header" href="#動作確認-2">動作確認</a></h2>
<p>編集したらブラウザから<code>localhost/tweet</code>にアクセスして動作確認．
下記画面になっていれば OK．</p>
<p><img src="laravel/laravel01/./img/laratter_index_empty.png" alt="一覧画面" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-作成処理の実装"><a class="header" href="#tweet-作成処理の実装">tweet 作成処理の実装</a></h1>
<p>必要な画面を揃えたので，作成ページから実際に DB にデータを保存できるようにする．</p>
<h2 id="model-の編集"><a class="header" href="#model-の編集">Model の編集</a></h2>
<p>Model の役割は「DB とのデータをやり取り」である．Model には DB からどのようにデータを取得するか，などの処理を記述する．</p>
<p>ただし，Model には予め使用頻度の高い処理（基本的な CRUD）が用意されているため，今回記述するコードはそれほど多くない．</p>
<p>まず，テーブル対して，Laravel 側からデータの作成や編集が行えないカラムを設定する．</p>
<p>これはクライアントから送信されてくるデータが ID やユーザ権限などの情報を書き換えてしまうリスクを低減させるためである．</p>
<p><code>app/Models/Tweet.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  // アプリケーション側でcreateなどできない値を記述する
  // ↓以下の処理を記述

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];
}


</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>$guarded</code>はアプリケーション側から変更できないカラムを指定する（ブラックリスト）．</li>
<li>対して，<code>$fillable</code>はアプリケーション側から変更できるカラムを指定する（ホワイトリスト）．</li>
<li>どちらを使用しても良いが，どちらかを使用する必要がある．</li>
</ul>
</blockquote>
<h2 id="controller-の編集"><a class="header" href="#controller-の編集">Controller の編集</a></h2>
<p>続いて，コントローラに「Model に対しての命令」を記述する．DB とやり取りする関数はすでに定義されているのでモデル側に新たな記述は必要ない．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>store()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function store(Request $request)
{
  // バリデーション
  $validator = Validator::make($request-&gt;all(), [
    'tweet' =&gt; 'required | max:191',
    'description' =&gt; 'required',
  ]);
  // バリデーション:エラー
  if ($validator-&gt;fails()) {
    return redirect()
      -&gt;route('tweet.create')
      -&gt;withInput()
      -&gt;withErrors($validator);
  }
  // create()は最初から用意されている関数
  // 戻り値は挿入されたレコードの情報
  $result = Tweet::create($request-&gt;all());
  // ルーティング「todo.index」にリクエスト送信（一覧ページに移動）
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>create.blade.php</code>から送信されていたデータは<code>$request</code>に入っている．<code>$request-&gt;all()</code>とすることで全部取得することができる．</li>
<li><code>redirect()-&gt;route('tweet.index')</code>は指定したコントローラの関数を動かす．今回は<code>TweetController</code>の<code>index()</code>関数．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-一覧画面の実装"><a class="header" href="#tweet-一覧画面の実装">tweet 一覧画面の実装</a></h1>
<p>一覧画面では締切が早い順にソートしてデータを表示する．</p>
<h3 id="model-の処理"><a class="header" href="#model-の処理">Model の処理</a></h3>
<p>まず，上記の条件でデータを取得する関数を Model に作成する．</p>
<p><code>app/Models/Tweet.php</code>に以下の関数を作成する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

class Tweet extends Model
{
  use HasFactory;

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];

  // ↓追加
  public static function getAllOrderByUpdated_at()
  {
    return self::orderBy('updated_at', 'desc')-&gt;get();
  }
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>self</code>は Tweet モデルのこと．</li>
<li><code>orderBy()</code>は SQL のものと同じ理解で OK．</li>
<li>最後の<code>get()</code>がないと実行されないので注意．</li>
</ul>
</blockquote>
<h2 id="controller-を編集"><a class="header" href="#controller-を編集">Controller を編集</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function index()
{
  // ↓編集
  $tweets = Tweet::getAllOrderByUpdated_at();
  return view('tweet.index', [
    'tweets' =&gt; $tweets
  ]);
}

</code></pre>
<h2 id="動作確認-3"><a class="header" href="#動作確認-3">動作確認</a></h2>
<p>tweet 作成画面でデータを入力して送信すると．．．</p>
<p><img src="laravel/laravel01/./img/laratter_create_adding.png" alt="データ作成" /></p>
<p>自動的に一覧画面に切り替わる．</p>
<p><img src="laravel/laravel01/./img/laratter_index_added_one.png" alt="データ1件追加" /></p>
<p>自分が入力したデータが表示されていれば OK．何件かデータを入れておこう．</p>
<p><img src="laravel/laravel01/./img/laratter_index_added_some.png" alt="データ複数件追加" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day07"><a class="header" href="#day07">Day07</a></h1>
<h2 id="本日の内容-1"><a class="header" href="#本日の内容-1">本日の内容</a></h2>
<ul>
<li>SNS アプリケーションの実装（詳細表示，更新処理，削除処理）</li>
<li>ユーザ情報の利用</li>
</ul>
<h2 id="本日の目標-1"><a class="header" href="#本日の目標-1">本日の目標</a></h2>
<ul>
<li>CRUD 処理の流れをマスターする．</li>
<li>ユーザ情報の取得や取得したデータの使い方を学ぶ．</li>
<li>データを連携させる処理を実装する．</li>
</ul>
<h2 id="ルーティング表-1"><a class="header" href="#ルーティング表-1">ルーティング表</a></h2>
<p>都度確認しよう！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドまとめ-2"><a class="header" href="#多用するコマンドまとめ-2">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる-2"><a class="header" href="#仮想コンテナを立ち上げる-2">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる-2"><a class="header" href="#仮想コンテナを終了させる-2">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする-2"><a class="header" href="#laravel-コンテナへログインする-2">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする-2"><a class="header" href="#mysql-コンテナへログインする-2">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする-2"><a class="header" href="#コンテナからログアウトする-2">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-詳細画面の実装"><a class="header" href="#tweet-詳細画面の実装">tweet 詳細画面の実装</a></h1>
<p>詳細画面は tweet の 1 件を個別に表示する．</p>
<h2 id="一覧画面に詳細画面へのリンクを作成"><a class="header" href="#一覧画面に詳細画面へのリンクを作成">一覧画面に詳細画面へのリンクを作成</a></h2>
<p>各 tweet の詳細を取得する処理と表示する画面を作成する．</p>
<p>一覧画面の tweet 名をクリックすると詳細画面に移動するようにする．</p>
<p>クリックするとコントローラの<code>show()</code>関数にリクエストを送るように記述している．</p>
<p><code>resources/views/tweet/index.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="指定した-1-件のデータを取得する処理を追加"><a class="header" href="#指定した-1-件のデータを取得する処理を追加">指定した 1 件のデータを取得する処理を追加</a></h2>
<p><code>show()</code>関数では，ID を指定して 1 件のデータを取得したい．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>show()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function show($id)
{
  $tweet = Tweet::find($id);
  return view('tweet.show', ['tweet' =&gt; $tweet]);
}

</code></pre>
<p>ここでは，受け取った ID の値でテーブルからデータを取り出し，<code>tweet</code>という名前で<code>show.blade.php</code>に渡している．</p>
<h2 id="詳細表示画面の作成"><a class="header" href="#詳細表示画面の作成">詳細表示画面の作成</a></h2>
<p>詳細画面の<code>resources/views/tweet/show.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Show Tweet Detail') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;div class=&quot;mb-6&quot;&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;p class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot;&gt;Tweet&lt;/p&gt;
              &lt;p class=&quot;py-2 px-3 text-grey-darkest&quot; id=&quot;tweet&quot;&gt;
                {{$tweet-&gt;tweet}}
              &lt;/p&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;p class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot;&gt;Description&lt;/p&gt;
              &lt;p class=&quot;py-2 px-3 text-grey-darkest&quot; id=&quot;description&quot;&gt;
                {{$tweet-&gt;description}}
              &lt;/p&gt;
            &lt;/div&gt;
            &lt;a href=&quot;{{ route('tweet.index') }}&quot; class=&quot;block text-center w-full py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
              Back
            &lt;/a&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-4"><a class="header" href="#動作確認-4">動作確認</a></h2>
<p>一覧画面で各 tweet をクリックし，下記のように詳細画面が表示されれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_show.png" alt="詳細画面" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-削除処理の実装"><a class="header" href="#tweet-削除処理の実装">tweet 削除処理の実装</a></h1>
<p>一覧画面に削除ボタンを設置し，クリックしたら該当するデータを削除できるようにする．</p>
<h2 id="一覧画面に削除ボタンを追加"><a class="header" href="#一覧画面に削除ボタンを追加">一覧画面に削除ボタンを追加</a></h2>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li>削除ボタンクリック時には，コントローラの<code>destroy()</code>関数にリクエストが送られる．</li>
<li>削除の処理を行うには<code>DELETE</code>メソッドでリクエストを送る必要があるが，form からは GET または POST でしか送れない．</li>
<li><code>@method('delete')</code>を記述することで，<code>DELETE</code>メソッドで送信できる．</li>
</ul>
</blockquote>
<h2 id="動作確認削除ボタンの設置"><a class="header" href="#動作確認削除ボタンの設置">動作確認（削除ボタンの設置）</a></h2>
<p>一覧画面を確認し，削除ボタンが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_added_delete_button.png" alt="削除ボタン追加" /></p>
<h2 id="指定したデータを削除する処理の作成"><a class="header" href="#指定したデータを削除する処理の作成">指定したデータを削除する処理の作成</a></h2>
<p>まず ID で指定したデータを 1 件抽出し，そのデータを削除する，という流れ．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>destroy()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controller/TweetController.php

public function destroy($id)
{
  $result = Tweet::find($id)-&gt;delete();
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<h2 id="動作確認削除処理"><a class="header" href="#動作確認削除処理">動作確認（削除処理）</a></h2>
<p>動作させて確認する．削除ボタンをクリックし，該当するデータが削除されれば OK．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-更新処理の実装"><a class="header" href="#tweet-更新処理の実装">tweet 更新処理の実装</a></h1>
<p>更新処理は</p>
<ol>
<li>一覧画面に編集ボタンを設置．</li>
<li>編集ボタンをクリックしたら編集画面に移動.</li>
<li>編集画面でデータを書き換え，送信ボタンクリックで DB のデータを更新する．</li>
</ol>
<h2 id="一覧画面に編集ボタンを追加"><a class="header" href="#一覧画面に編集ボタンを追加">一覧画面に編集ボタンを追加</a></h2>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集ボタンの設置"><a class="header" href="#動作確認編集ボタンの設置">動作確認（編集ボタンの設置）</a></h2>
<p>一覧画面に編集ボタンが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_added_edit_button.png" alt="編集ボタン追加" /></p>
<h2 id="編集画面に移動する処理の作成"><a class="header" href="#編集画面に移動する処理の作成">編集画面に移動する処理の作成</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>edit()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controller/TweetController.php

public function edit($id)
{
  $tweet = Tweet::find($id);
  return view('tweet.edit', ['tweet' =&gt; $tweet]);
}

</code></pre>
<p>やっていることは<code>create()</code>関数と同様．</p>
<h2 id="編集画面の作成-1"><a class="header" href="#編集画面の作成-1">編集画面の作成</a></h2>
<p><code>resources/views/tweet/edit.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/edit.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Edit Tweet') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          @include('common.errors')
          &lt;form class=&quot;mb-6&quot; action=&quot;{{ route('tweet.update',$tweet-&gt;id) }}&quot; method=&quot;POST&quot;&gt;
            @method('put')
            @csrf
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;tweet&quot;&gt;tweet&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;tweet&quot; id=&quot;tweet&quot; value=&quot;{{$tweet-&gt;tweet}}&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;description&quot;&gt;Description&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;description&quot; id=&quot;description&quot; value=&quot;{{$tweet-&gt;description}}&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex justify-evenly&quot;&gt;
              &lt;a href=&quot;{{ route('tweet.index') }}&quot; class=&quot;block text-center w-5/12 py-3 mt-6 font-medium tracking-widest text-black uppercase bg-gray-100 shadow-sm focus:outline-none hover:bg-gray-200 hover:shadow-none&quot;&gt;
                Back
              &lt;/a&gt;
              &lt;button type=&quot;submit&quot; class=&quot;w-5/12 py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
                Update
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集画面"><a class="header" href="#動作確認編集画面">動作確認（編集画面）</a></h2>
<p>一覧画面の編集ボタンをクリックし，現在のデータが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_edit.png" alt="編集画面" /></p>
<h2 id="指定したデータを更新する処理の作成"><a class="header" href="#指定したデータを更新する処理の作成">指定したデータを更新する処理の作成</a></h2>
<p>編集画面でデータを書き換え，コントローラの<code>update()</code>関数にデータを送信し，DB のデータを更新する．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>update()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function update(Request $request, $id)
{
  //バリデーション
  $validator = Validator::make($request-&gt;all(), [
    'tweet' =&gt; 'required | max:191',
    'description' =&gt; 'required',
  ]);
  //バリデーション:エラー
  if ($validator-&gt;fails()) {
    return redirect()
      -&gt;route('tweet.edit', $id)
      -&gt;withInput()
      -&gt;withErrors($validator);
  }
  //データ更新処理
  // updateは更新する情報がなくても更新が走る（updated_atが更新される）
  $result = Tweet::find($id)-&gt;update($request-&gt;all());
  // fill()save()は更新する情報がない場合は更新が走らない（updated_atが更新されない）
  // $redult = Tweet::find($id)-&gt;fill($request-&gt;all())-&gt;save();
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<h2 id="動作確認更新処理"><a class="header" href="#動作確認更新処理">動作確認（更新処理）</a></h2>
<p>一覧画面のデータが，編集画面で書き換えたデータに更新されれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_updated.png" alt="データ更新結果" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day08"><a class="header" href="#day08">Day08</a></h1>
<h2 id="本日の内容-2"><a class="header" href="#本日の内容-2">本日の内容</a></h2>
<ul>
<li>マイページの実装（1 対多のデータ）．</li>
<li>ユーザ名の表示（多対 1 のデータ）．</li>
<li>favorite 機能の実装（多対多）．</li>
</ul>
<h2 id="本日の目標-2"><a class="header" href="#本日の目標-2">本日の目標</a></h2>
<ul>
<li>SNS アプリケーションを完成させる．</li>
<li>様々な形のデータを扱う方法を学ぶ．</li>
<li>Laravel でアプリケーションを開発するイメージを持つ．</li>
</ul>
<h2 id="ルーティング表-2"><a class="header" href="#ルーティング表-2">ルーティング表</a></h2>
<p>都度確認しよう！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドまとめ-3"><a class="header" href="#多用するコマンドまとめ-3">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる-3"><a class="header" href="#仮想コンテナを立ち上げる-3">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる-3"><a class="header" href="#仮想コンテナを終了させる-3">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする-3"><a class="header" href="#laravel-コンテナへログインする-3">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする-3"><a class="header" href="#mysql-コンテナへログインする-3">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする-3"><a class="header" href="#コンテナからログアウトする-3">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-とユーザ認証の連携"><a class="header" href="#tweet-とユーザ認証の連携">tweet とユーザ認証の連携</a></h1>
<p>はじめのほうで，ユーザ認証を行う breeze ライブラリをインストールしたため，これを利用してユーザ管理を行う．</p>
<p>まず，認証ユーザのみがアプリケーションの機能を利用できるように処理を変更する．現状ではログインしていない状態でも一覧画面などにアクセスできてしまう（実際はユーザ情報が不足しているためエラー画面となる）．</p>
<h2 id="ログインしていないユーザはアプリケーションにアクセスできないようにする"><a class="header" href="#ログインしていないユーザはアプリケーションにアクセスできないようにする">ログインしていないユーザはアプリケーションにアクセスできないようにする．</a></h2>
<p><code>app/routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// app/routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// コメントは省略

// ↓ ここを編集
Route::group(['middleware' =&gt; 'auth'], function () {
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="動作確認ログイン必須"><a class="header" href="#動作確認ログイン必須">動作確認（ログイン必須）</a></h2>
<p>一旦ログアウトした状態で，URL 直打ち（<code>localhost/tweet</code>）して tweet 画面にアクセスできずにログイン画面に戻されれば OK！</p>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>['middleware' =&gt; 'auth']</code> を記述することで認証状態をチェックしてくれる．</li>
<li><code>{}</code> 内に記述したルーティングは認証必須となり，未認証（未ログイン）の場合はログイン画面に戻される．</li>
</ul>
</blockquote>
<h2 id="tweet-テーブルにユーザ-id-カラムを追加する"><a class="header" href="#tweet-テーブルにユーザ-id-カラムを追加する">tweet テーブルにユーザ ID カラムを追加する</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<h3 id="マイグレーションファイルの作成"><a class="header" href="#マイグレーションファイルの作成">マイグレーションファイルの作成</a></h3>
<p>カラムの変更はマイグレーションで行う．</p>
<blockquote>
<ul>
<li>本来はカラムはテーブル作成時点で決定しておくことが望ましい．</li>
<li>マイグレーションは実行した内容を取り消せる（ロールバック）ため，不具合が生じても対応できる場合が多い．</li>
</ul>
</blockquote>
<p>カラムを追加するため，下記コマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:migration add_user_id_to_tweets_table --table=tweets

# 実行結果
Created Migration: 2021_09_24_061716_add_user_id_to_tweets_table

</code></pre>
<h3 id="マイグレーションファイルの編集"><a class="header" href="#マイグレーションファイルの編集">マイグレーションファイルの編集</a></h3>
<p><code>database/migration/2021_09_24_061716_add_user_id_to_tweets_table.php</code>を開く．
下記にように編集する．</p>
<blockquote>
<p>他のテーブルと relation させるためには，カラム名を「<code>モデル名小文字_id</code>」とする必要がある．</p>
</blockquote>
<pre><code class="language-php">// database/migrations/2021_09_24_061716_add_user_id_to_tweets_table.php

public function up()
{
  Schema::table('tweets', function (Blueprint $table) {
    // ↓ 1行追加
    $table-&gt;integer('user_id')-&gt;after('id');
  });
}

</code></pre>
<h3 id="マイグレーション実行-1"><a class="header" href="#マイグレーション実行-1">マイグレーション実行</a></h3>
<p>以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migrating: 2021_09_24_061716_add_user_id_to_tweets_table
Migrated:  2021_09_24_061716_add_user_id_to_tweets_table (102.98ms)

</code></pre>
<h2 id="テーブルの確認"><a class="header" href="#テーブルの確認">テーブルの確認</a></h2>
<p>phpmyadmin でテーブルの構造を確認する．<code>user_id</code> カラムが追加されていれば OK．</p>
<pre><code class="language-txt">+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id     | int             | NO   |     | NULL    |                |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】コマンドで確認する場合は以下の手順で行う．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

mysql にログインしてテーブルを確認する．パスワードは`password`．

```bash
$ mysql -u sail -p

mysql> use laratter
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweets                 |
| users                  |
+------------------------+
6 rows in set (0.01 sec)

mysql> desc tweets;
+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id     | int             | NO   |     | NULL    |                |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql>

``` -->
<h2 id="データ追加時に-user_id-を追加"><a class="header" href="#データ追加時に-user_id-を追加">データ追加時に user_id を追加</a></h2>
<p>tweet のデータを作成する際に，「誰が作成したのか」がわかるように，データにログインユーザの ID を追加する．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>store()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use Validator;
use App\Models\Tweet;

// ↓ 追加
use Auth;

class TweetController extends Controller
{

  // 省略

  public function store(Request $request)
  {
    // バリデーション
    $validator = Validator::make($request-&gt;all(), [
      'tweet' =&gt; 'required | max:191',
      'description' =&gt; 'required',
    ]);
    // バリデーション:エラー
    if ($validator-&gt;fails()) {
      return redirect()
        -&gt;route('tweet.create')
        -&gt;withInput()
        -&gt;withErrors($validator);
    }

    // ↓編集 フォームから送信されてきたデータとユーザIDをマージし，DBにinsertする
    $data = $request-&gt;merge(['user_id' =&gt; Auth::user()-&gt;id])-&gt;all();
    $result = Tweet::create($data);

    // tweet.index」にリクエスト送信（一覧ページに移動）
    return redirect()-&gt;route('tweet.index');
  }

  // 省略
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>$request-&gt;merge()</code>でユーザ ID を追加している．</li>
<li><code>Auth::user()-&gt;id</code>で現在ログインしているユーザの ID を取得することができる（<code>Auth::id()</code>でも可）．</li>
<li><code>Auth::user()</code>には他にもデータが入っているので，<code>dd()</code>などで確認してみると良いだろう．</li>
</ul>
</blockquote>
<h2 id="動作確認-5"><a class="header" href="#動作確認-5">動作確認</a></h2>
<p>適当なデータを追加し，phpmyadmin で確認する．</p>
<p>tweets テーブルのデータにユーザ ID が一緒に入っていれば OK．既存データの user_id カラムに 0 が入っているので，ログインユーザの ID に変更しておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="マイページ機能の実装1-対多のデータ"><a class="header" href="#マイページ機能の実装1-対多のデータ">マイページ機能の実装（1 対多のデータ）</a></h1>
<p>現在，一覧ページにはユーザ関係なく全てのデータが表示された状態となっている．ユーザが自分の投稿を確認して編集できるように，マイページ機能を実装する．</p>
<h2 id="1-対多のデータ連携"><a class="header" href="#1-対多のデータ連携">1 対多のデータ連携</a></h2>
<p>今回の場合，ユーザと tweet が「1 対多」の関係となっている．</p>
<p>Laravel では，このような場合に親となるデータから子のデータを取得する方法が準備されている．</p>
<p><code>app/Models/User.php</code>に以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Models/User.php

class User extends Authenticatable
{
  use HasApiTokens, HasFactory, Notifiable;

  // 省略

  // ↓追加
  public function mytweets()
  {
    return $this-&gt;hasMany(Tweet::class)-&gt;orderBy('updated_at', 'desc');
  }
}

</code></pre>
<p>ここで，User と Tweet を連携させるためには，子（Tweet）のカラムに「<code>親_id</code>」（&lt;- 今回は<code>user_id</code>）を用意しておく必要がある（前項で実施）．</p>
<p>これで<code>User</code>モデルを用いて，特定のユーザが投稿した tweet を取得できるようになる．</p>
<h2 id="マイページのルーティング"><a class="header" href="#マイページのルーティング">マイページのルーティング</a></h2>
<p>マイページを表示するためのルーティングを追加する．</p>
<p><code>routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// コメント省略

Route::group(['middleware' =&gt; 'auth'], function () {
  // ↓追加
  Route::get('/tweet/mypage', [TweetController::class, 'mydata'])-&gt;name('tweet.mypage');
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="特定ユーザのデータのみ取得する処理"><a class="header" href="#特定ユーザのデータのみ取得する処理">特定ユーザのデータのみ取得する処理</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<p><code>class TweetController extends Controller{ ... }</code>内の最後に<code>mydata()</code>関数を追加すれば OK．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Validator;
use App\Models\Tweet;
use Auth;

// ↓ 追加
use App\Models\User;

class TweetController extends Controller
{

  // 省略

  public function mydata()
  {
    // Userモデルに定義した関数を実行する．
    $tweets = User::find(Auth::user()-&gt;id)-&gt;mytweets;
    return view('tweet.index', [
      'tweets' =&gt; $tweets
    ]);
  }
}

</code></pre>
<h2 id="マイページ画面の確認"><a class="header" href="#マイページ画面の確認">マイページ画面の確認</a></h2>
<p>マイページ自体は<code>index.blade.php</code>画面をそのまま利用するため，新たに実装する必要はない（ビューファイルにログインユーザのデータのみ渡される）．</p>
<p>スムーズにマイページにアクセスできるようにするため，ナビゲーション部分にリンクを追加する．</p>
<p><code>resources/views/layouts/navigation.blade.php</code>の内容を以下のように編集する．</p>
<p>長いので全コピペ推奨．</p>
<pre><code class="language-php">&lt;!-- resources/views/layouts/navigation.blade.php --&gt;

&lt;nav x-data=&quot;{ open: false }&quot; class=&quot;bg-white border-b border-gray-100&quot;&gt;
  &lt;!-- Primary Navigation Menu --&gt;
  &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
    &lt;div class=&quot;flex justify-between h-16&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;!-- Logo --&gt;
        &lt;div class=&quot;flex-shrink-0 flex items-center&quot;&gt;
          &lt;a href=&quot;{{ route('dashboard') }}&quot;&gt;
            &lt;x-application-logo class=&quot;block h-10 w-auto fill-current text-gray-600&quot; /&gt;
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Navigation Links --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
            {{ __('Dashboard') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- ↓一覧ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
            {{ __('Index') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- ↓作成ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
            {{ __('Create') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- ↓マイページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.mypage')&quot; :active=&quot;request()-&gt;routeIs('tweet.mypage')&quot;&gt;
            {{ __('Mypage') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Settings Dropdown --&gt;
      &lt;div class=&quot;hidden sm:flex sm:items-center sm:ml-6&quot;&gt;
        &lt;x-dropdown align=&quot;right&quot; width=&quot;48&quot;&gt;
          &lt;x-slot name=&quot;trigger&quot;&gt;
            &lt;button class=&quot;flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out&quot;&gt;
              &lt;div&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;

              &lt;div class=&quot;ml-1&quot;&gt;
                &lt;svg class=&quot;fill-current h-4 w-4&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                  &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
            &lt;/button&gt;
          &lt;/x-slot&gt;

          &lt;x-slot name=&quot;content&quot;&gt;
            &lt;!-- Authentication --&gt;
            &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
              @csrf

              &lt;x-dropdown-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                                this.closest('form').submit();&quot;&gt;
                {{ __('Logout') }}
              &lt;/x-dropdown-link&gt;
            &lt;/form&gt;
          &lt;/x-slot&gt;
        &lt;/x-dropdown&gt;
      &lt;/div&gt;

      &lt;!-- Hamburger --&gt;
      &lt;div class=&quot;-mr-2 flex items-center sm:hidden&quot;&gt;
        &lt;button @click=&quot;open = ! open&quot; class=&quot;inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out&quot;&gt;
          &lt;svg class=&quot;h-6 w-6&quot; stroke=&quot;currentColor&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;
            &lt;path :class=&quot;{'hidden': open, 'inline-flex': ! open }&quot; class=&quot;inline-flex&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M4 6h16M4 12h16M4 18h16&quot; /&gt;
            &lt;path :class=&quot;{'hidden': ! open, 'inline-flex': open }&quot; class=&quot;hidden&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M6 18L18 6M6 6l12 12&quot; /&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Responsive Navigation Menu --&gt;
  &lt;div :class=&quot;{'block': open, 'hidden': ! open}&quot; class=&quot;hidden sm:hidden&quot;&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
        {{ __('Dashboard') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- ↓一覧ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
        {{ __('Index') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- ↓作成ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
        {{ __('Create') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- ↓マイページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.mypage')&quot; :active=&quot;request()-&gt;routeIs('tweet.mypage')&quot;&gt;
        {{ __('Mypage') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;

    &lt;!-- Responsive Settings Options --&gt;
    &lt;div class=&quot;pt-4 pb-1 border-t border-gray-200&quot;&gt;
      &lt;div class=&quot;flex items-center px-4&quot;&gt;
        &lt;div class=&quot;flex-shrink-0&quot;&gt;
          &lt;svg class=&quot;h-10 w-10 fill-current text-gray-400&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;
            &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot; /&gt;
          &lt;/svg&gt;
        &lt;/div&gt;

        &lt;div class=&quot;ml-3&quot;&gt;
          &lt;div class=&quot;font-medium text-base text-gray-800&quot;&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;
          &lt;div class=&quot;font-medium text-sm text-gray-500&quot;&gt;{{ Auth::user()-&gt;email }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;mt-3 space-y-1&quot;&gt;
        &lt;!-- Authentication --&gt;
        &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
          @csrf

          &lt;x-responsive-nav-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                        this.closest('form').submit();&quot;&gt;
            {{ __('Logout') }}
          &lt;/x-responsive-nav-link&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

</code></pre>
<h2 id="tweet-データの編集"><a class="header" href="#tweet-データの編集">tweet データの編集</a></h2>
<p>tweets テーブルのデータを確認し，レコード毎に<code>user_id</code>が異なるよう調整しておく．</p>
<h2 id="動作確認マイページ"><a class="header" href="#動作確認マイページ">動作確認（マイページ）</a></h2>
<p>下図のようにマイページへのリンクが表示される．</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_mypage_nav.png" alt="マイページへのリンク" /></p>
<p>マイページを表示させ，ログインしているユーザのデータのみ表示されることを確認する．異なるユーザでログインし，個別にデータが表示されることを確認しても良いだろう．</p>
<p><img src="laravel/laravel03/./img/laratter_mypage.png" alt="マイページへのリンク" /></p>
<h2 id="一覧ページでログインユーザの投稿のみ編集削除できるようにする"><a class="header" href="#一覧ページでログインユーザの投稿のみ編集削除できるようにする">一覧ページでログインユーザの投稿のみ編集削除できるようにする</a></h2>
<p>現状，一覧ページでは全ての投稿に対して編集や削除が行える状態である．これを下記のようにしたい．</p>
<ul>
<li>ログインしているユーザは自分の投稿を編集削除できる．</li>
<li>自分以外のユーザの投稿は閲覧のみ可能．</li>
</ul>
<p>一覧画面のビューファイル内で条件分岐を行い，編集ボタンと削除ボタンの表示非表示を制御することで実現できる．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- ↓条件分岐でログインしているユーザが投稿したtweetのみ編集ボタンと削除ボタンが表示される --&gt;
                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集削除ボタンの表示非表示"><a class="header" href="#動作確認編集削除ボタンの表示非表示">動作確認（編集削除ボタンの表示非表示）</a></h2>
<p>自分の投稿のみ編集ボタンと削除ボタンが表示されれば OK！</p>
<p>phpmyadmin で <code>user_id</code> カラムを適当に編集しながら確認すると良いだろう．</p>
<p><img src="laravel/laravel03/./img/laratter_index_switch_edit_remove.png" alt="編集削除ボタンの表示非表示適用" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="投稿者名の表示多対-1-のデータ"><a class="header" href="#投稿者名の表示多対-1-のデータ">投稿者名の表示（多対 1 のデータ）</a></h1>
<p>一覧ページでログインユーザのみが編集と削除を行えるようにしたが，このままでは tweet がどのユーザによって行われたのかを画面から判別できない．</p>
<p>そこで，各 tweet にユーザ名を表示して tweet の識別ができるようにする．</p>
<h2 id="多対-1-のデータ構造"><a class="header" href="#多対-1-のデータ構造">多対 1 のデータ構造</a></h2>
<p>tweet とユーザの関係は「多対 1」である（1 対多の逆）．</p>
<p>Laravel では，この場合も連携ができる機能が準備されている．</p>
<p>設定はモデル部分に記述する．<code>app/Http/Models/Tweet.php</code>を以下のように編集する．</p>
<p>子のモデルに<code>belongsTo()</code>を設定することで親のモデルを指定することができる．これで「Tweet モデルは User モデルに属している」状態となる．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];

  public static function getAllOrderByDeadline()
  {
    return self::orderBy('updated_at', 'desc')-&gt;get();
  }

  // ↓追加
  public function user()
  {
    return $this-&gt;belongsTo(User::class);
  }

}

</code></pre>
<h2 id="連携したデータの呼び出し"><a class="header" href="#連携したデータの呼び出し">連携したデータの呼び出し</a></h2>
<p>モデルに多対 1 の関係を指定できたので，<code>user</code>関数を用いて子のデータから親のデータを呼び出せるようになった．</p>
<p>ビューファイルでは tweet の内容を表示しているので，<code>$tweet-&gt;user-&gt;name</code>のように指定することで親データ（この場合は<code>name</code>）を取得できる．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;!-- ↓追加 --&gt;
                    &lt;p class=&quot;text-left text-grey-dark&quot;&gt;{{$tweet-&gt;user-&gt;name}}&lt;/p&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-6"><a class="header" href="#動作確認-6">動作確認</a></h2>
<p>一覧画面で各 tweet に投稿者名が表示されれば OK！</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_auther.png" alt="投稿者名の表示" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="favorite-機能-1多対多のデータ中間テーブル"><a class="header" href="#favorite-機能-1多対多のデータ中間テーブル">Favorite 機能 1（多対多のデータ・中間テーブル）</a></h1>
<p>ここからは SNS においてメジャーな機能である「Favorite 機能」を実装していく．</p>
<p>Favorite は多対多のデータ構造となるため，新たに中間テーブルを作成する必要がある．</p>
<h2 id="多対多のデータ構造"><a class="header" href="#多対多のデータ構造">多対多のデータ構造</a></h2>
<p>Laravel では中間テーブルの命名を「関連するテーブル A の単数形_関連するテーブル B の単数形（テーブル名はアルファベット順）」とする規則がある．</p>
<p>したがって，今回の中間テーブル名は <code>tweet_user</code> となる．</p>
<p>↓ テーブルの構造（主要なもののみ記載）</p>
<pre><code class="language-txt">users
    id - integer
    name - string

tweets
    id - integer
    tweet - string
    description - string

tweet_user
    user_id - integer
    tweet_id - integer

</code></pre>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<h2 id="マイグレーションファイルの作成-1"><a class="header" href="#マイグレーションファイルの作成-1">マイグレーションファイルの作成</a></h2>
<p>テーブルの作成はマイグレーションで行う．まずはマイグレーションファイルを作成する．</p>
<pre><code class="language-bash">$ php artisan make:migration create_tweet_user_table
</code></pre>
<p>マイグレーションファイル（<code>database/migrations/2021_09_24_072924_create_tweet_user_table.php</code>）を開き，<code>up()</code> 関数を以下のように編集する．</p>
<pre><code class="language-php">// database/migrations/2021_09_24_072924_create_tweet_user_table.php

public function up()
{
  Schema::create('tweet_user', function (Blueprint $table) {
    $table-&gt;id();
    // ↓ ここから追加
    $table-&gt;unsignedBigInteger('user_id');
    $table-&gt;unsignedBigInteger('tweet_id');
    $table-&gt;foreign('user_id')-&gt;references('id')-&gt;on('users')-&gt;onDelete('cascade');
    $table-&gt;foreign('tweet_id')-&gt;references('id')-&gt;on('tweets')-&gt;onDelete('cascade');
    $table-&gt;unique(['user_id', 'tweet_id']);
    // ↑ ここまで追加
    $table-&gt;timestamps();
  });
}

</code></pre>
<h2 id="補足マイグレーションファイルの設定項目について"><a class="header" href="#補足マイグレーションファイルの設定項目について">【補足】マイグレーションファイルの設定項目について</a></h2>
<table><thead><tr><th>関数</th><th>意味</th></tr></thead><tbody>
<tr><td><code>foreign()</code></td><td>引数のカラムが外部キー制約であることを示す．</td></tr>
<tr><td><code>references()</code></td><td>↑ で参照する外部キーを設定する．</td></tr>
<tr><td><code>on()</code></td><td>↑ で参照するテーブルを設定する．</td></tr>
<tr><td><code>onDelete()</code></td><td>↑ で参照しているデータが削除された場合に中間テーブルのデータも削除する設定．</td></tr>
</tbody></table>
<p>上記をまとめると「中間テーブルの <code>user_id</code> は <code>users</code> テーブルの <code>id</code> を参照していて，<code>users</code> テーブルのデータが削除されると中間テーブルのデータも削除される」となる．</p>
<h2 id="マイグレーションの実行"><a class="header" href="#マイグレーションの実行">マイグレーションの実行</a></h2>
<p>マイグレーションファイルを作成したらマイグレーションを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migrating: 2021_09_24_072924_create_tweet_user_table
Migrated:  2021_09_24_072924_create_tweet_user_table (451.37ms)

</code></pre>
<h2 id="テーブルの確認-1"><a class="header" href="#テーブルの確認-1">テーブルの確認</a></h2>
<p>phpmyadmin で，<code>tweet_user</code> テーブルが作成されていることを確認する．</p>
<pre><code class="language-txt">+------------+-----------------+------+-----+---------+----------------+
| Field      | Type            | Null | Key | Default | Extra          |
+------------+-----------------+------+-----+---------+----------------+
| id         | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id    | bigint unsigned | NO   | MUL | NULL    |                |
| tweet_id   | bigint unsigned | NO   | MUL | NULL    |                |
| created_at | timestamp       | YES  |     | NULL    |                |
| updated_at | timestamp       | YES  |     | NULL    |                |
+------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】以下にコマンドで確認する場合も示す．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

```bash
$  mysql -u sail -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 347
Server version: 8.0.25 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use laratter;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweet_user             |
| tweets                 |
| users                  |
+------------------------+
7 rows in set (0.00 sec)

mysql> desc tweet_user;
+------------+-----------------+------+-----+---------+----------------+
| Field      | Type            | Null | Key | Default | Extra          |
+------------+-----------------+------+-----+---------+----------------+
| id         | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id    | bigint unsigned | NO   | MUL | NULL    |                |
| tweet_id   | bigint unsigned | NO   | MUL | NULL    |                |
| created_at | timestamp       | YES  |     | NULL    |                |
| updated_at | timestamp       | YES  |     | NULL    |                |
+------------+-----------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

mysql>
``` -->
<h2 id="モデルに多対多の連携を設定"><a class="header" href="#モデルに多対多の連携を設定">モデルに多対多の連携を設定</a></h2>
<p>User モデルに <code>belongsToMany</code> を設定して，User モデルは Tweet モデルと多対多の連携をすることを示す．</p>
<pre><code class="language-php">// app/Http/Models/User.php

&lt;?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
  use HasApiTokens, HasFactory, Notifiable;

  // 省略

  // ↓追加
  public function tweets()
  {
    return $this-&gt;belongsToMany(Tweet::class)-&gt;withTimestamps();
  }
}

</code></pre>
<p>同様に Tweet モデルにも <code>belongsToMany</code> を設定する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  // 省略

  // ↓追加
  public function users()
  {
    return $this-&gt;belongsToMany(User::class)-&gt;withTimestamps();
  }
}

</code></pre>
<p>ここまでで，データを連携させる設定は完了となる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="favorite-機能-2各処理の実装"><a class="header" href="#favorite-機能-2各処理の実装">Favorite 機能 2（各処理の実装）</a></h1>
<p>データ連携の準備ができたので，各処理を実装していく．</p>
<h2 id="コントローラ生成"><a class="header" href="#コントローラ生成">コントローラ生成</a></h2>
<p>まずは，favorite 処理用のコントローラを作成する．</p>
<blockquote>
<p>📦<strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.testbash
root@8544d96d2334: /var/www/html #
</code></pre>
</blockquote>
<p>下記のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:controller FavoriteController --resource

# 実行結果
Controller created successfully.

</code></pre>
<h2 id="ルーティングの設定"><a class="header" href="#ルーティングの設定">ルーティングの設定</a></h2>
<p>続いてルーティングを設定する．</p>
<p>今回は<code>favorite</code>と<code>unfavorite</code>の URI を設定し，FavoriteController の<code>store()</code>関数と<code>destroy()</code>関数をそれぞれ利用する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// ↓追加
use App\Http\Controllers\FavoriteController;

// 省略

// コメント省略

Route::group(['middleware' =&gt; 'auth'], function () {
  // ↓追加
  Route::post('tweet/{tweet}/favorites', [FavoriteController::class, 'store'])-&gt;name('favorites');

  // ↓追加
  Route::post('tweet/{tweet}/unfavorites', [FavoriteController::class, 'destroy'])-&gt;name('unfavorites');

  Route::get('/tweet/mypage', [TweetController::class, 'mydata'])-&gt;name('tweet.mypage');
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="コントローラの処理を実装"><a class="header" href="#コントローラの処理を実装">コントローラの処理を実装</a></h2>
<p>ルーティングで設定した<code>store()</code>関数と<code>destroy()</code>関数の中身を実装する．</p>
<p><code>app/Http/Controllers/FavoriteController.php</code>を以下のように編集する．</p>
<p><code>attach()</code>で中間テーブルへのデータの追加，<code>detach()</code>で中間テーブルからのデータ削除が実行される．</p>
<pre><code class="language-php">// app/Http/Controllers/FavoriteController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

// ↓2行追加
use App\Models\Tweet;
use Auth;

class FavoriteController extends Controller
{

  // 省略

  // ↓ 編集（`store()` の `()` 内も異なるので注意）
  public function store(Tweet $tweet)
  {
    $tweet-&gt;users()-&gt;attach(Auth::id());
    return redirect()-&gt;route('tweet.index');
  }

  // ↓ 編集 （`destroy()` の `()` 内も異なるので注意）
  public function destroy(Tweet $tweet)
  {
    $tweet-&gt;users()-&gt;detach(Auth::id());
    return redirect()-&gt;route('tweet.index');
  }
}

</code></pre>
<h2 id="一覧画面への反映"><a class="header" href="#一覧画面への反映">一覧画面への反映</a></h2>
<p>中間テーブルへのデータ追加及び削除の処理を実装したので，最後に favorite 数を一覧画面に反映させて完成となる．</p>
<p>まず，<code>$tweet-&gt;users()-&gt;where('user_id', Auth::id())-&gt;exists()</code>でログインしているユーザが favorite しているかどうかを判定する．</p>
<p>既 favorite の場合は unfavorite するボタンを，未 favorite の場合は favorite するボタンを条件分岐で表示する．</p>
<p>それぞれのボタン部分では favorite 件数を表示する．<code>$tweet-&gt;users()-&gt;count()</code> で中間テーブルのデータ件数を取得することができる．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;p class=&quot;text-left text-grey-dark&quot;&gt;{{$tweet-&gt;user-&gt;name}}&lt;/p&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- ↓追加 --&gt;
                    &lt;!-- favorite 状態で条件分岐 --&gt;
                    @if($tweet-&gt;users()-&gt;where('user_id', Auth::id())-&gt;exists())
                    &lt;!-- unfavorite ボタン --&gt;
                    &lt;form action=&quot;{{ route('unfavorites',$tweet) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;flex mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-red py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-red-500&quot; fill=&quot;red&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;red&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot; /&gt;
                        &lt;/svg&gt;
                        {{ $tweet-&gt;users()-&gt;count() }}
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @else
                    &lt;!-- favorite ボタン --&gt;
                    &lt;form action=&quot;{{ route('favorites',$tweet) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;flex mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-black py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-red-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot; /&gt;
                        &lt;/svg&gt;
                        {{ $tweet-&gt;users()-&gt;count() }}
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif

                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-7"><a class="header" href="#動作確認-7">動作確認</a></h2>
<p>下図のように favorite ボタンが表示され，favorite 件数が表示されていれば OK．</p>
<p>ここまでで Twitter ライクな SNS アプリケーションの実装は完了である．</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_favorite.png" alt="favorite機能追加" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
